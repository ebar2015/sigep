<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.gov.dafp.sigep2.interfaces.UsuarioMapper">
  <resultMap id="BaseResultMap" type="co.gov.dafp.sigep2.bean.Usuario">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    <id column="COD_USUARIO" jdbcType="NUMERIC" property="codUsuario" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="COD_TIPO_IDENTIFICACION" jdbcType="NUMERIC" property="codTipoIdentificacion" />
    <result column="NOMBRE_USUARIO" jdbcType="VARCHAR" property="nombreUsuario" />
    <result column="NOMBRE_PERSONA" jdbcType="VARCHAR" property="nombrePersona" />
    <result column="CORREO_ELECTRONICO" jdbcType="VARCHAR" property="correoElectronico" />
    <result column="CONTRASENA" jdbcType="VARCHAR" property="contrasena" />
    <result column="NUMERO_REINTENTOS" jdbcType="NUMERIC" property="numeroReintentos" />
    <result column="NUMERO_SESIONES_ACTIVAS" jdbcType="NUMERIC" property="numeroSesionesActivas" />
    <result column="FLG_BLOQUEADO" jdbcType="NUMERIC" property="flgBloqueado" />
    <result column="FLG_ACEPTO_HABEAS_DATA" jdbcType="NUMERIC" property="flgAceptoHabeasData" />
    <result column="FECHA_ACEPTO_HABEAS" jdbcType="TIMESTAMP" property="fechaAceptoHabeas" />
    <result column="FECHA_VENCE" jdbcType="TIMESTAMP" property="fechaVence" />
    <result column="FECHA_ULTIMO_INGRESO" jdbcType="TIMESTAMP" property="fechaUltimoIngreso" />
    <result column="IP_AUTORIZADA" jdbcType="VARCHAR" property="ipAutorizada" />
    <result column="MAC_AUTORIZADA" jdbcType="VARCHAR" property="macAutorizada" />
    <result column="TICKET" jdbcType="VARCHAR" property="ticket" />
    <result column="FLG_ES_INTERNO" jdbcType="NUMERIC" property="flgEsInterno" />
    <result column="FLG_ESTADO" jdbcType="NUMERIC" property="flgEstado" />
    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
    <result column="AUD_COD_USUARIO" jdbcType="NUMERIC" property="audCodUsuario" />
    <result column="AUD_COD_ROL" jdbcType="NUMERIC" property="audCodRol" />
    <result column="AUD_ACCION" jdbcType="NUMERIC" property="audAccion" />
    <result column="FECHA_ACTIVACION" jdbcType="TIMESTAMP" property="fechaActivacion" />
  </resultMap>
  <resultMap id="BaseResultMapExt" type="co.gov.dafp.sigep2.bean.ext.UsuarioExt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    <id column="COD_USUARIO" jdbcType="NUMERIC" property="codUsuario" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="COD_TIPO_IDENTIFICACION" jdbcType="NUMERIC" property="codTipoIdentificacion" />
    <result column="NOMBRE_USUARIO" jdbcType="VARCHAR" property="nombreUsuario" />
    <result column="NOMBRE_PERSONA" jdbcType="VARCHAR" property="nombrePersona" />
    <result column="CORREO_ELECTRONICO" jdbcType="VARCHAR" property="correoElectronico" />
    <result column="CONTRASENA" jdbcType="VARCHAR" property="contrasena" />
    <result column="NUMERO_REINTENTOS" jdbcType="NUMERIC" property="numeroReintentos" />
    <result column="NUMERO_SESIONES_ACTIVAS" jdbcType="NUMERIC" property="numeroSesionesActivas" />
    <result column="FLG_BLOQUEADO" jdbcType="NUMERIC" property="flgBloqueado" />
    <result column="FLG_ACEPTO_HABEAS_DATA" jdbcType="NUMERIC" property="flgAceptoHabeasData" />
    <result column="FECHA_ACEPTO_HABEAS" jdbcType="TIMESTAMP" property="fechaAceptoHabeas" />
    <result column="FECHA_VENCE" jdbcType="TIMESTAMP" property="fechaVence" />
    <result column="FECHA_ULTIMO_INGRESO" jdbcType="TIMESTAMP" property="fechaUltimoIngreso" />
    <result column="IP_AUTORIZADA" jdbcType="VARCHAR" property="ipAutorizada" />
    <result column="MAC_AUTORIZADA" jdbcType="VARCHAR" property="macAutorizada" />
    <result column="TICKET" jdbcType="VARCHAR" property="ticket" />
    <result column="FLG_ES_INTERNO" jdbcType="NUMERIC" property="flgEsInterno" />
    <result column="FLG_ESTADO" jdbcType="NUMERIC" property="flgEstado" />
    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
    <result column="AUD_COD_USUARIO" jdbcType="NUMERIC" property="audCodUsuario" />
    <result column="AUD_COD_ROL" jdbcType="NUMERIC" property="audCodRol" />
    <result column="AUD_ACCION" jdbcType="NUMERIC" property="audAccion" />
    <result column="FECHA_ACTIVACION" jdbcType="TIMESTAMP" property="fechaActivacion" />
      
    <result column="PRIMER_NOMBRE" jdbcType="VARCHAR" property="primerNombre" />
    <result column="SEGUNDO_NOMBRE" jdbcType="VARCHAR" property="segundoNombre" />
    <result column="PRIMER_APELLIDO" jdbcType="VARCHAR" property="primerApellido" />
    <result column="SEGUNDO_APELLIDO" jdbcType="VARCHAR" property="segundoApellido" />
    <result column="TIPO_ASOCIACION" jdbcType="VARCHAR" property="tipoAsociacion" />
    <result column="NOMBRE_ENTIDAD" jdbcType="VARCHAR" property="nombreEntidad" />
    <result column="COD_ROL" jdbcType="NUMERIC" property="codRol" />
    <result column="COD_ENTIDAD" jdbcType="NUMERIC" property="codEntidad" />
    <result column="FLG_ACTIVO" jdbcType="NUMERIC" property="flgActivo" />
    <result column="COD_TIPO_VINCULACION" jdbcType="NUMERIC" property="codTipoVinculacion" />
    <result column="CANTIDAD_ROLES" jdbcType="NUMERIC" property="cantidadRoles" />
  </resultMap>
  
  <resultMap id="BaseResultMapResultados" type="co.gov.dafp.sigep2.portal.Resultados">
    <result column="TOTAL_REGISTROS" jdbcType="NUMERIC" property="totalRegistros" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="COD_DEPARTAMENTO" jdbcType="NUMERIC" property="codDepartamento" />
    <result column="COD_MUNICIPIO" jdbcType="NUMERIC" property="codMunicipio" />
    <result column="COD_TABLA_PARAMETRICA" jdbcType="NUMERIC" property="codTipoContrato" />
    <result column="COD_DENOMINACION" jdbcType="NUMERIC" property="codDenominacion" />
    <result column="COD_NIVEL_JERARQUICO" jdbcType="NUMERIC" property="codNivelJerarquico" />
    <result column="FOTO_URL" jdbcType="VARCHAR" property="fotoUrl" />
    <result column="NOMBRE_FUNCIONARIO" jdbcType="VARCHAR" property="nombreFuncionario" />
    <result column="NOMBRES" jdbcType="VARCHAR" property="nombres" />
    <result column="APELLIDOS" jdbcType="VARCHAR" property="apellidos" />
    <result column="CORREO_ELECTRONICO" jdbcType="VARCHAR" property="emailFuncionario" />
    <result column="NUM_TELEFONO_OFICINA" jdbcType="VARCHAR" property="telefonoFuncionario" />
    <result column="COD_ENTIDAD" jdbcType="NUMERIC" property="codEntidad" />
    <result column="EXPUESTO_POLITICAMENTE" jdbcType="NUMERIC" property="expuestoPoliticamente" />
    <result column="NOMBRE_ENTIDAD" jdbcType="VARCHAR" property="nombreEntidad" />
    <result column="NOMBRE_DEPARTAMENTO" jdbcType="VARCHAR" property="nombreDepartamento" />
    <result column="NOMBRE_MUNICIPIO" jdbcType="VARCHAR" property="nombreMunicipio" />
    <result column="TIPO_CONTRATO" jdbcType="VARCHAR" property="nombreTipoContrato" />
    <result column="GENERO" jdbcType="VARCHAR" property="genero" />
    <result column="NOMBRE_DENOMINACION" jdbcType="VARCHAR" property="nombreDenominacion" />
    <result column="CARGO" jdbcType="VARCHAR" property="cargo" />
    <result column="NOMBRE_PLANTA" jdbcType="VARCHAR" property="nombrePlanta" />
    <result column="NUMERO_CONTRATO" jdbcType="VARCHAR" property="numeroContrato" />
    <result column="NOMBRE_NIVEL_JERARQUICO" jdbcType="VARCHAR" property="nombreNivelJerarquico" />
  </resultMap>
  
  <resultMap id="BaseResultMapDeptoFiltro" type="co.gov.dafp.sigep2.portal.DepartamentoFiltro">
    <result column="TOTAL_REGISTROS" jdbcType="NUMERIC" property="totalRegistros" />
    <result column="COD_DEPARTAMENTO" jdbcType="NUMERIC" property="codDepartamento" />
    <result column="NOMBRE_DEPARTAMENTO" jdbcType="VARCHAR" property="nombre" />
  </resultMap>
  
  <resultMap id="BaseResultMapMunFiltro" type="co.gov.dafp.sigep2.portal.MunicipioFiltro">
    <result column="TOTAL_REGISTROS" jdbcType="NUMERIC" property="totalRegistros" />
     <result column="COD_MUNICIPIO" jdbcType="NUMERIC" property="codMunicipio" />
    <result column="NOMBRE_MUNICIPIO" jdbcType="VARCHAR" property="nombre" />
  </resultMap>
  
  <resultMap id="BaseResultMapEntFiltro" type="co.gov.dafp.sigep2.portal.InstitucionFiltro">
    <result column="TOTAL_REGISTROS" jdbcType="NUMERIC" property="totalRegistros" />
    <result column="COD_ENTIDAD" jdbcType="NUMERIC" property="codEntidad" />
    <result column="NOMBRE_ENTIDAD" jdbcType="VARCHAR" property="nombre" />
  </resultMap>
  
  <resultMap id="BaseResultMapTipoConFiltro" type="co.gov.dafp.sigep2.portal.TipoContratoFiltro">
    <result column="TOTAL_REGISTROS" jdbcType="NUMERIC" property="totalRegistros" />
    <result column="COD_TABLA_PARAMETRICA" jdbcType="NUMERIC" property="codTipoContrato" />
    <result column="TIPO_CONTRATO" jdbcType="VARCHAR" property="nombre" />
  </resultMap>
  
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    COD_USUARIO, COD_PERSONA, NOMBRE_USUARIO, CONTRASENA, NUMERO_REINTENTOS, NUMERO_SESIONES_ACTIVAS, 
    FLG_BLOQUEADO, FLG_ACEPTO_HABEAS_DATA, FECHA_ACEPTO_HABEAS, FECHA_VENCE, FECHA_ULTIMO_INGRESO, 
    IP_AUTORIZADA, MAC_AUTORIZADA, TICKET, FLG_ES_INTERNO, FLG_ESTADO, AUD_FECHA_ACTUALIZACION, 
    AUD_COD_USUARIO, AUD_COD_ROL, AUD_ACCION, FECHA_ACTIVACION
  </sql>
  <select id="selectByExample" parameterType="co.gov.dafp.sigep2.bean.UsuarioExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from USUARIO
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
    <if test="limitInit!= null and limitEnd > 1">
     		OFFSET #{limitInit} ROWS FETCH NEXT #{limitEnd} ROWS ONLY
    </if>
  </select>
  
  <select id="getToken" resultType="String" statementType = "CALLABLE" >
			
			 select RANDOM_GUID() from dual
 </select>
  
  <select id="selectUsByEntidad" parameterType="co.gov.dafp.sigep2.bean.UsuarioEntidad" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    select  U.*
     FROM USUARIO U, USUARIO_ENTIDAD UE  
     WHERE U.COD_USUARIO =   #{codUsuario,jdbcType=NUMERIC}
     AND UE.COD_ENTIDAD =     #{codEntidad,jdbcType=NUMERIC}
     AND U.COD_USUARIO = UE.COD_USUARIO
  </select>
  
  <select id="busquedaServidor" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapResultados">
		    SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, CASE  WHEN DC.NUM_TELEFONO_OFICINA  IS NULL THEN ' ' ELSE DC.NUM_TELEFONO_OFICINA END AS NUM_TELEFONO_OFICINA,   P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO, ' ' AS CARGO,  0 AS COD_DENOMINACION,
			     0 AS  COD_NIVEL_JERARQUICO,  ' ' AS NOMBRE_NIVEL_JERARQUICO,
			   PG.NOMBRE_PARAMETRO as GENERO,  CASE  WHEN P.EXPUESTO_POLITICAMENTE  IS NULL THEN 0 ELSE P.EXPUESTO_POLITICAMENTE END AS EXPUESTO_POLITICAMENTE,
			   CO.NUMERO_CONTRATO, '' as NOMBRE_PLANTA
			FROM PERSONA P
				LEFT JOIN DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
				LEFT JOIN ENTIDAD E ON E.COD_ENTIDAD = UE.COD_ENTIDAD
				LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
				LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
				LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
                LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		        INNER JOIN CONTRATO CO ON CO.COD_PERSONA = P.COD_PERSONA
		        LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
			WHERE E.COD_ESTADO_ENTIDAD = 1480
			 AND PA.COD_TABLA_PARAMETRICA = 109
			  AND CO.FLG_ACTIVO = 1
              <if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
              <if test="criterioBusqueda != null">
                 AND (
				      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
	              )
			   </if>  
			    <if test="codEntidad != null">
			      AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
			    </if>
			    <if test="codDepartamento != null">
			        AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
			    </if>
	            <if test="codMunicipio != null">
	               AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
	            </if>
	             <if test="codPais != null">
	              AND P.COD_PAIS = #{codPais,jdbcType=NUMERIC}
	            </if>
	             <if test="expuestoPoliticamente != null">
	              AND P.EXPUESTO_POLITICAMENTE = #{expuestoPoliticamente,jdbcType=NUMERIC}
	            </if>

       UNION

    SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, CASE  WHEN DC.NUM_TELEFONO_OFICINA  IS NULL THEN ' ' ELSE DC.NUM_TELEFONO_OFICINA END AS NUM_TELEFONO_OFICINA,   P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO, C.NOMBRE_DENOMINACION AS CARGO, C.COD_DENOMINACION,
			    ND.COD_NIVEL_JERARQUICO,  P4.NOMBRE_PARAMETRO AS NOMBRE_NIVEL_JERARQUICO,
			   PG.NOMBRE_PARAMETRO as GENERO, CASE  WHEN P.EXPUESTO_POLITICAMENTE  IS NULL THEN 0 ELSE P.EXPUESTO_POLITICAMENTE END AS EXPUESTO_POLITICAMENTE,
			   '' AS NUMERO_CONTRATO, EP.NOMBRE_PLANTA
			FROM VINCULACION V
		         LEFT JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
		         LEFT JOIN ENTIDAD_PLANTA_DETALLE EN ON EN.COD_ENTIDAD_PLANTA_DETALLE = V.COD_ENTIDAD_PLANTA_DETALLE
                 LEFT JOIN ENTIDAD_PLANTA EP ON EN.COD_ENTIDAD_PLANTA = EP.COD_ENTIDAD_PLANTA
		         LEFT JOIN NOMENCLATURA_DENOMINACION ND ON EN.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN DENOMINACION C ON C.COD_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         LEFT JOIN  DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		         LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
		         LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
		         LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
		         LEFT JOIN PAIS PA ON PA.COD_PAIS = E.COD_PAIS
		         LEFT JOIN PARAMETRICA P2 on UE.COD_TIPO_VINCULACION = P2.COD_TABLA_PARAMETRICA
		         LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
		         INNER JOIN PARAMETRICA P4 ON ND.COD_NIVEL_JERARQUICO = P4.COD_TABLA_PARAMETRICA
			WHERE V.COD_CAUSAL_DESVINCULACION IS NULL
        		AND V.FLG_ACTIVO = 1
        		 AND PA.COD_TABLA_PARAMETRICA = 110
        		 AND E.COD_ESTADO_ENTIDAD = 1480
        		<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
         		<if test="criterioBusqueda != null">
         		AND (
			  	      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            )
			   </if>  
			    <if test="codEntidad != null">
			      AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
			    </if>
			    <if test="codDepartamento != null">
			        AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
			    </if>
	            <if test="codMunicipio != null">
	               AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
	            </if>
	            <if test="codDenominacion != null">
	              AND C.COD_DENOMINACION = #{codDenominacion,jdbcType=NUMERIC}
	            </if>
	             <if test="nombreDenominacion != null">
	              AND UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{nombreDenominacion,jdbcType=VARCHAR}) || '%'
	            </if>
	             <if test="codPais != null">
	              AND P.COD_PAIS = #{codPais,jdbcType=NUMERIC}
	            </if>
	            <if test="expuestoPoliticamente != null">
	              AND P.EXPUESTO_POLITICAMENTE = #{expuestoPoliticamente,jdbcType=NUMERIC}
	            </if>
	OFFSET #{limiteInicial,jdbcType=NUMERIC} ROWS FETCH NEXT #{limiteFinal,jdbcType=NUMERIC} ROWS ONLY		
  </select>
  <select id="busquedaServidorT" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapResultados">
  	SELECT count(COD_PERSONA) TOTAL_REGISTROS FROM(
SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,   P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM PERSONA P
				LEFT JOIN DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
				LEFT JOIN ENTIDAD E ON E.COD_ENTIDAD = UE.COD_ENTIDAD
				LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
				LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
				LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
				LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
        LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		    INNER JOIN CONTRATO CO ON CO.COD_PERSONA = P.COD_PERSONA
			WHERE E.COD_ESTADO_ENTIDAD = 1480
			AND PA.COD_TABLA_PARAMETRICA = 109
			<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
               AND CO.FLG_ACTIVO = 1
                <if test="criterioBusqueda != null">
			    	    AND (
				     UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
	              )
			   </if>  
			    <if test="codEntidad != null">
			      AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
			    </if>
			    <if test="codDepartamento != null">
			        AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
			    </if>
	            <if test="codMunicipio != null">
	               AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
	            </if>
	             <if test="expuestoPoliticamente != null">
	              AND P.EXPUESTO_POLITICAMENTE = #{expuestoPoliticamente,jdbcType=NUMERIC}
	            </if>

UNION
		SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,   P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM VINCULACION V
		         LEFT JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
		         LEFT JOIN ENTIDAD_PLANTA_DETALLE EN ON EN.COD_ENTIDAD_PLANTA_DETALLE = V.COD_ENTIDAD_PLANTA_DETALLE
                 LEFT JOIN ENTIDAD_PLANTA EP ON EN.COD_ENTIDAD_PLANTA = EP.COD_ENTIDAD_PLANTA
		         LEFT JOIN NOMENCLATURA_DENOMINACION ND ON EN.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN DENOMINACION C ON C.COD_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         LEFT JOIN  DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		         LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
		         LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
		         LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
		         LEFT JOIN PAIS PA ON PA.COD_PAIS = E.COD_PAIS
		         LEFT JOIN PARAMETRICA P2 on UE.COD_TIPO_VINCULACION = P2.COD_TABLA_PARAMETRICA
		         LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
		         INNER JOIN PARAMETRICA P4 ON ND.COD_NIVEL_JERARQUICO = P4.COD_TABLA_PARAMETRICA
			WHERE V.COD_CAUSAL_DESVINCULACION IS NULL
        		AND V.FLG_ACTIVO = 1
        		 AND PA.COD_TABLA_PARAMETRICA = 110
        		 AND E.COD_ESTADO_ENTIDAD = 1480
        		<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
         		<if test="criterioBusqueda != null">
         		AND (
			  	      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            )
			   </if>  
			    <if test="codEntidad != null">
			      AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
			    </if>
			    <if test="codDepartamento != null">
			        AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
			    </if>
	            <if test="codMunicipio != null">
	               AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
	            </if>
	            <if test="codDenominacion != null">
	              AND C.COD_DENOMINACION = #{codDenominacion,jdbcType=NUMERIC}
	            </if>
	             <if test="nombreDenominacion != null">
	              AND UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{nombreDenominacion,jdbcType=VARCHAR}) || '%'
	            </if>
	             <if test="codPais != null">
	              AND P.COD_PAIS = #{codPais,jdbcType=NUMERIC}
	            </if>
	            <if test="expuestoPoliticamente != null">
	              AND P.EXPUESTO_POLITICAMENTE = #{expuestoPoliticamente,jdbcType=NUMERIC}
	            </if>
	            )
  </select>
  
  
  
  <select id="busquedaServidorDepFiltro" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapDeptoFiltro">
  		SELECT COD_DEPARTAMENTO, NOMBRE_DEPARTAMENTO , COUNT(COD_DEPARTAMENTO) TOTAL_REGISTROS    
        FROM (
          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,   P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM PERSONA P
				LEFT JOIN DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
				LEFT JOIN ENTIDAD E ON E.COD_ENTIDAD = UE.COD_ENTIDAD
				LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
				LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
				LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
        LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		    INNER JOIN CONTRATO CO ON CO.COD_PERSONA = P.COD_PERSONA
		    LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
			WHERE E.COD_ESTADO_ENTIDAD = 1480
			 AND PA.COD_TABLA_PARAMETRICA = 109
			<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	         </if>
          AND CO.FLG_ACTIVO = 1
            <if test="criterioBusqueda != null">
                	   AND (
				     UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
	              )
            </if>
          <if test="codEntidad != null">
            AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
         </if>
          <if test="codDepartamento != null">
            AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
          </if>
          <if test="codMunicipio != null">
            AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
          </if>
          UNION

        SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,   P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM VINCULACION V
		         LEFT JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
		         LEFT JOIN ENTIDAD_PLANTA_DETALLE EN ON EN.COD_ENTIDAD_PLANTA_DETALLE = V.COD_ENTIDAD_PLANTA_DETALLE
                 LEFT JOIN ENTIDAD_PLANTA EP ON EN.COD_ENTIDAD_PLANTA = EP.COD_ENTIDAD_PLANTA
		         LEFT JOIN NOMENCLATURA_DENOMINACION ND ON EN.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN DENOMINACION C ON C.COD_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         LEFT JOIN  DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		         LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
		         LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
		         LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
		         LEFT JOIN PAIS PA ON PA.COD_PAIS = E.COD_PAIS
		         LEFT JOIN PARAMETRICA P2 on UE.COD_TIPO_VINCULACION = P2.COD_TABLA_PARAMETRICA
		         LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
		         INNER JOIN PARAMETRICA P4 ON ND.COD_NIVEL_JERARQUICO = P4.COD_TABLA_PARAMETRICA
			WHERE V.COD_CAUSAL_DESVINCULACION IS NULL
        		AND V.FLG_ACTIVO = 1
        		AND PA.COD_TABLA_PARAMETRICA = 110
        		<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
         		AND E.COD_ESTADO_ENTIDAD = 1480
              <if test="criterioBusqueda != null">
              	    AND (
			  	      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            )
                </if>
                  <if test="codEntidad != null">
                AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
              </if>
              <if test="codDepartamento != null">
                  AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
              </if>
                  <if test="codMunicipio != null">
                    AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
                  </if>
																)
	            GROUP BY COD_DEPARTAMENTO , NOMBRE_DEPARTAMENTO
			    ORDER BY TOTAL_REGISTROS DESC
  </select>
  <select id="busquedaServidorMunFiltro" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapMunFiltro">
          SELECT COD_MUNICIPIO, NOMBRE_MUNICIPIO , COUNT(COD_MUNICIPIO) TOTAL_REGISTROS    
        FROM (
          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,  P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM PERSONA P
				LEFT JOIN DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
				LEFT JOIN ENTIDAD E ON E.COD_ENTIDAD = UE.COD_ENTIDAD
				LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
				LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
				LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
        		LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		    	INNER JOIN CONTRATO CO ON CO.COD_PERSONA = P.COD_PERSONA
		    	LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
			WHERE E.COD_ESTADO_ENTIDAD = 1480
			AND PA.COD_TABLA_PARAMETRICA = 109
				<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
             AND CO.FLG_ACTIVO = 1
            <if test="criterioBusqueda != null">
               	     AND (
				      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
	              )
            </if>
          <if test="codEntidad != null">
            AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
         </if>
          <if test="codDepartamento != null">
            AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
          </if>
          <if test="codMunicipio != null">
            AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
          </if>

          UNION

          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,  P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM VINCULACION V
	         LEFT JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
		         LEFT JOIN ENTIDAD_PLANTA_DETALLE EN ON EN.COD_ENTIDAD_PLANTA_DETALLE = V.COD_ENTIDAD_PLANTA_DETALLE
                 LEFT JOIN ENTIDAD_PLANTA EP ON EN.COD_ENTIDAD_PLANTA = EP.COD_ENTIDAD_PLANTA
		         LEFT JOIN NOMENCLATURA_DENOMINACION ND ON EN.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN DENOMINACION C ON C.COD_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         LEFT JOIN  DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		         LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
		         LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
		         LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
		         LEFT JOIN PAIS PA ON PA.COD_PAIS = E.COD_PAIS
		         LEFT JOIN PARAMETRICA P2 on UE.COD_TIPO_VINCULACION = P2.COD_TABLA_PARAMETRICA
		         LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
		         INNER JOIN PARAMETRICA P4 ON ND.COD_NIVEL_JERARQUICO = P4.COD_TABLA_PARAMETRICA
			WHERE V.COD_CAUSAL_DESVINCULACION IS NULL
        		AND V.FLG_ACTIVO = 1
        		 AND PA.COD_TABLA_PARAMETRICA = 110
        		<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
         		AND E.COD_ESTADO_ENTIDAD = 1480
              <if test="criterioBusqueda != null">
             	     AND (
			  	      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            )
                </if>
                  <if test="codEntidad != null">
                AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
              </if>
              <if test="codDepartamento != null">
                  AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
              </if>
                  <if test="codMunicipio != null">
                    AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
                  </if>
																)
	             GROUP BY COD_MUNICIPIO , NOMBRE_MUNICIPIO
			     ORDER BY TOTAL_REGISTROS DESC
  </select>
  <select id="busquedaServidorEntFiltro" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapEntFiltro">
  		SELECT COD_ENTIDAD , NOMBRE_ENTIDAD, COUNT(COD_ENTIDAD) TOTAL_REGISTROS
        FROM (
          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,  P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM PERSONA P
				LEFT JOIN DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
				LEFT JOIN ENTIDAD E ON E.COD_ENTIDAD = UE.COD_ENTIDAD
				LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
				LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
				LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
        LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		    INNER JOIN CONTRATO CO ON CO.COD_PERSONA = P.COD_PERSONA
		     LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
			WHERE E.COD_ESTADO_ENTIDAD = 1480
			AND PA.COD_TABLA_PARAMETRICA = 109
				<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
            AND CO.FLG_ACTIVO = 1
            <if test="criterioBusqueda != null">
                	AND (
				      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
	              )
            </if>
          <if test="codEntidad != null">
            AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
         </if>
          <if test="codDepartamento != null">
            AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
          </if>
          <if test="codMunicipio != null">
            AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
          </if>

          UNION

          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,  P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM VINCULACION V
	         LEFT JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
		         LEFT JOIN ENTIDAD_PLANTA_DETALLE EN ON EN.COD_ENTIDAD_PLANTA_DETALLE = V.COD_ENTIDAD_PLANTA_DETALLE
                 LEFT JOIN ENTIDAD_PLANTA EP ON EN.COD_ENTIDAD_PLANTA = EP.COD_ENTIDAD_PLANTA
		         LEFT JOIN NOMENCLATURA_DENOMINACION ND ON EN.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN DENOMINACION C ON C.COD_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         LEFT JOIN  DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		         LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
		         LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
		         LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
		         LEFT JOIN PAIS PA ON PA.COD_PAIS = E.COD_PAIS
		         LEFT JOIN PARAMETRICA P2 on UE.COD_TIPO_VINCULACION = P2.COD_TABLA_PARAMETRICA
		         LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
		         INNER JOIN PARAMETRICA P4 ON ND.COD_NIVEL_JERARQUICO = P4.COD_TABLA_PARAMETRICA
			WHERE V.COD_CAUSAL_DESVINCULACION IS NULL
        		AND V.FLG_ACTIVO = 1
        		AND PA.COD_TABLA_PARAMETRICA = 110
        		<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
         		AND E.COD_ESTADO_ENTIDAD = 1480
              <if test="criterioBusqueda != null">
              	    AND (
			  	      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            )
                </if>
                  <if test="codEntidad != null">
                AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
              </if>
              <if test="codDepartamento != null">
                  AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
              </if>
                  <if test="codMunicipio != null">
                    AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
                  </if>)
			    GROUP BY COD_ENTIDAD , NOMBRE_ENTIDAD
			    ORDER BY TOTAL_REGISTROS DESC
  </select>
  <select id="busquedaServidorTipoConFiltro" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapTipoConFiltro">
  		SELECT COD_TABLA_PARAMETRICA , TIPO_CONTRATO, COUNT(COD_TABLA_PARAMETRICA) TOTAL_REGISTROS
        FROM (
          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA, P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM PERSONA P
				LEFT JOIN DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
				LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
				LEFT JOIN ENTIDAD E ON E.COD_ENTIDAD = UE.COD_ENTIDAD
				LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
				LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
				LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
        LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		    INNER JOIN CONTRATO CO ON CO.COD_PERSONA = P.COD_PERSONA
		    LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
			WHERE E.COD_ESTADO_ENTIDAD = 1480
			 AND PA.COD_TABLA_PARAMETRICA = 109
			<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
          AND CO.FLG_ACTIVO = 1
            <if test="criterioBusqueda != null">
               	     AND (
				     UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		             OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
	              )
            </if>
          <if test="codEntidad != null">
            AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
         </if>
          <if test="codDepartamento != null">
            AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
          </if>
          <if test="codMunicipio != null">
            AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
          </if>
          UNION
          
          SELECT DISTINCT P.COD_PERSONA, P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE AS NOMBRES, P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO AS APELLIDOS,
				P.CORREO_ELECTRONICO, DC.NUM_TELEFONO_OFICINA,  P3.VALOR_PARAMETRO||P.FOTO_URL AS FOTO_URL,
				E.COD_ENTIDAD, E.NOMBRE_ENTIDAD,
				D.COD_DEPARTAMENTO, D.NOMBRE_DEPARTAMENTO,
				M.COD_MUNICIPIO, M.NOMBRE_MUNICIPIO,
			    PA.COD_TABLA_PARAMETRICA,  PA.NOMBRE_PARAMETRO as TIPO_CONTRATO,
			   PG.NOMBRE_PARAMETRO as GENERO, P.EXPUESTO_POLITICAMENTE
			FROM VINCULACION V
		         LEFT JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO U ON U.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN USUARIO_ENTIDAD UE ON UE.COD_USUARIO = U.COD_USUARIO
		         LEFT JOIN ENTIDAD_PLANTA_DETALLE EN ON EN.COD_ENTIDAD_PLANTA_DETALLE = V.COD_ENTIDAD_PLANTA_DETALLE
                 LEFT JOIN ENTIDAD_PLANTA EP ON EN.COD_ENTIDAD_PLANTA = EP.COD_ENTIDAD_PLANTA
		         LEFT JOIN NOMENCLATURA_DENOMINACION ND ON EN.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN DENOMINACION C ON C.COD_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         LEFT JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         LEFT JOIN  DATO_CONTACTO DC ON DC.COD_PERSONA = P.COD_PERSONA
		         LEFT JOIN PARAMETRICA PA ON PA.COD_TABLA_PARAMETRICA = UE.COD_TIPO_VINCULACION
		         LEFT JOIN PARAMETRICA PG ON PG.COD_TABLA_PARAMETRICA = P.COD_GENERO
		         LEFT JOIN DEPARTAMENTO D on D.COD_DEPARTAMENTO = E.COD_DEPARTAMENTO
		         LEFT JOIN MUNICIPIO M on M.COD_MUNICIPIO = E.COD_MUNICIPIO
		         LEFT JOIN PAIS PA ON PA.COD_PAIS = E.COD_PAIS
		         LEFT JOIN PARAMETRICA P2 on UE.COD_TIPO_VINCULACION = P2.COD_TABLA_PARAMETRICA
		         LEFT JOIN PARAMETRICA P3 on 2185 = P3.COD_TABLA_PARAMETRICA
		         INNER JOIN PARAMETRICA P4 ON ND.COD_NIVEL_JERARQUICO = P4.COD_TABLA_PARAMETRICA
			WHERE V.COD_CAUSAL_DESVINCULACION IS NULL
        		AND V.FLG_ACTIVO = 1
        		  AND PA.COD_TABLA_PARAMETRICA = 110
        		<if test="codTipoContrato != null">
	              AND PA.COD_TABLA_PARAMETRICA = #{codTipoContrato,jdbcType=NUMERIC}
	            </if>
         		AND E.COD_ESTADO_ENTIDAD = 1480
         		<if test="criterioBusqueda != null">
			  	   AND (
			  	      UPPER(P.PRIMER_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_NOMBRE) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.PRIMER_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(P.SEGUNDO_APELLIDO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(E.NOMBRE_ENTIDAD) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(C.NOMBRE_DENOMINACION) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(D.NOMBRE_DEPARTAMENTO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            OR UPPER(M.NOMBRE_MUNICIPIO) LIKE '%' || UPPER(#{criterioBusqueda,jdbcType=VARCHAR}) || '%'
		            )
			   </if>  
			    <if test="codEntidad != null">
			      AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
			    </if>
			    <if test="codDepartamento != null">
			        AND D.COD_DEPARTAMENTO =  #{codDepartamento,jdbcType=NUMERIC}
			    </if>
	            <if test="codMunicipio != null">
	               AND M.COD_MUNICIPIO =  #{codMunicipio,jdbcType=NUMERIC}
	            </if>
	            <if test="expuestoPoliticamente != null">
	              AND P.EXPUESTO_POLITICAMENTE = #{expuestoPoliticamente,jdbcType=NUMERIC}
	            </if>
          )
			    GROUP BY COD_TABLA_PARAMETRICA , TIPO_CONTRATO
			    ORDER BY TOTAL_REGISTROS DESC
  </select>
  
  <select id="selectUsuarioExt" parameterType="co.gov.dafp.sigep2.bean.UsuarioEntidad" resultMap="BaseResultMapExt">
     SELECT
		  us.*,
		  ure.COD_ROL,
		  pa.NOMBRE_PARAMETRO as TIPO_ASOCIACION,
		  ue.COD_TIPO_VINCULACION,
		  enti.NOMBRE_ENTIDAD
		FROM USUARIO us INNER JOIN USUARIO_ENTIDAD ue ON us.COD_USUARIO = ue.COD_USUARIO
		  INNER JOIN USUARIO_ROL_ENTIDAD ure ON ue.COD_USUARIO_ENTIDAD = ure.COD_USUARIO_ENTIDAD
		  INNER JOIN PARAMETRICA pa ON ue.COD_TIPO_VINCULACION = pa.COD_TABLA_PARAMETRICA
		  INNER JOIN ENTIDAD enti ON ue.COD_ENTIDAD = enti.COD_ENTIDAD
		WHERE us.COD_PERSONA = #{codUsuario,jdbcType=NUMERIC} 
		AND ue.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC} 
		AND ue.FLG_ACTIVO = 1 
		LIMIT 1
  </select>
  
  <select id="selectLogin" parameterType="co.gov.dafp.sigep2.bean.Usuario" resultMap="BaseResultMapExt">
    select
    ROL.COD_ROL,
    P.COD_TIPO_IDENTIFICACION,
    USUARIO.COD_USUARIO,
    USUARIO.COD_PERSONA,
    USUARIO.CONTRASENA,
    USUARIO.FLG_BLOQUEADO,
    USUARIO.FLG_ESTADO,
    USUARIO.FLG_ACEPTO_HABEAS_DATA,
    USUARIO.FECHA_ACEPTO_HABEAS,
    USUARIO.FECHA_VENCE,
    USUARIO.NUMERO_REINTENTOS,
    USUARIO.AUD_COD_USUARIO,
    USUARIO.AUD_COD_ROL,
    e.flg_activo 
	FROM USUARIO
    INNER JOIN PERSONA P on USUARIO.COD_PERSONA = P.COD_PERSONA
    INNER JOIN USUARIO_ENTIDAD E on USUARIO.COD_USUARIO = E.COD_USUARIO
    INNER JOIN USUARIO_ROL_ENTIDAD ROL on E.COD_USUARIO_ENTIDAD = ROL.COD_USUARIO_ENTIDAD
	WHERE USUARIO.COD_PERSONA = P.COD_PERSONA
	AND UPPER(USUARIO.NOMBRE_USUARIO) = UPPER(#{nombreUsuario,jdbcType=VARCHAR})
	AND P.COD_TIPO_IDENTIFICACION = #{codTipoIdentificacion,jdbcType=NUMERIC}
	ORDER BY usuario.aud_fecha_actualizacion, ROL.COD_ROL DESC
    OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
  </select>
  
  <select id="selectLoginWeb" parameterType="co.gov.dafp.sigep2.bean.Usuario" resultMap="BaseResultMapExt">
    select u.cod_usuario, u.cod_persona, u.nombre_usuario, p.primer_nombre || ' ' || p.segundo_nombre || ' ' || p.primer_apellido || ' ' || p.segundo_apellido nombre_persona, 
	  p.cod_tipo_identificacion, 
	  u.contrasena, u.numero_reintentos, 
	  u.numero_sesiones_activas, 
	  u.flg_bloqueado, u.flg_acepto_habeas_data, 
	  u.fecha_acepto_habeas, 
	  p.correo_electronico, 
	  u.fecha_vence, u.fecha_ultimo_ingreso, 
	  u.ip_autorizada, u.mac_autorizada, 
	  u.ticket, u.flg_es_interno, u.flg_estado
	from usuario u 
  	inner join persona p on u.cod_persona = p.cod_persona 
  	inner join v_tipo_documento td on p.cod_tipo_identificacion = td.tipo_documento_id 
 	where (UPPER(u.nombre_usuario) = COALESCE(#{codTipoIdentificacion,jdbcType=NUMERIC}, UPPER(u.nombre_usuario)) 
        and p.cod_tipo_identificacion = COALESCE(#{nombreUsuario,jdbcType=VARCHAR}, p.cod_tipo_identificacion))
    OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
  </select>
  
  <select id="selectUserPassword" parameterType="co.gov.dafp.sigep2.bean.Usuario" resultMap="BaseResultMap">
   
    SELECT U.COD_USUARIO, U.FLG_BLOQUEADO, U.NOMBRE_USUARIO, (P.PRIMER_NOMBRE || ' ' || P.SEGUNDO_NOMBRE || ' ' || P.PRIMER_APELLIDO || ' ' || P.SEGUNDO_APELLIDO) AS NOMBRE_PERSONA,     P.CORREO_ELECTRONICO, U.CONTRASENA, U.FECHA_VENCE, U.TICKET, U.FLG_ES_INTERNO, U.FLG_ESTADO
    FROM USUARIO U INNER JOIN PERSONA P ON U.NOMBRE_USUARIO = P.NUMERO_IDENTIFICACION INNER JOIN V_TIPO_DOCUMENTO TD ON P.COD_TIPO_IDENTIFICACION = TD.TIPO_DOCUMENTO_ID
    WHERE U.NOMBRE_USUARIO = #{nombreUsuario,jdbcType=VARCHAR} AND P.COD_TIPO_IDENTIFICACION =  #{codTipoIdentificacion,jdbcType=NUMERIC}
  </select>
  <select id="selectByPrimaryKey" parameterType="java.math.BigDecimal" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from USUARIO
    where COD_USUARIO = #{codUsuario,jdbcType=NUMERIC}
  </select>
  <select id="selectByticket" parameterType="co.gov.dafp.sigep2.bean.Usuario" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from USUARIO
    where TICKET = #{ticket,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    delete from USUARIO
    where COD_USUARIO = #{codUsuario,jdbcType=NUMERIC}
  </delete>
  <delete id="deleteByExample" parameterType="co.gov.dafp.sigep2.bean.UsuarioExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    delete from USUARIO
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="co.gov.dafp.sigep2.bean.Usuario">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    insert into USUARIO (COD_PERSONA, NOMBRE_USUARIO, 
      CONTRASENA, NUMERO_REINTENTOS, NUMERO_SESIONES_ACTIVAS, 
      FLG_BLOQUEADO, FLG_ACEPTO_HABEAS_DATA, FECHA_ACEPTO_HABEAS, 
      FECHA_VENCE, FECHA_ULTIMO_INGRESO, IP_AUTORIZADA, 
      MAC_AUTORIZADA, TICKET, FLG_ES_INTERNO, 
      FLG_ESTADO, AUD_FECHA_ACTUALIZACION, AUD_COD_USUARIO, 
      AUD_COD_ROL, AUD_ACCION, FECHA_ACTIVACION
      )
    values (#{codPersona,jdbcType=NUMERIC}, #{nombreUsuario,jdbcType=VARCHAR}, 
      #{contrasena,jdbcType=VARCHAR}, #{numeroReintentos,jdbcType=NUMERIC}, #{numeroSesionesActivas,jdbcType=NUMERIC}, 
      #{flgBloqueado,jdbcType=NUMERIC}, #{flgAceptoHabeasData,jdbcType=NUMERIC}, #{fechaAceptoHabeas,jdbcType=TIMESTAMP}, 
      #{fechaVence,jdbcType=TIMESTAMP}, #{fechaUltimoIngreso,jdbcType=TIMESTAMP}, #{ipAutorizada,jdbcType=VARCHAR}, 
      #{macAutorizada,jdbcType=VARCHAR}, #{ticket,jdbcType=VARCHAR}, #{flgEsInterno,jdbcType=NUMERIC}, 
      #{flgEstado,jdbcType=NUMERIC}, #{audFechaActualizacion,jdbcType=TIMESTAMP}, #{audCodUsuario,jdbcType=NUMERIC}, 
      #{audCodRol,jdbcType=NUMERIC}, #{audAccion,jdbcType=NUMERIC}, #{fechaActivacion,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="co.gov.dafp.sigep2.bean.Usuario">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    insert into USUARIO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="codUsuario != null">
        COD_USUARIO,
      </if>
      <if test="codPersona != null">
        COD_PERSONA,
      </if>
      <if test="nombreUsuario != null">
        NOMBRE_USUARIO,
      </if>
      <if test="contrasena != null">
        CONTRASENA,
      </if>
      <if test="numeroReintentos != null">
        NUMERO_REINTENTOS,
      </if>
      <if test="numeroSesionesActivas != null">
        NUMERO_SESIONES_ACTIVAS,
      </if>
      <if test="flgBloqueado != null">
        FLG_BLOQUEADO,
      </if>
      <if test="flgAceptoHabeasData != null">
        FLG_ACEPTO_HABEAS_DATA,
      </if>
      <if test="fechaAceptoHabeas != null">
        FECHA_ACEPTO_HABEAS,
      </if>
      <if test="fechaVence != null">
        FECHA_VENCE,
      </if>
      <if test="fechaUltimoIngreso != null">
        FECHA_ULTIMO_INGRESO,
      </if>
      <if test="ipAutorizada != null">
        IP_AUTORIZADA,
      </if>
      <if test="macAutorizada != null">
        MAC_AUTORIZADA,
      </if>
      <if test="ticket != null">
        TICKET,
      </if>
      <if test="flgEsInterno != null">
        FLG_ES_INTERNO,
      </if>
      <if test="flgEstado != null">
        FLG_ESTADO,
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION,
      </if>
      <if test="audCodUsuario != null">
        AUD_COD_USUARIO,
      </if>
      <if test="audCodRol != null">
        AUD_COD_ROL,
      </if>
      <if test="audAccion != null">
        AUD_ACCION,
      </if>
      <if test="fechaActivacion != null">
        FECHA_ACTIVACION,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="codUsuario != null">
        #{codUsuario,jdbcType=NUMERIC},
      </if>
      <if test="codPersona != null">
        #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="nombreUsuario != null">
        #{nombreUsuario,jdbcType=VARCHAR},
      </if>
      <if test="contrasena != null">
        #{contrasena,jdbcType=VARCHAR},
      </if>
      <if test="numeroReintentos != null">
        #{numeroReintentos,jdbcType=NUMERIC},
      </if>
      <if test="numeroSesionesActivas != null">
        #{numeroSesionesActivas,jdbcType=NUMERIC},
      </if>
      <if test="flgBloqueado != null">
        #{flgBloqueado,jdbcType=NUMERIC},
      </if>
      <if test="flgAceptoHabeasData != null">
        #{flgAceptoHabeasData,jdbcType=NUMERIC},
      </if>
      <if test="fechaAceptoHabeas != null">
        #{fechaAceptoHabeas,jdbcType=TIMESTAMP},
      </if>
      <if test="fechaVence != null">
        #{fechaVence,jdbcType=TIMESTAMP},
      </if>
      <if test="fechaUltimoIngreso != null">
        #{fechaUltimoIngreso,jdbcType=TIMESTAMP},
      </if>
      <if test="ipAutorizada != null">
        #{ipAutorizada,jdbcType=VARCHAR},
      </if>
      <if test="macAutorizada != null">
        #{macAutorizada,jdbcType=VARCHAR},
      </if>
      <if test="ticket != null">
        #{ticket,jdbcType=VARCHAR},
      </if>
      <if test="flgEsInterno != null">
        #{flgEsInterno,jdbcType=NUMERIC},
      </if>
      <if test="flgEstado != null">
        #{flgEstado,jdbcType=NUMERIC},
      </if>
      <if test="audFechaActualizacion != null">
        #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="audCodUsuario != null">
        #{audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="audCodRol != null">
        #{audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="audAccion != null">
        #{audAccion,jdbcType=NUMERIC},
      </if>
      <if test="fechaActivacion != null">
        #{fechaActivacion,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="co.gov.dafp.sigep2.bean.UsuarioExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    select count(*) from USUARIO
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    update USUARIO
    <set>
      <if test="record.codUsuario != null">
        COD_USUARIO = #{record.codUsuario,jdbcType=NUMERIC},
      </if>
      <if test="record.codPersona != null">
        COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      </if>
      <if test="record.nombreUsuario != null">
        NOMBRE_USUARIO = #{record.nombreUsuario,jdbcType=VARCHAR},
      </if>
      <if test="record.contrasena != null">
        CONTRASENA = #{record.contrasena,jdbcType=VARCHAR},
      </if>
      <if test="record.numeroReintentos != null">
        NUMERO_REINTENTOS = #{record.numeroReintentos,jdbcType=NUMERIC},
      </if>
      <if test="record.numeroSesionesActivas != null">
        NUMERO_SESIONES_ACTIVAS = #{record.numeroSesionesActivas,jdbcType=NUMERIC},
      </if>
      <if test="record.flgBloqueado != null">
        FLG_BLOQUEADO = #{record.flgBloqueado,jdbcType=NUMERIC},
      </if>
      <if test="record.flgAceptoHabeasData != null">
        FLG_ACEPTO_HABEAS_DATA = #{record.flgAceptoHabeasData,jdbcType=NUMERIC},
      </if>
      <if test="record.fechaAceptoHabeas != null">
        FECHA_ACEPTO_HABEAS = #{record.fechaAceptoHabeas,jdbcType=TIMESTAMP},
      </if>
      <if test="record.fechaVence != null">
        FECHA_VENCE = #{record.fechaVence,jdbcType=TIMESTAMP},
      </if>
      <if test="record.fechaUltimoIngreso != null">
        FECHA_ULTIMO_INGRESO = #{record.fechaUltimoIngreso,jdbcType=TIMESTAMP},
      </if>
      <if test="record.ipAutorizada != null">
        IP_AUTORIZADA = #{record.ipAutorizada,jdbcType=VARCHAR},
      </if>
      <if test="record.macAutorizada != null">
        MAC_AUTORIZADA = #{record.macAutorizada,jdbcType=VARCHAR},
      </if>
      <if test="record.ticket != null">
        TICKET = #{record.ticket,jdbcType=VARCHAR},
      </if>
      <if test="record.flgEsInterno != null">
        FLG_ES_INTERNO = #{record.flgEsInterno,jdbcType=NUMERIC},
      </if>
      <if test="record.flgEstado != null">
        FLG_ESTADO = #{record.flgEstado,jdbcType=NUMERIC},
      </if>
      <if test="record.audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="record.audCodUsuario != null">
        AUD_COD_USUARIO = #{record.audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="record.audCodRol != null">
        AUD_COD_ROL = #{record.audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="record.audAccion != null">
        AUD_ACCION = #{record.audAccion,jdbcType=NUMERIC},
      </if>
      <if test="record.fechaActivacion != null">
        FECHA_ACTIVACION = #{record.fechaActivacion,jdbcType=TIMESTAMP},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    update USUARIO
    set COD_USUARIO = #{record.codUsuario,jdbcType=NUMERIC},
      COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      NOMBRE_USUARIO = #{record.nombreUsuario,jdbcType=VARCHAR},
      CONTRASENA = #{record.contrasena,jdbcType=VARCHAR},
      NUMERO_REINTENTOS = #{record.numeroReintentos,jdbcType=NUMERIC},
      NUMERO_SESIONES_ACTIVAS = #{record.numeroSesionesActivas,jdbcType=NUMERIC},
      FLG_BLOQUEADO = #{record.flgBloqueado,jdbcType=NUMERIC},
      FLG_ACEPTO_HABEAS_DATA = #{record.flgAceptoHabeasData,jdbcType=NUMERIC},
      FECHA_ACEPTO_HABEAS = #{record.fechaAceptoHabeas,jdbcType=TIMESTAMP},
      FECHA_VENCE = #{record.fechaVence,jdbcType=TIMESTAMP},
      FECHA_ULTIMO_INGRESO = #{record.fechaUltimoIngreso,jdbcType=TIMESTAMP},
      IP_AUTORIZADA = #{record.ipAutorizada,jdbcType=VARCHAR},
      MAC_AUTORIZADA = #{record.macAutorizada,jdbcType=VARCHAR},
      TICKET = #{record.ticket,jdbcType=VARCHAR},
      FLG_ES_INTERNO = #{record.flgEsInterno,jdbcType=NUMERIC},
      FLG_ESTADO = #{record.flgEstado,jdbcType=NUMERIC},
      AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      AUD_COD_USUARIO = #{record.audCodUsuario,jdbcType=NUMERIC},
      AUD_COD_ROL = #{record.audCodRol,jdbcType=NUMERIC},
      AUD_ACCION = #{record.audAccion,jdbcType=NUMERIC},
      FECHA_ACTIVACION = #{record.fechaActivacion,jdbcType=TIMESTAMP}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="co.gov.dafp.sigep2.bean.Usuario">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    update USUARIO
    <set>
      <if test="codPersona != null">
        COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="nombreUsuario != null">
        NOMBRE_USUARIO = #{nombreUsuario,jdbcType=VARCHAR},
      </if>
      <if test="contrasena != null">
        CONTRASENA = #{contrasena,jdbcType=VARCHAR},
      </if>
      <if test="numeroReintentos != null">
        NUMERO_REINTENTOS = #{numeroReintentos,jdbcType=NUMERIC},
      </if>
      <if test="numeroSesionesActivas != null">
        NUMERO_SESIONES_ACTIVAS = #{numeroSesionesActivas,jdbcType=NUMERIC},
      </if>
      <if test="flgBloqueado != null">
        FLG_BLOQUEADO = #{flgBloqueado,jdbcType=NUMERIC},
      </if>
      <if test="flgAceptoHabeasData != null">
        FLG_ACEPTO_HABEAS_DATA = #{flgAceptoHabeasData,jdbcType=NUMERIC},
      </if>
      <if test="fechaAceptoHabeas != null">
        FECHA_ACEPTO_HABEAS = #{fechaAceptoHabeas,jdbcType=TIMESTAMP},
      </if>
      <if test="fechaVence != null">
        FECHA_VENCE = #{fechaVence,jdbcType=TIMESTAMP},
      </if>
      <if test="fechaUltimoIngreso != null">
        FECHA_ULTIMO_INGRESO = #{fechaUltimoIngreso,jdbcType=TIMESTAMP},
      </if>
      <if test="ipAutorizada != null">
        IP_AUTORIZADA = #{ipAutorizada,jdbcType=VARCHAR},
      </if>
      <if test="macAutorizada != null">
        MAC_AUTORIZADA = #{macAutorizada,jdbcType=VARCHAR},
      </if>
      <if test="ticket != null">
        TICKET = #{ticket,jdbcType=VARCHAR},
      </if>
      <if test="flgEsInterno != null">
        FLG_ES_INTERNO = #{flgEsInterno,jdbcType=NUMERIC},
      </if>
      <if test="flgEstado != null">
        FLG_ESTADO = #{flgEstado,jdbcType=NUMERIC},
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="audCodUsuario != null">
        AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="audCodRol != null">
        AUD_COD_ROL = #{audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="audAccion != null">
        AUD_ACCION = #{audAccion,jdbcType=NUMERIC},
      </if>
      <if test="fechaActivacion != null">
        FECHA_ACTIVACION = #{fechaActivacion,jdbcType=TIMESTAMP},
      </if>
    </set>
    where COD_USUARIO = #{codUsuario,jdbcType=NUMERIC}
  </update>
  <update id="updateByPrimaryKey" parameterType="co.gov.dafp.sigep2.bean.Usuario">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 25 12:04:19 COT 2018.
    -->
    update USUARIO
    set COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      NOMBRE_USUARIO = #{nombreUsuario,jdbcType=VARCHAR},
      CONTRASENA = #{contrasena,jdbcType=VARCHAR},
      NUMERO_REINTENTOS = #{numeroReintentos,jdbcType=NUMERIC},
      NUMERO_SESIONES_ACTIVAS = #{numeroSesionesActivas,jdbcType=NUMERIC},
      FLG_BLOQUEADO = #{flgBloqueado,jdbcType=NUMERIC},
      FLG_ACEPTO_HABEAS_DATA = #{flgAceptoHabeasData,jdbcType=NUMERIC},
      FECHA_ACEPTO_HABEAS = #{fechaAceptoHabeas,jdbcType=TIMESTAMP},
      FECHA_VENCE = #{fechaVence,jdbcType=TIMESTAMP},
      FECHA_ULTIMO_INGRESO = #{fechaUltimoIngreso,jdbcType=TIMESTAMP},
      IP_AUTORIZADA = #{ipAutorizada,jdbcType=VARCHAR},
      MAC_AUTORIZADA = #{macAutorizada,jdbcType=VARCHAR},
      TICKET = #{ticket,jdbcType=VARCHAR},
      FLG_ES_INTERNO = #{flgEsInterno,jdbcType=NUMERIC},
      FLG_ESTADO = #{flgEstado,jdbcType=NUMERIC},
      AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
      AUD_COD_ROL = #{audCodRol,jdbcType=NUMERIC},
      AUD_ACCION = #{audAccion,jdbcType=NUMERIC},
      FECHA_ACTIVACION = #{fechaActivacion,jdbcType=TIMESTAMP}
    where COD_USUARIO = #{codUsuario,jdbcType=NUMERIC}
  </update>
  <update id="guardarPing" parameterType="co.gov.dafp.sigep2.bean.Usuario">
  		UPDATE USUARIO SET TICKET = #{ticket,jdbcType=VARCHAR}, 
  		                   AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP}
               WHERE COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
  </update>
  
  <update id="recuperarContrasena" parameterType="co.gov.dafp.sigep2.bean.Usuario">
  		UPDATE USUARIO SET NUMERO_REINTENTOS = 0,
  		           CONTRASENA = #{contrasena,jdbcType=VARCHAR},
  		           FLG_BLOQUEADO = 0,
  		           FECHA_VENCE = NULL,
  		           AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP}
               WHERE TICKET = #{ticket,jdbcType=VARCHAR}
                    AND NOMBRE_USUARIO = #{nombreUsuario,jdbcType=VARCHAR}
  </update>
  
   <select id="selectByUsuarioRolOP" parameterType="co.gov.dafp.sigep2.bean.Usuario" resultMap="BaseResultMapExt">
   select  ue.cod_entidad, ure.cod_rol, ue.cod_usuario from usuario_rol_entidad ure
         inner join usuario_entidad ue on ure.cod_usuario_entidad = ue.cod_usuario_entidad
         inner join usuario u on u.cod_usuario = ue.cod_usuario
        where u.cod_usuario = #{codUsuario,jdbcType=NUMERIC}
        and ure.flg_estado = 1
        and ure.flg_activo = 1
  </select>
  
   <update id="updateRolOP" parameterType="java.math.BigDecimal">
  		UPDATE usuario  set FLG_ES_INTERNO = 0 where cod_usuario =  #{codUsuario,jdbcType=NUMERIC}
  </update>
  
  <select id="selectUsuarioByPersona" parameterType="co.gov.dafp.sigep2.bean.ext.UsuarioExt" resultMap="BaseResultMap">
   	select u.* 
   	from usuario u
	inner join persona p on p.cod_persona = u.cod_persona
	where p.numero_identificacion = #{numeroIdentificacionPersona,jdbcType=VARCHAR}
	and p.cod_tipo_identificacion = #{codTipoIdentificacionPersona,jdbcType=NUMERIC}
  </select>
  
  <select id="selectUsuarioAdmin" parameterType="co.gov.dafp.sigep2.bean.ext.UsuarioExt" resultMap="BaseResultMapExt">
	select count(1) cantidad_roles
	from persona p
	inner join usuario u on u.cod_persona = p.cod_persona
	inner join usuario_entidad ue on ue.cod_usuario = u.cod_usuario
	inner join usuario_rol_entidad ure on ure.cod_usuario_entidad = ue.cod_usuario_entidad
	where p.numero_identificacion = #{numeroIdentificacionPersona,jdbcType=VARCHAR}
	and p.cod_tipo_identificacion = #{codTipoIdentificacionPersona,jdbcType=NUMERIC}
	and ure.flg_activo = 1
	and ue.flg_activo = 1
and ure.cod_rol in (18, 14, 16, 6, 15, 17, 10, 8)
  </select>
  
</mapper>