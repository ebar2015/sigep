<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.gov.dafp.sigep2.interfaces.PlantaPersonaUtlUanMapper">
  <resultMap id="BaseResultMap" type="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    	<id column="COD_PLANTA_PERSONA_UTL_UAN" jdbcType="NUMERIC" property="codPlantaPersonaUtlUan" />
	    <result column="COD_ENTIDAD_PLANTA" jdbcType="NUMERIC" property="codEntidadPlanta" />
	    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
	    <result column="COD_AUD_ACCION" jdbcType="NUMERIC" property="codAudAccion" />
	    <result column="COD_AUD_ROL" jdbcType="NUMERIC" property="codAudRol" />
	    <result column="COD_AUD_USUARIO" jdbcType="NUMERIC" property="codAudUsuario" />
	    <result column="FLG_ACTIVO" jdbcType="NUMERIC" property="flgActivo" />
	    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
  </resultMap>
  <resultMap id="BaseResultMapExt" type="co.gov.dafp.sigep2.bean.ext.PlantaPersonaUtlUanExt">
  		<id column="COD_PLANTA_PERSONA_UTL_UAN" jdbcType="NUMERIC" property="codPlantaPersonaUtlUan" />
	 	<result column="COD_ENTIDAD_PLANTA" jdbcType="NUMERIC" property="codEntidadPlanta" />
	   	<result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
	   	<result column="COD_AUD_ACCION" jdbcType="NUMERIC" property="codAudAccion" />
	   	<result column="COD_AUD_ROL" jdbcType="NUMERIC" property="codAudRol" />
	   	<result column="COD_AUD_USUARIO" jdbcType="NUMERIC" property="codAudUsuario" />
	   	<result column="FLG_ACTIVO" jdbcType="NUMERIC" property="flgActivo" />
	   	<result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
   
    	<result column="NOMBRE_RESPONSABLE" jdbcType="VARCHAR" property="nombreResponsable" />
    	<result column="SALARIO_GASTADO" jdbcType="NUMERIC" property="salarioGastado" />
    	<result column="CARGOS_OCUPADOS" jdbcType="NUMERIC" property="cargosOcupados" />
    	<result column="COD_PERSONA_RESPONSABLE" jdbcType="NUMERIC" property="codPersonaResponsable" />
    	<result column="COD_PERSONA_VINCULADA" jdbcType="NUMERIC" property="codPersonaVinculada" />
    	<result column="cantidad_salarios_utl" jdbcType="NUMERIC" property="cantidadSalariosUTL" />
    	<result column="cantidad_colaboradores_utl" jdbcType="NUMERIC" property="cantidadColaboradoresUTL" />
    	
    	
    
    
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    COD_PLANTA_PERSONA_UTL_UAN, COD_ENTIDAD_PLANTA, COD_PERSONA, COD_AUD_ACCION, COD_AUD_ROL, 
    COD_AUD_USUARIO, FLG_ACTIVO, AUD_FECHA_ACTUALIZACION
  </sql>
  <select id="selectByExample" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUanExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from PLANTA_PERSONA_UTL_UAN
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from PLANTA_PERSONA_UTL_UAN
    where COD_PLANTA_PERSONA_UTL_UAN = #{codPlantaPersonaUtlUan,jdbcType=NUMERIC}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    delete from PLANTA_PERSONA_UTL_UAN
    where COD_PLANTA_PERSONA_UTL_UAN = #{codPlantaPersonaUtlUan,jdbcType=NUMERIC}
  </delete>
  <delete id="deleteByExample" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUanExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    delete from PLANTA_PERSONA_UTL_UAN
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    insert into PLANTA_PERSONA_UTL_UAN (COD_ENTIDAD_PLANTA, 
      COD_PERSONA, COD_AUD_ACCION, COD_AUD_ROL, 
      COD_AUD_USUARIO, FLG_ACTIVO, AUD_FECHA_ACTUALIZACION
      )
    values (#{codEntidadPlanta,jdbcType=NUMERIC}, 
      #{codPersona,jdbcType=NUMERIC}, #{codAudAccion,jdbcType=NUMERIC}, #{codAudRol,jdbcType=NUMERIC}, 
      #{codAudUsuario,jdbcType=NUMERIC}, #{flgActivo,jdbcType=NUMERIC}, #{audFechaActualizacion,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    insert into PLANTA_PERSONA_UTL_UAN
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="codPlantaPersonaUtlUan != null">
        COD_PLANTA_PERSONA_UTL_UAN,
      </if>
      <if test="codEntidadPlanta != null">
        COD_ENTIDAD_PLANTA,
      </if>
      <if test="codPersona != null">
        COD_PERSONA,
      </if>
      <if test="codAudAccion != null">
        COD_AUD_ACCION,
      </if>
      <if test="codAudRol != null">
        COD_AUD_ROL,
      </if>
      <if test="codAudUsuario != null">
        COD_AUD_USUARIO,
      </if>
      <if test="flgActivo != null">
        FLG_ACTIVO,
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="codPlantaPersonaUtlUan != null">
        #{codPlantaPersonaUtlUan,jdbcType=NUMERIC},
      </if>
      <if test="codEntidadPlanta != null">
        #{codEntidadPlanta,jdbcType=NUMERIC},
      </if>
      <if test="codPersona != null">
        #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="codAudAccion != null">
        #{codAudAccion,jdbcType=NUMERIC},
      </if>
      <if test="codAudRol != null">
        #{codAudRol,jdbcType=NUMERIC},
      </if>
      <if test="codAudUsuario != null">
        #{codAudUsuario,jdbcType=NUMERIC},
      </if>
      <if test="flgActivo != null">
        #{flgActivo,jdbcType=NUMERIC},
      </if>
      <if test="audFechaActualizacion != null">
        #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUanExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    select count(*) from PLANTA_PERSONA_UTL_UAN
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    update PLANTA_PERSONA_UTL_UAN
    <set>
      <if test="record.codPlantaPersonaUtlUan != null">
        COD_PLANTA_PERSONA_UTL_UAN = #{record.codPlantaPersonaUtlUan,jdbcType=NUMERIC},
      </if>
      <if test="record.codEntidadPlanta != null">
        COD_ENTIDAD_PLANTA = #{record.codEntidadPlanta,jdbcType=NUMERIC},
      </if>
      <if test="record.codPersona != null">
        COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      </if>
      <if test="record.codAudAccion != null">
        COD_AUD_ACCION = #{record.codAudAccion,jdbcType=NUMERIC},
      </if>
      <if test="record.codAudRol != null">
        COD_AUD_ROL = #{record.codAudRol,jdbcType=NUMERIC},
      </if>
      <if test="record.codAudUsuario != null">
        COD_AUD_USUARIO = #{record.codAudUsuario,jdbcType=NUMERIC},
      </if>
      <if test="record.flgActivo != null">
        FLG_ACTIVO = #{record.flgActivo,jdbcType=NUMERIC},
      </if>
      <if test="record.audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    update PLANTA_PERSONA_UTL_UAN
    set COD_PLANTA_PERSONA_UTL_UAN = #{record.codPlantaPersonaUtlUan,jdbcType=NUMERIC},
      COD_ENTIDAD_PLANTA = #{record.codEntidadPlanta,jdbcType=NUMERIC},
      COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      COD_AUD_ACCION = #{record.codAudAccion,jdbcType=NUMERIC},
      COD_AUD_ROL = #{record.codAudRol,jdbcType=NUMERIC},
      COD_AUD_USUARIO = #{record.codAudUsuario,jdbcType=NUMERIC},
      FLG_ACTIVO = #{record.flgActivo,jdbcType=NUMERIC},
      AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    update PLANTA_PERSONA_UTL_UAN
    <set>
      <if test="codEntidadPlanta != null">
        COD_ENTIDAD_PLANTA = #{codEntidadPlanta,jdbcType=NUMERIC},
      </if>
      <if test="codPersona != null">
        COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="codAudAccion != null">
        COD_AUD_ACCION = #{codAudAccion,jdbcType=NUMERIC},
      </if>
      <if test="codAudRol != null">
        COD_AUD_ROL = #{codAudRol,jdbcType=NUMERIC},
      </if>
      <if test="codAudUsuario != null">
        COD_AUD_USUARIO = #{codAudUsuario,jdbcType=NUMERIC},
      </if>
      <if test="flgActivo != null">
        FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC},
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
    </set>
    where COD_PLANTA_PERSONA_UTL_UAN = #{codPlantaPersonaUtlUan,jdbcType=NUMERIC}
  </update>
  <update id="updateByPrimaryKey" parameterType="co.gov.dafp.sigep2.bean.PlantaPersonaUtlUan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 12 14:33:17 COT 2018.
    -->
    update PLANTA_PERSONA_UTL_UAN
    set COD_ENTIDAD_PLANTA = #{codEntidadPlanta,jdbcType=NUMERIC},
      COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      COD_AUD_ACCION = #{codAudAccion,jdbcType=NUMERIC},
      COD_AUD_ROL = #{codAudRol,jdbcType=NUMERIC},
      COD_AUD_USUARIO = #{codAudUsuario,jdbcType=NUMERIC},
      FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC},
      AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP}
    where COD_PLANTA_PERSONA_UTL_UAN = #{codPlantaPersonaUtlUan,jdbcType=NUMERIC}
  </update>
  <select id="selectByFiltro" parameterType="co.gov.dafp.sigep2.bean.ext.PlantaPersonaUtlUanExt" resultMap="BaseResultMapExt">
    select uan.*, p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO NOMBRE_RESPONSABLE,
     (select COALESCE(sum(salario),0) salario_gastado from HOJA_VIDA hv
            WHERE  hv.flg_activo = 1
            AND hv.COD_UTL_UAN = uan.cod_planta_persona_utl_uan) salario_gastado,
      (select count(1)  from HOJA_VIDA hv
            WHERE  hv.flg_activo = 1
            AND hv.COD_UTL_UAN = uan.cod_planta_persona_utl_uan) cargos_ocupados,
      ep.cantidad_salarios_utl, ep.cantidad_colaboradores_utl
    from planta_persona_utl_uan uan
    inner JOIN entidad_planta ep on ep.cod_entidad_planta = uan.cod_entidad_planta
    left join persona p on p.cod_persona = uan.cod_persona
    WHERE 1 = 1
      <if test="codPlantaPersonaUtlUan != null">
        AND uan.COD_PLANTA_PERSONA_UTL_UAN = #{codPlantaPersonaUtlUan,jdbcType=NUMERIC}
      </if>
      <if test="codEntidadPlanta != null">
        AND uan.COD_ENTIDAD_PLANTA = #{codEntidadPlanta,jdbcType=NUMERIC}
      </if>
      <if test="codPersona != null">
        AND uan.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
      </if>
      <if test="codAudAccion != null">
        AND uan.COD_AUD_ACCION = #{codAudAccion,jdbcType=NUMERIC}
      </if>
      <if test="codAudRol != null">
        AND uan.COD_AUD_ROL = #{codAudRol,jdbcType=NUMERIC}
      </if>
      <if test="codAudUsuario != null">
        AND uan.COD_AUD_USUARIO = #{codAudUsuario,jdbcType=NUMERIC}
      </if>
      <if test="flgActivo != null">
        AND uan.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
      </if>
      <if test="audFechaActualizacion != null">
        AND uan.AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP}
      </if>
      <if test="codEntidad != null">
        AND ep.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
      </if>
      <if test="flgGuardadoParcialPlanta != null">
        AND ep.FLG_GUARDADO_PARCIAL= #{flgGuardadoParcialPlanta,jdbcType=NUMERIC}
      </if>
      order by NOMBRE_RESPONSABLE asc
  </select>
  <select id="selectExcedenteBolsaUTL" parameterType="co.gov.dafp.sigep2.bean.ext.PlantaPersonaUtlUanExt" resultMap="BaseResultMapExt">
  	SELECT * FROM (
    SELECT UAN.*,
    (SELECT COUNT(1) FROM HOJA_VIDA HV WHERE HV.FLG_ACTIVO = 1 AND HV.cod_utl_uan = UAN.COD_PLANTA_PERSONA_UTL_UAN) cargos_ocupados,
     (SELECT COALESCE(sum(salario),0) FROM HOJA_VIDA HV WHERE HV.FLG_ACTIVO = 1 AND HV.cod_utl_uan = UAN.COD_PLANTA_PERSONA_UTL_UAN ) salario_gastado,
     p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO NOMBRE_RESPONSABLE
    FROM planta_persona_utl_uan UAN
    INNER JOIN PERSONA P ON P.COD_PERSONA = UAN.COD_PERSONA
    WHERE UAN.COD_ENTIDAD_PLANTA = #{codEntidadPlanta,jdbcType=NUMERIC})
	WHERE 1= 1
	<if test="cantidadColaboradoresUTL != null"> 
	  AND cargos_ocupados &gt; #{cantidadColaboradoresUTL,jdbcType=NUMERIC}  
	</if>
	<if test="montoMaximo != null"> 
	  AND salario_gastado &gt; #{montoMaximo,jdbcType=NUMERIC}  
	</if>
  </select>
  <select id="selectPersonasVinculadasUTL" parameterType="co.gov.dafp.sigep2.bean.ext.PlantaPersonaUtlUanExt" resultMap="BaseResultMapExt">
  	select  uan.cod_persona cod_persona_responsable , hv.cod_persona cod_persona_vinculada
	    from hoja_vida hv
	    inner join planta_persona_utl_uan uan on uan.cod_planta_persona_utl_uan = hv.cod_utl_uan
	    where 1=1
	    and hv.flg_activo = 1
	    and uan.flg_activo = 1
	    and uan.COD_ENTIDAD_PLANTA = #{codEntidadPlanta,jdbcType=NUMERIC}
	    order by cod_persona_responsable asc
  </select>
</mapper>