<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.gov.dafp.sigep2.interfaces.VinculacionMapper">
  <resultMap id="BaseResultMap" type="co.gov.dafp.sigep2.bean.Vinculacion">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:11 COT 2018.
    -->
    <id column="COD_VINCULACION" jdbcType="NUMERIC" property="codVinculacion" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="COD_ENTIDAD_PLANTA_DETALLE" jdbcType="NUMERIC" property="codEntidadPlantaDetalle" />
    <result column="COD_DEPENDENCIA_ENTIDAD" jdbcType="NUMERIC" property="codDependenciaEntidad" />
    <result column="FECHA_POSESION" jdbcType="TIMESTAMP" property="fechaPosesion" />
    <result column="FECHA_FINALIZACION" jdbcType="TIMESTAMP" property="fechaFinalizacion" />
    <result column="COD_CAUSAL_DESVINCULACION" jdbcType="NUMERIC" property="codCausalDesvinculacion" />
    <result column="COD_TIPO_ACTO_ADMIN_DESVINCULACION" jdbcType="NUMERIC" property="codTipoActoAdminDesvinculacion" />
    <result column="NUM_ACTO_ADMIN_DESVINCULACION" jdbcType="VARCHAR" property="numActoAdminDesvinculacion" />
    <result column="FECHA_ACTO_ADMIN_DESVINCULACION" jdbcType="TIMESTAMP" property="fechaActoAdminDesvinculacion" />
    <result column="FLG_MEDICO_DOCENTE" jdbcType="NUMERIC" property="flgMedicoDocente" />
    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
    <result column="AUD_COD_USUARIO" jdbcType="NUMERIC" property="audCodUsuario" />
    <result column="AUD_COD_ROL" jdbcType="NUMERIC" property="audCodRol" />
    <result column="AUD_ACCION" jdbcType="NUMERIC" property="audAccion" />
    <result column="COD_TIPO_NOMBRAMIENTO" jdbcType="NUMERIC" property="codTipoNombramiento" />
    <result column="FLG_TITULARIDAD_CARGO" jdbcType="NUMERIC" property="flgTitularidadCargo" />
    <result column="FLG_ACTIVO" jdbcType="NUMERIC" property="flgActivo" />
    <result column="FLG_GUARDADO_PARCIAL" jdbcType="NUMERIC" property="flgGuardadoParcial" />
    <result column="FECHA_INACTIVA_USUARIO" jdbcType="TIMESTAMP" property="fechaInactivaUsuario" />
    <result column="FLG_PEP" jdbcType="NUMERIC" property="flgPEP" />
  </resultMap>
  
  <resultMap id="BaseResultMapExt" type="co.gov.dafp.sigep2.bean.ext.VinculacionExt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 13 10:17:58 COT 2018.
    -->
    <id column="COD_VINCULACION" jdbcType="NUMERIC" property="codVinculacion" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="COD_ENTIDAD_PLANTA_DETALLE" jdbcType="NUMERIC" property="codEntidadPlantaDetalle" />
    <result column="COD_DEPENDENCIA_ENTIDAD" jdbcType="NUMERIC" property="codDependenciaEntidad" />
    <result column="FECHA_POSESION" jdbcType="TIMESTAMP" property="fechaPosesion" />
    <result column="FECHA_FINALIZACION" jdbcType="TIMESTAMP" property="fechaFinalizacion" />
    <result column="COD_CAUSAL_DESVINCULACION" jdbcType="NUMERIC" property="codCausalDesvinculacion" />
    <result column="COD_TIPO_ACTO_ADMIN_DESVINCULACION" jdbcType="NUMERIC" property="codTipoActoAdminDesvinculacion" />
    <result column="NUM_ACTO_ADMIN_DESVINCULACION" jdbcType="VARCHAR" property="numActoAdminDesvinculacion" />
    <result column="FECHA_ACTO_ADMIN_DESVINCULACION" jdbcType="TIMESTAMP" property="fechaActoAdminDesvinculacion" />
    <result column="FLG_MEDICO_DOCENTE" jdbcType="NUMERIC" property="flgMedicoDocente" />
    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
    <result column="AUD_COD_USUARIO" jdbcType="NUMERIC" property="audCodUsuario" />
    <result column="AUD_COD_ROL" jdbcType="NUMERIC" property="audCodRol" />
    <result column="AUD_ACCION" jdbcType="NUMERIC" property="audAccion" />
    <result column="COD_TIPO_NOMBRAMIENTO" jdbcType="NUMERIC" property="codTipoNombramiento" />
    <result column="FLG_TITULARIDAD_CARGO" jdbcType="NUMERIC" property="flgTitularidadCargo" />
    <result column="FLG_ACTIVO" jdbcType="NUMERIC" property="flgActivo" />
    <result column="FLG_GUARDADO_PARCIAL" jdbcType="NUMERIC" property="flgGuardadoParcial" />
    <result column="FECHA_INACTIVA_USUARIO" jdbcType="TIMESTAMP" property="fechaInactivaUsuario" />
    <result column="FLG_PEP" jdbcType="NUMERIC" property="flgPEP" />
    
    <!-- CAMPOS QUE SE GENERAN EN EL ARCHIVO DE EXT DE CADA ENTIDAD -->
  	<result column="NOMBRE_TIPO_NOMBRAMIENTO" jdbcType="VARCHAR" property="nombreTipoNombramiento" />
  	<result column="NOMBRE_ENTIDAD" jdbcType="VARCHAR" property="nombreEntidad" />
  	<result column="NOMBRE_DOCUMENTO" jdbcType="VARCHAR" property="nombreDocumento" />
  	<result column="NOMBRE_PLANTA" jdbcType="VARCHAR" property="nombrePlanta" />
  	<result column="NOMBRE_CARGO" jdbcType="VARCHAR" property="nombreCargo" />
  	<result column="NOMBRE_TIPO_ACTO_ADMINISTRATIVO" jdbcType="VARCHAR" property="nombreTipoActoAdministrativo" />
  	<result column="NUMERO_IDENTIFICACION" jdbcType="VARCHAR" property="numeroIdentificacion" />
  	<result column="COD_TIPO_IDENTIFICACION" jdbcType="VARCHAR" property="codTipoIentificacion" />
  	<result column="PRIMER_NOMBRE" jdbcType="VARCHAR" property="primerNombre" />
  	<result column="SEGUNDO_NOMBRE" jdbcType="VARCHAR" property="segundoNombre" />
  	<result column="PRIMER_APELLIDO" jdbcType="VARCHAR" property="primerApellido" />
  	<result column="SEGUNDO_APELLIDO" jdbcType="VARCHAR" property="segundoApellido" />
  	<result column="OBJETIVO_ENTIDAD" jdbcType="VARCHAR" property="objetivoEntidad" />
  	<result column="NOMBRE_DEPENDENCIA" jdbcType="VARCHAR" property="nombreDependencia" />
  	<result column="CODIGO_ENTIDAD" jdbcType="VARCHAR" property="codigoEntidad" />
  	<result column="CODIGO_DANE" jdbcType="NUMERIC" property="codigoDane" />
  	<result column="COD_ENTIDAD" jdbcType="NUMERIC" property="codEntidad" />
  	<result column="DIAS" jdbcType="NUMERIC" property="dias" />
  	<result column="COD_DENOMINACION" jdbcType="NUMERIC" property="codDenominacion" />
  	<result column="PAR_CAUSAL_DESV" jdbcType="NUMERIC" property="parCausalDesv" />
  	<result column="FLG_GUARDADO_PARCIAL" jdbcType="NUMERIC" property="flgGuardadoParcial" />

    <result column="CARGOS_VINCULACION" jdbcType="NUMERIC" property="cargosVinculacion" />
    <result column="COD_GRADO" jdbcType="NUMERIC" property="codGrado" />
    <result column="COD_CARGO" jdbcType="NUMERIC" property="codCargo" />
    <result column="CODIGO_DAFP" jdbcType="VARCHAR" property="codigoDafp" />
    <result column="PRIMER_NOMBRE" jdbcType="VARCHAR" property="primerNombre" />
    <result column="COD_NATURALEZA_EMPLEO" jdbcType="NUMERIC" property="codNaturalezaEmpleo" />
    <result column="DEPENDENCIA_VINCULACION" jdbcType="VARCHAR" property="dependenciaVinculacion" />
    <result column="CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL" jdbcType="NUMERIC" property="codGrcantidadCargoApropiacionPresupuestal" />
    <result column="VACANTES" jdbcType="NUMERIC" property="vacantes" />
    <result column="TIPO_VACANCIA" jdbcType="VARCHAR" property="tipoVacancia" />
    <result column="NOMBRE_CAUSAL_DESV" jdbcType="VARCHAR" property="nombreCausalDesv" />
    <result column="COD_ENTIDAD_PLANTA" jdbcType="NUMERIC" property="codPlantaPersonal" />
    <result column="CODIGO_SIGEP" jdbcType="VARCHAR" property="codigoSigep" />
    <result column="NOMBRE_USUARIO" jdbcType="VARCHAR" property="nombreUsuario" />
    <result column="NOMBRE_ROL" jdbcType="VARCHAR" property="nombreRol" />
    <result column="DETALLE" jdbcType="VARCHAR" property="detalle" />
    <result column="NOMBRE_GRADO" jdbcType="VARCHAR" property="nombreGrado" />
    <result column="NOMBRE_CODIGO" jdbcType="VARCHAR" property="nombreCodigo" />
    <result column="NOMBRE_NATURALEZA_EMPLEO" jdbcType="VARCHAR" property="nombreNaturalezaEmpleo" />
    <result column="FECHA_INICIO_SA" jdbcType="TIMESTAMP" property="fechaInicioSA" />
    <result column="FECHA_FIN_SA" jdbcType="TIMESTAMP" property="fechaFinSA" />
    <result column="PUESTOS_OCUPADOS_VINCULACION" jdbcType="NUMERIC" property="puestosOcupadosVinculacion" />
    <result column="PUESTOS_OCUPADOS_SA" jdbcType="NUMERIC" property="puestosOcupadosSA" />
    <result column="COD_SITUACION_ADMIN_RELACION_LABORAL" jdbcType="NUMERIC" property="codSituacionAdminRelacionLaboral" />
    
    <result column="COD_ENTIDAD_PLANTA_DETALLE_ENCARGO_SA" jdbcType="NUMERIC" property="codEntidadPlantaDetalleEncargoSA" />
    <result column="COD_NOMENCLATURA_DENOMINACION_SA" jdbcType="NUMERIC" property="codNomenclaturaDenominacionSA" />
    <result column="COD_DENOMINACION_SA_ENCARGO" jdbcType="NUMERIC" property="codDenominacionSAEncargo" />
    <result column="COD_CODIGO_SA_ENCARGO" jdbcType="NUMERIC" property="codCodigoSAEncargo" />
    <result column="COD_GRADO_SA_ENCARGO" jdbcType="NUMERIC" property="codGradoSAEncargo" />
    <result column="NOMBRE_DENOMINACION_SA_ENCARGO" jdbcType="VARCHAR" property="nombreDenominacionSAEncargo" />
    <result column="NOMBRE_CODIGO_SA_ENCARGO" jdbcType="VARCHAR" property="nombreCodigoSAEncargo" />
    <result column="NOMBRE_GRADO_SA_ENCARGO" jdbcType="VARCHAR" property="nombreGradoSAEncargo" />
    <result column="NOMBRE_DEPENDENCIA_ENCARGO_SA" jdbcType="VARCHAR" property="nombreDependenciaEncargoSA" />
    <result column="NOMBRE_ENTIDAD_ENCARGO" jdbcType="VARCHAR" property="nombreEntidadEncargo" />
   </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:11 COT 2018.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    COD_VINCULACION, COD_PERSONA, COD_ENTIDAD_PLANTA_DETALLE, COD_DEPENDENCIA_ENTIDAD, 
    FECHA_POSESION, FECHA_FINALIZACION, COD_CAUSAL_DESVINCULACION, COD_TIPO_ACTO_ADMIN_DESVINCULACION, 
    NUM_ACTO_ADMIN_DESVINCULACION, FECHA_ACTO_ADMIN_DESVINCULACION, FLG_MEDICO_DOCENTE, 
    AUD_FECHA_ACTUALIZACION, AUD_COD_USUARIO, AUD_COD_ROL, AUD_ACCION, COD_TIPO_NOMBRAMIENTO, 
    FLG_TITULARIDAD_CARGO, FLG_ACTIVO, FLG_GUARDADO_PARCIAL, FECHA_INACTIVA_USUARIO, FLG_PEP
  </sql>
  <select id="selectByExample" parameterType="co.gov.dafp.sigep2.bean.VinculacionExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from VINCULACION
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.math.BigDecimal" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from VINCULACION
    where COD_VINCULACION = #{codVinculacion,jdbcType=NUMERIC}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    delete from VINCULACION
    where COD_VINCULACION = #{codVinculacion,jdbcType=NUMERIC}
  </delete>
  <delete id="deleteByExample" parameterType="co.gov.dafp.sigep2.bean.VinculacionExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    delete from VINCULACION
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="co.gov.dafp.sigep2.bean.Vinculacion">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    insert into VINCULACION (COD_PERSONA, COD_ENTIDAD_PLANTA_DETALLE, 
      COD_DEPENDENCIA_ENTIDAD, FECHA_POSESION, 
      FECHA_FINALIZACION, COD_CAUSAL_DESVINCULACION, 
      COD_TIPO_ACTO_ADMIN_DESVINCULACION, NUM_ACTO_ADMIN_DESVINCULACION, 
      FECHA_ACTO_ADMIN_DESVINCULACION, FLG_MEDICO_DOCENTE, 
      AUD_FECHA_ACTUALIZACION, AUD_COD_USUARIO, 
      AUD_COD_ROL, AUD_ACCION, COD_TIPO_NOMBRAMIENTO, 
      FLG_TITULARIDAD_CARGO, FLG_ACTIVO, FLG_GUARDADO_PARCIAL, 
      FECHA_INACTIVA_USUARIO,FLG_PEP)
    values (#{codPersona,jdbcType=NUMERIC}, #{codEntidadPlantaDetalle,jdbcType=NUMERIC}, 
      #{codDependenciaEntidad,jdbcType=NUMERIC}, #{fechaPosesion,jdbcType=TIMESTAMP}, 
      #{fechaFinalizacion,jdbcType=TIMESTAMP}, #{codCausalDesvinculacion,jdbcType=NUMERIC}, 
      #{codTipoActoAdminDesvinculacion,jdbcType=NUMERIC}, #{numActoAdminDesvinculacion,jdbcType=VARCHAR}, 
      #{fechaActoAdminDesvinculacion,jdbcType=TIMESTAMP}, #{flgMedicoDocente,jdbcType=NUMERIC}, 
      #{audFechaActualizacion,jdbcType=TIMESTAMP}, #{audCodUsuario,jdbcType=NUMERIC}, 
      #{audCodRol,jdbcType=NUMERIC}, #{audAccion,jdbcType=NUMERIC}, #{codTipoNombramiento,jdbcType=NUMERIC}, 
      #{flgTitularidadCargo,jdbcType=NUMERIC}, #{flgActivo,jdbcType=NUMERIC}, #{flgGuardadoParcial,jdbcType=NUMERIC}, 
      #{fechaInactivaUsuario,jdbcType=TIMESTAMP}, #{flgPEP,jdbcType=NUMERIC} )
  </insert>
  <insert id="insertSelective" parameterType="co.gov.dafp.sigep2.bean.Vinculacion">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    insert into VINCULACION
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="codVinculacion != null">
        COD_VINCULACION,
      </if>
      <if test="codPersona != null">
        COD_PERSONA,
      </if>
      <if test="codEntidadPlantaDetalle != null">
        COD_ENTIDAD_PLANTA_DETALLE,
      </if>
      <if test="codDependenciaEntidad != null">
        COD_DEPENDENCIA_ENTIDAD,
      </if>
      <if test="fechaPosesion != null">
        FECHA_POSESION,
      </if>
      <if test="fechaFinalizacion != null">
        FECHA_FINALIZACION,
      </if>
      <if test="codCausalDesvinculacion != null">
        COD_CAUSAL_DESVINCULACION,
      </if>
      <if test="codTipoActoAdminDesvinculacion != null">
        COD_TIPO_ACTO_ADMIN_DESVINCULACION,
      </if>
      <if test="numActoAdminDesvinculacion != null">
        NUM_ACTO_ADMIN_DESVINCULACION,
      </if>
      <if test="fechaActoAdminDesvinculacion != null">
        FECHA_ACTO_ADMIN_DESVINCULACION,
      </if>
      <if test="flgMedicoDocente != null">
        FLG_MEDICO_DOCENTE,
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION,
      </if>
      <if test="audCodUsuario != null">
        AUD_COD_USUARIO,
      </if>
      <if test="audCodRol != null">
        AUD_COD_ROL,
      </if>
      <if test="audAccion != null">
        AUD_ACCION,
      </if>
      <if test="codTipoNombramiento != null">
        COD_TIPO_NOMBRAMIENTO,
      </if>
      <if test="flgTitularidadCargo != null">
        FLG_TITULARIDAD_CARGO,
      </if>
      <if test="flgActivo != null">
        FLG_ACTIVO,
      </if>
      <if test="flgGuardadoParcial != null">
        FLG_GUARDADO_PARCIAL,
      </if>
      <if test="fechaInactivaUsuario != null">
        FECHA_INACTIVA_USUARIO,
      </if>
      <if test="flgPEP != null">
        FLG_PEP,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="codVinculacion != null">
        #{codVinculacion,jdbcType=NUMERIC},
      </if>
      <if test="codPersona != null">
        #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="codEntidadPlantaDetalle != null">
        #{codEntidadPlantaDetalle,jdbcType=NUMERIC},
      </if>
      <if test="codDependenciaEntidad != null">
        #{codDependenciaEntidad,jdbcType=NUMERIC},
      </if>
      <if test="fechaPosesion != null">
        #{fechaPosesion,jdbcType=TIMESTAMP},
      </if>
      <if test="fechaFinalizacion != null">
        #{fechaFinalizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="codCausalDesvinculacion != null">
        #{codCausalDesvinculacion,jdbcType=NUMERIC},
      </if>
      <if test="codTipoActoAdminDesvinculacion != null">
        #{codTipoActoAdminDesvinculacion,jdbcType=NUMERIC},
      </if>
      <if test="numActoAdminDesvinculacion != null">
        #{numActoAdminDesvinculacion,jdbcType=VARCHAR},
      </if>
      <if test="fechaActoAdminDesvinculacion != null">
        #{fechaActoAdminDesvinculacion,jdbcType=TIMESTAMP},
      </if>
      <if test="flgMedicoDocente != null">
        #{flgMedicoDocente,jdbcType=NUMERIC},
      </if>
      <if test="audFechaActualizacion != null">
        #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="audCodUsuario != null">
        #{audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="audCodRol != null">
        #{audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="audAccion != null">
        #{audAccion,jdbcType=NUMERIC},
      </if>
      <if test="codTipoNombramiento != null">
        #{codTipoNombramiento,jdbcType=NUMERIC},
      </if>
      <if test="flgTitularidadCargo != null">
        #{flgTitularidadCargo,jdbcType=NUMERIC},
      </if>
      <if test="flgActivo != null">
        #{flgActivo,jdbcType=NUMERIC},
      </if>
      <if test="flgGuardadoParcial != null">
        #{flgGuardadoParcial,jdbcType=NUMERIC},
      </if>
      <if test="fechaInactivaUsuario != null">
        #{fechaInactivaUsuario,jdbcType=TIMESTAMP},
      </if>
      <if test="flgPEP != null">
        #{flgPEP,jdbcType=NUMERIC},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="co.gov.dafp.sigep2.bean.VinculacionExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    select count(*) from VINCULACION
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    update VINCULACION
    <set>
      <if test="record.codVinculacion != null">
        COD_VINCULACION = #{record.codVinculacion,jdbcType=NUMERIC},
      </if>
      <if test="record.codPersona != null">
        COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      </if>
      <if test="record.codEntidadPlantaDetalle != null">
        COD_ENTIDAD_PLANTA_DETALLE = #{record.codEntidadPlantaDetalle,jdbcType=NUMERIC},
      </if>
      <if test="record.codDependenciaEntidad != null">
        COD_DEPENDENCIA_ENTIDAD = #{record.codDependenciaEntidad,jdbcType=NUMERIC},
      </if>
      <if test="record.fechaPosesion != null">
        FECHA_POSESION = #{record.fechaPosesion,jdbcType=TIMESTAMP},
      </if>
      <if test="record.fechaFinalizacion != null">
        FECHA_FINALIZACION = #{record.fechaFinalizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="record.codCausalDesvinculacion != null">
        COD_CAUSAL_DESVINCULACION = #{record.codCausalDesvinculacion,jdbcType=NUMERIC},
      </if>
      <if test="record.codTipoActoAdminDesvinculacion != null">
        COD_TIPO_ACTO_ADMIN_DESVINCULACION = #{record.codTipoActoAdminDesvinculacion,jdbcType=NUMERIC},
      </if>
      <if test="record.numActoAdminDesvinculacion != null">
        NUM_ACTO_ADMIN_DESVINCULACION = #{record.numActoAdminDesvinculacion,jdbcType=VARCHAR},
      </if>
      <if test="record.fechaActoAdminDesvinculacion != null">
        FECHA_ACTO_ADMIN_DESVINCULACION = #{record.fechaActoAdminDesvinculacion,jdbcType=TIMESTAMP},
      </if>
      <if test="record.flgMedicoDocente != null">
        FLG_MEDICO_DOCENTE = #{record.flgMedicoDocente,jdbcType=NUMERIC},
      </if>
      <if test="record.audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="record.audCodUsuario != null">
        AUD_COD_USUARIO = #{record.audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="record.audCodRol != null">
        AUD_COD_ROL = #{record.audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="record.audAccion != null">
        AUD_ACCION = #{record.audAccion,jdbcType=NUMERIC},
      </if>
      <if test="record.codTipoNombramiento != null">
        COD_TIPO_NOMBRAMIENTO = #{record.codTipoNombramiento,jdbcType=NUMERIC},
      </if>
      <if test="record.flgTitularidadCargo != null">
        FLG_TITULARIDAD_CARGO = #{record.flgTitularidadCargo,jdbcType=NUMERIC},
      </if>
      <if test="record.flgActivo != null">
        FLG_ACTIVO = #{record.flgActivo,jdbcType=NUMERIC},
      </if>
      <if test="record.flgGuardadoParcial != null">
        FLG_GUARDADO_PARCIAL = #{record.flgGuardadoParcial,jdbcType=NUMERIC},
      </if>
      <if test="record.fechaInactivaUsuario != null">
        FECHA_INACTIVA_USUARIO = #{record.fechaInactivaUsuario,jdbcType=TIMESTAMP},
      </if>
       <if test="record.flgPEP != null">
        FLG_PEP = #{record.flgPEP,jdbcType=NUMERIC},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    update VINCULACION
    set COD_VINCULACION = #{record.codVinculacion,jdbcType=NUMERIC},
      COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      COD_ENTIDAD_PLANTA_DETALLE = #{record.codEntidadPlantaDetalle,jdbcType=NUMERIC},
      COD_DEPENDENCIA_ENTIDAD = #{record.codDependenciaEntidad,jdbcType=NUMERIC},
      FECHA_POSESION = #{record.fechaPosesion,jdbcType=TIMESTAMP},
      FECHA_FINALIZACION = #{record.fechaFinalizacion,jdbcType=TIMESTAMP},
      COD_CAUSAL_DESVINCULACION = #{record.codCausalDesvinculacion,jdbcType=NUMERIC},
      COD_TIPO_ACTO_ADMIN_DESVINCULACION = #{record.codTipoActoAdminDesvinculacion,jdbcType=NUMERIC},
      NUM_ACTO_ADMIN_DESVINCULACION = #{record.numActoAdminDesvinculacion,jdbcType=VARCHAR},
      FECHA_ACTO_ADMIN_DESVINCULACION = #{record.fechaActoAdminDesvinculacion,jdbcType=TIMESTAMP},
      FLG_MEDICO_DOCENTE = #{record.flgMedicoDocente,jdbcType=NUMERIC},
      AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      AUD_COD_USUARIO = #{record.audCodUsuario,jdbcType=NUMERIC},
      AUD_COD_ROL = #{record.audCodRol,jdbcType=NUMERIC},
      AUD_ACCION = #{record.audAccion,jdbcType=NUMERIC},
      COD_TIPO_NOMBRAMIENTO = #{record.codTipoNombramiento,jdbcType=NUMERIC},
      FLG_TITULARIDAD_CARGO = #{record.flgTitularidadCargo,jdbcType=NUMERIC},
      FLG_ACTIVO = #{record.flgActivo,jdbcType=NUMERIC},
      FLG_GUARDADO_PARCIAL = #{record.flgGuardadoParcial,jdbcType=NUMERIC},
      FECHA_INACTIVA_USUARIO = #{record.fechaInactivaUsuario,jdbcType=TIMESTAMP},
      FLG_GUARDADO_PEP = #{record.flgPEP,jdbcType=NUMERIC}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="co.gov.dafp.sigep2.bean.Vinculacion">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    update VINCULACION
    <set>
      <if test="codPersona != null">
        COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="codEntidadPlantaDetalle != null">
        COD_ENTIDAD_PLANTA_DETALLE = #{codEntidadPlantaDetalle,jdbcType=NUMERIC},
      </if>
      <if test="codDependenciaEntidad != null">
        COD_DEPENDENCIA_ENTIDAD = #{codDependenciaEntidad,jdbcType=NUMERIC},
      </if>
      <if test="fechaPosesion != null">
        FECHA_POSESION = #{fechaPosesion,jdbcType=TIMESTAMP},
      </if>
      <if test="fechaFinalizacion != null">
        FECHA_FINALIZACION = #{fechaFinalizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="codCausalDesvinculacion != null">
        COD_CAUSAL_DESVINCULACION = #{codCausalDesvinculacion,jdbcType=NUMERIC},
      </if>
      <if test="codTipoActoAdminDesvinculacion != null">
        COD_TIPO_ACTO_ADMIN_DESVINCULACION = #{codTipoActoAdminDesvinculacion,jdbcType=NUMERIC},
      </if>
      <if test="numActoAdminDesvinculacion != null">
        NUM_ACTO_ADMIN_DESVINCULACION = #{numActoAdminDesvinculacion,jdbcType=VARCHAR},
      </if>
      <if test="fechaActoAdminDesvinculacion != null">
        FECHA_ACTO_ADMIN_DESVINCULACION = #{fechaActoAdminDesvinculacion,jdbcType=TIMESTAMP},
      </if>
      <if test="flgMedicoDocente != null">
        FLG_MEDICO_DOCENTE = #{flgMedicoDocente,jdbcType=NUMERIC},
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="audCodUsuario != null">
        AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="audCodRol != null">
        AUD_COD_ROL = #{audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="audAccion != null">
        AUD_ACCION = #{audAccion,jdbcType=NUMERIC},
      </if>
      <if test="codTipoNombramiento != null">
        COD_TIPO_NOMBRAMIENTO = #{codTipoNombramiento,jdbcType=NUMERIC},
      </if>
      <if test="flgTitularidadCargo != null">
        FLG_TITULARIDAD_CARGO = #{flgTitularidadCargo,jdbcType=NUMERIC},
      </if>
      <if test="flgActivo != null">
        FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC},
      </if>
      <if test="flgGuardadoParcial != null">
        FLG_GUARDADO_PARCIAL = #{flgGuardadoParcial,jdbcType=NUMERIC},
      </if>
      <if test="fechaInactivaUsuario != null">
        FECHA_INACTIVA_USUARIO = #{fechaInactivaUsuario,jdbcType=TIMESTAMP},
      </if>
      <if test="flgGuardadoParcial != null">
        FLG_PEP = #{flgPEP,jdbcType=NUMERIC},
      </if>
    </set>
    where COD_VINCULACION = #{codVinculacion,jdbcType=NUMERIC}
  </update>
  <update id="updateByPrimaryKey" parameterType="co.gov.dafp.sigep2.bean.Vinculacion">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 17:49:12 COT 2018.
    -->
    update VINCULACION
    set COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      COD_ENTIDAD_PLANTA_DETALLE = #{codEntidadPlantaDetalle,jdbcType=NUMERIC},
      COD_DEPENDENCIA_ENTIDAD = #{codDependenciaEntidad,jdbcType=NUMERIC},
      FECHA_POSESION = #{fechaPosesion,jdbcType=TIMESTAMP},
      FECHA_FINALIZACION = #{fechaFinalizacion,jdbcType=TIMESTAMP},
      COD_CAUSAL_DESVINCULACION = #{codCausalDesvinculacion,jdbcType=NUMERIC},
      COD_TIPO_ACTO_ADMIN_DESVINCULACION = #{codTipoActoAdminDesvinculacion,jdbcType=NUMERIC},
      NUM_ACTO_ADMIN_DESVINCULACION = #{numActoAdminDesvinculacion,jdbcType=VARCHAR},
      FECHA_ACTO_ADMIN_DESVINCULACION = #{fechaActoAdminDesvinculacion,jdbcType=TIMESTAMP},
      FLG_MEDICO_DOCENTE = #{flgMedicoDocente,jdbcType=NUMERIC},
      AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
      AUD_COD_ROL = #{audCodRol,jdbcType=NUMERIC},
      AUD_ACCION = #{audAccion,jdbcType=NUMERIC},
      COD_TIPO_NOMBRAMIENTO = #{codTipoNombramiento,jdbcType=NUMERIC},
      FLG_TITULARIDAD_CARGO = #{flgTitularidadCargo,jdbcType=NUMERIC},
      FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC},
      FLG_GUARDADO_PARCIAL = #{flgGuardadoParcial,jdbcType=NUMERIC},
      FECHA_INACTIVA_USUARIO = #{fechaInactivaUsuario,jdbcType=TIMESTAMP},
      FLG_PEP = #{flgPEP,jdbcType=NUMERIC}
    where COD_VINCULACION = #{codVinculacion,jdbcType=NUMERIC}
  </update>
  <select id="selectVinculacionFilter" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
	    SELECT
			DISTINCT v.*, p.NUMERO_IDENTIFICACION, p.PRIMER_NOMBRE, p.SEGUNDO_NOMBRE, p.PRIMER_APELLIDO, p.SEGUNDO_APELLIDO,
			(	SELECT
					p.NOMBRE_PARAMETRO 
				FROM
					PARAMETRICA p 
				WHERE
					p.COD_TABLA_PARAMETRICA = v.COD_TIPO_NOMBRAMIENTO) 
			NOMBRE_TIPO_NOMBRAMIENTO 
		FROM
			VINCULACION v INNER JOIN PERSONA p
		       ON p.COD_PERSONA = v.COD_PERSONA
		WHERE
			v.COD_VINCULACION > 0
		<if test="codVinculacion != null">
			AND v.COD_VINCULACION = #{codVinculacion,jdbcType=NUMERIC}
		</if>
		<if test="codPersona != null">
			AND v.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
		</if>
		<if test="codDependenciaEntidad != null">
			AND v.COD_DEPENDENCIA_ENTIDAD = #{codDependenciaEntidad,jdbcType=NUMERIC}
		</if>
		<if test="codEntidadPlantaDetalle != null">
			AND v.COD_ENTIDAD_PLANTA_DETALLE = #{codEntidadPlantaDetalle,jdbcType=NUMERIC}
		</if>
		<if test="codTipoNombramiento != null">
			AND v.COD_TIPO_NOMBRAMIENTO = #{codTipoNombramiento,jdbcType=NUMERIC}
		</if>
		<if test="codCausalDesvinculacion != null">
			AND v.COD_CAUSAL_DESVINCULACION = #{codCausalDesvinculacion,jdbcType=NUMERIC}
		</if>
		<if test="flgTitularidadCargo != null">
			AND v.FLG_TITULARIDAD_CARGO = #{flgTitularidadCargo,jdbcType=NUMERIC}
		</if>
		<if test="flgActivo != null">
			AND v.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
		</if>
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>
	<select id="selectVinculacionDiferenteEntidad" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
	    SELECT distinct v.*,
		    e.NOMBRE_ENTIDAD,
		    e.COD_ENTIDAD
		FROM 
		    VINCULACION v
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
		INNER JOIN ENTIDAD e ON e.COD_ENTIDAD = epp.COD_ENTIDAD
		WHERE v.COD_VINCULACION > 0
		AND ecp.FLG_ACTIVO = 1
		AND v.FLG_ACTIVO = 1
		AND v.FLG_MEDICO_DOCENTE = 0
		AND v.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
		AND (e.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC} OR e.COD_ENTIDAD != #{codEntidad,jdbcType=NUMERIC})
		AND v.FECHA_FINALIZACION IS NULL
		        AND NOT EXISTS (
              SELECT 1
              FROM situacion_admin_vinculacion
              WHERE flg_activo = 1
                AND cod_situacion_administrativa = 16
                AND cod_vinculacion = v.cod_vinculacion
        )
		ORDER BY v.COD_VINCULACION DESC
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>
	<select id="selectPersona" parameterType="co.gov.dafp.sigep2.bean.ext.PersonaExt" resultMap="BaseResultMap">
  	 SELECT V.*
		FROM VINCULACION V
		LEFT JOIN PERSONA P on V.COD_PERSONA = P.COD_PERSONA
		LEFT JOIN USUARIO U on P.COD_PERSONA = U.COD_PERSONA
		LEFT JOIN USUARIO_ENTIDAD E on U.COD_USUARIO = E.COD_USUARIO
	    WHERE  P.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
		AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		AND V.FLG_ACTIVO = 1
    </select>
    <select id="vinculacionPersona" parameterType="co.gov.dafp.sigep2.bean.ext.SituacionAdminVinculacionExt" resultMap="BaseResultMap">
  	  SELECT V.*
		FROM VINCULACION V
		LEFT JOIN PERSONA P on V.COD_PERSONA = P.COD_PERSONA
		LEFT JOIN USUARIO U on P.COD_PERSONA = U.COD_PERSONA
		LEFT JOIN USUARIO_ENTIDAD E on U.COD_USUARIO = E.COD_USUARIO
	  WHERE  P.NUMERO_IDENTIFICACION = #{numeroIdentificacion,jdbcType=VARCHAR}
          AND P.COD_TIPO_IDENTIFICACION = #{codTipoIdentificacion,jdbcType=NUMERIC}
		  AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		  AND V.FLG_ACTIVO = 1
    </select>
	<select id="vinculacionPersonafiltro" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
  	  SELECT  
		    v.cod_vinculacion,
		    v.cod_persona,
		    v.cod_entidad_planta_detalle,
		    v.cod_dependencia_entidad,
		    v.fecha_posesion,
		    v.fecha_finalizacion,
		    v.cod_causal_desvinculacion,
		    v.cod_tipo_acto_admin_desvinculacion,
		    v.num_acto_admin_desvinculacion,
		    v.fecha_acto_admin_desvinculacion,
		    v.flg_medico_docente,
		    v.aud_fecha_actualizacion,
		    v.aud_cod_usuario,
		    v.aud_cod_rol,
		    v.aud_accion,
		    v.cod_tipo_nombramiento,
		    v.flg_titularidad_cargo,
		    v.flg_activo,
		    v.flg_guardado_parcial,
		    v.fecha_inactiva_usuario,
		    v.flg_pep,
		    v.dt_fecha_ultima_actualizacion,
		    e.CODIGO_DANE,
		    e.OBJETIVO_ENTIDAD,
		    epd.cod_tipo_planta,
		    pe.PRIMER_NOMBRE,
		    pe.SEGUNDO_NOMBRE,
		    pe.PRIMER_APELLIDO,
		    pe.SEGUNDO_APELLIDO,
		    pe.COD_TIPO_IDENTIFICACION,
		    pe.NUMERO_IDENTIFICACION,
		    e.COD_ENTIDAD,
		    nd.COD_DENOMINACION,
		    nd.cod_nomenclatura_denominacion AS cod_cargo,
		    de.nombre_denominacion AS NOMBRE_CARGO,
		    nombre_parametro(v.COD_TIPO_NOMBRAMIENTO) AS NOMBRE_TIPO_NOMBRAMIENTO,
		    nombre_parametro(pe.cod_tipo_identificacion) AS NOMBRE_DOCUMENTO,
		    ep.nombre_planta AS NOMBRE_PLANTA,
		    e.NOMBRE_ENTIDAD,
		    nombre_parametro(v.COD_CAUSAL_DESVINCULACION) AS NOMBRE_CAUSAL_DESV,
		    nombre_parametro(epd.COD_NATURALEZA_EMPLEO) AS NOMBRE_NATURALEZA_EMPLEO,
		    D.NOMBRE_DEPENDENCIA,
		    nombre_parametro(nd.cod_codigo::NUMERIC) AS NOMBRE_CODIGO,
		    nombre_parametro(nd.cod_grado) AS NOMBRE_GRADO,
		    e.codigo_sigep AS CODIGO_DAFP,
		    (SELECT sa.cod_entidad_planta_detalle_encargo 
		     FROM situacion_admin_vinculacion sa 
		     WHERE sa.cod_vinculacion = v.cod_vinculacion
		       AND sa.flg_activo = 1 
		       AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		     LIMIT 1) AS cod_entidad_planta_detalle_encargo_sa,
		    (SELECT nde.cod_nomenclatura_denominacion  
		     FROM entidad_planta_detalle nde 
		     WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                             FROM situacion_admin_vinculacion sa 
		                                             WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                               AND sa.flg_activo = 1 
		                                               AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                             LIMIT 1)) AS cod_nomenclatura_denominacion_SA,
		    (SELECT cod_denominacion 
		     FROM nomenclatura_denominacion 
		     WHERE cod_nomenclatura_denominacion = (SELECT nde.cod_nomenclatura_denominacion  
		                                            FROM entidad_planta_detalle nde 
		                                            WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                    FROM situacion_admin_vinculacion sa 
		                                                                                    WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                      AND sa.flg_activo = 1 
		                                                                                      AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                    LIMIT 1))) AS cod_denominacion_sa_encargo,
		    (SELECT cod_codigo 
		     FROM nomenclatura_denominacion 
		     WHERE cod_nomenclatura_denominacion = (SELECT nde.cod_nomenclatura_denominacion  
		                                            FROM entidad_planta_detalle nde 
		                                            WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                    FROM situacion_admin_vinculacion sa 
		                                                                                    WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                      AND sa.flg_activo = 1 
		                                                                                      AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                    LIMIT 1))) AS cod_codigo_sa_encargo,
		    (SELECT cod_grado 
		     FROM nomenclatura_denominacion 
		     WHERE cod_nomenclatura_denominacion = (SELECT nde.cod_nomenclatura_denominacion  
		                                            FROM entidad_planta_detalle nde 
		                                            WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                    FROM situacion_admin_vinculacion sa 
		                                                                                    WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                      AND sa.flg_activo = 1 
		                                                                                      AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                    LIMIT 1))) AS cod_grado_sa_encargo,
		    (SELECT nombre_denominacion 
		     FROM denominacion 
		     WHERE cod_denominacion = (SELECT cod_denominacion 
		                               FROM nomenclatura_denominacion 
		                               WHERE cod_nomenclatura_denominacion = (SELECT nde.cod_nomenclatura_denominacion  
		                                                                      FROM entidad_planta_detalle nde 
		                                                                      WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                                              FROM situacion_admin_vinculacion sa 
		                                                                                                              WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                                                AND sa.flg_activo = 1 
		                                                                                                                AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                                              LIMIT 1)))) AS nombre_denominacion_sa_encargo,
		    (SELECT nombre_parametro 
		     FROM parametrica 
		     WHERE cod_tabla_parametrica = (SELECT cod_codigo::NUMERIC 
		                                    FROM nomenclatura_denominacion 
		                                    WHERE cod_nomenclatura_denominacion = (SELECT nde.cod_nomenclatura_denominacion  
		                                                                           FROM entidad_planta_detalle nde 
		                                                                           WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                                                   FROM situacion_admin_vinculacion sa 
		                                                                                                                   WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                                                     AND sa.flg_activo = 1 
		                                                                                                                     AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                                                   LIMIT 1)))) AS nombre_codigo_sa_encargo,
		    (SELECT nombre_parametro 
		     FROM parametrica 
		     WHERE cod_tabla_parametrica = (SELECT cod_grado 
		                                    FROM nomenclatura_denominacion 
		                                    WHERE cod_nomenclatura_denominacion = (SELECT nde.cod_nomenclatura_denominacion  
		                                                                           FROM entidad_planta_detalle nde 
		                                                                           WHERE nde.cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                                                   FROM situacion_admin_vinculacion sa 
		                                                                                                                   WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                                                     AND sa.flg_activo = 1 
		                                                                                                                     AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                                                   LIMIT 1)))) AS nombre_grado_sa_encargo,
		    (SELECT nombre_dependencia 
		     FROM dependencia_entidad 
		     WHERE cod_dependencia_entidad = (SELECT sa.cod_dependencia_entidad 
		                                      FROM situacion_admin_vinculacion sa 
		                                      WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                        AND sa.flg_activo = 1 
		                                        AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                      LIMIT 1)) AS nombre_dependencia_encargo_sa,
		    (SELECT nombre_entidad 
		     FROM entidad 
		     WHERE cod_entidad = (SELECT cod_entidad 
		                          FROM entidad_planta 
		                          WHERE cod_entidad_planta = (SELECT cod_entidad_planta 
		                                                      FROM entidad_planta_detalle 
		                                                      WHERE cod_entidad_planta_detalle = (SELECT sa.cod_entidad_planta_detalle_encargo 
		                                                                                         FROM situacion_admin_vinculacion sa 
		                                                                                         WHERE sa.cod_vinculacion = v.cod_vinculacion
		                                                                                           AND sa.flg_activo = 1 
		                                                                                           AND sa.cod_entidad_planta_detalle_encargo IS NOT NULL 
		                                                                                         LIMIT 1)))) AS nombre_entidad_encargo
		FROM vinculacion v 
		INNER JOIN persona pe ON v.cod_persona = pe.cod_persona
		INNER JOIN entidad_planta_detalle epd ON epd.cod_entidad_planta_detalle = v.cod_entidad_planta_detalle
		INNER JOIN entidad_planta ep ON ep.cod_entidad_planta = epd.cod_entidad_planta
		INNER JOIN entidad e ON e.cod_entidad = ep.cod_entidad
		INNER JOIN nomenclatura_denominacion nd ON nd.cod_nomenclatura_denominacion = epd.cod_nomenclatura_denominacion
		INNER JOIN denominacion de ON nd.cod_denominacion = de.cod_denominacion
		LEFT JOIN dependencia_entidad d ON v.cod_dependencia_entidad = d.cod_dependencia_entidad
		WHERE e.cod_entidad = #{codEntidad,jdbcType=NUMERIC}

		 <if test="codTipoPlanta != null">
		   AND epd.cod_tipo_planta =  #{codTipoPlanta,jdbcType=NUMERIC}
		 </if>
		 <if test="nombreCargo != null">
		  AND UPPER(TRIM(translate(de.nombre_denominacion, 'áéíóúÁÉÍÓÚ', 'aeiouAEIOU'))) LIKE '%'|| UPPER(TRIM(translate(#{nombreCargo,jdbcType=VARCHAR}, 'áéíóúÁÉÍÓÚ', 'aeiouAEIOU')))||'%'
		 </if>
		 <if test="codTipoNombramiento != null">
			AND v.cod_tipo_nombramiento =  #{codTipoNombramiento,jdbcType=NUMERIC}
		 </if>
		 <if test="codNaturalezaEmpleo != null">
			AND epd.cod_naturaleza_empleo =  #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		 </if>
		 <if test="codDependenciaEntidad != null">
			AND v.COD_DEPENDENCIA_ENTIDAD =  #{codDependenciaEntidad,jdbcType=NUMERIC}
		 </if>
		 <if test="codCausalDesvinculacion != null">
			AND v.COD_CAUSAL_DESVINCULACION =  #{codCausalDesvinculacion,jdbcType=NUMERIC}
		 </if>
		 <if test="parCausalDesv != null">
			AND COALESCE(v.COD_CAUSAL_DESVINCULACION,1) != #{parCausalDesv,jdbcType=NUMERIC}
		</if>
		 <if test="flgActivo != null and flgActivo == 1">
			 <if test="fechaIniPosesion != null and fechafinPosesion != null">
				 AND v.FECHA_POSESION between  #{fechaIniPosesion,jdbcType=TIMESTAMP} and  #{fechafinPosesion,jdbcType=TIMESTAMP}
			 </if>
			 <if test="fechaIniPosesion == null or fechafinPosesion == null">
			 	 <if test="fechaIniPosesion != null">
			 	    AND v.FECHA_POSESION =  #{fechaIniPosesion,jdbcType=TIMESTAMP}
			 	 </if>
			 	 <if test="fechafinPosesion != null">
			 	    AND v.FECHA_POSESION =  #{fechafinPosesion,jdbcType=TIMESTAMP}
			 	 </if>				 
			 </if>
		</if>
		 <if test="flgActivo != null and flgActivo == 0">
		     <if test="fechaIniPosesion != null and fechafinPosesion != null" >
		      AND v.FECHA_FINALIZACION between  #{fechaIniPosesion,jdbcType=TIMESTAMP} and  #{fechaFinalizacion,jdbcType=TIMESTAMP}
		 	 </if>
		 	 <if test="fechaIniPosesion == null or fechafinPosesion == null">
			 	 <if test="fechaIniPosesion != null">
			 	    AND v.FECHA_FINALIZACION =  #{fechaIniPosesion,jdbcType=TIMESTAMP}
			 	 </if>
			 	 <if test="fechafinPosesion != null">
			 	    AND v.FECHA_FINALIZACION =  #{fechafinPosesion,jdbcType=TIMESTAMP}
			 	 </if>				 
			 </if>
		 </if>
		  <if test="flgActivo != null">
		   AND V.FLG_ACTIVO =  #{flgActivo,jdbcType=NUMERIC}
		 </if>
	 union all
	    select 
		    null cod_vinculacion,
		    hv.cod_persona cod_persona,
		    null cod_entidad_planta_detalle,
		    null cod_dependencia_entidad,
		    fecha_aprobacion fecha_posesion,
		    null fecha_finalizacion,
		    null cod_causal_desvinculacion,
		    null cod_tipo_acto_admin_desvinculacion,
		    null num_acto_admin_desvinculacion,
		    null fecha_acto_admin_desvinculacion,
		    0 flg_medico_docente,
		    hv.aud_fecha_actualizacion aud_fecha_actualizacion,
		    hv.aud_cod_usuario aud_cod_usuario,
		    hv.aud_cod_rol aud_cod_rol,
		    hv.aud_accion aud_accion,
		    null cod_tipo_nombramiento,
		    null flg_titularidad_cargo,
		    case when hv.flg_activo = 1 and utl.flg_activo = 1 then 1 else 0 end  flg_activo,
		    null flg_guardado_parcial,
		    null fecha_inactiva_usuario,
		    null flg_pep,
		    null dt_fecha_ultima_actualizacion,
		    e.codigo_dane CODIGO_DANE,
		    null OBJETIVO_ENTIDAD,
		    null cod_tipo_planta,
		    p.primer_nombre PRIMER_NOMBRE,
		    p.segundo_nombre SEGUNDO_NOMBRE,
		    p.primer_apellido PRIMER_APELLIDO,
		    p.segundo_apellido SEGUNDO_APELLIDO,
		    p.cod_tipo_identificacion COD_TIPO_IDENTIFICACION,
		    p.numero_identificacion NUMERO_IDENTIFICACION,
		    e.cod_entidad COD_ENTIDAD,
		    null COD_DENOMINACION,
		    null cod_cargo,
		    null NOMBRE_CARGO,
		    null NOMBRE_TIPO_NOMBRAMIENTO,
		    nombre_parametro(p.cod_tipo_identificacion) NOMBRE_DOCUMENTO,
		    ep.nombre_planta NOMBRE_PLANTA,
		    e.nombre_entidad NOMBRE_ENTIDAD,
		    null NOMBRE_CAUSAL_DESV,
		    null NOMBRE_NATURALEZA_EMPLEO,
		    null NOMBRE_DEPENDENCIA,
		    null NOMBRE_CODIGO,
		    null NOMBRE_GRADO,
		    e.codigo_sigep as CODIGO_DAFP,
		    null cod_entidad_planta_detalle_encargo_sa,
		    null cod_nomenclatura_denominacion_SA,
		    null cod_denominacion_sa_encargo,
		    null cod_codigo_sa_encargo,
		    null cod_grado_sa_encargo,
		    null nombre_denominacion_sa_encargo,
		    null nombre_codigo_sa_encargo,
		    null nombre_grado_sa_encargo,
		    null nombre_dependencia_encargo_sa,
		    null nombre_entidad_encargo
	    from hoja_vida hv
	    inner join persona p on p.cod_persona = hv.cod_persona
	    inner join planta_persona_utl_uan utl on hv.cod_utl_uan = utl.cod_planta_persona_utl_uan
	    inner join entidad_planta ep on ep.cod_entidad_planta = utl.cod_entidad_planta
	    inner join entidad e on e.cod_entidad = ep.cod_entidad
		where e.cod_entidad = #{codEntidad,jdbcType=NUMERIC}
		 <if test="flgActivo != null">
		   AND hv.FLG_ACTIVO =  #{flgActivo,jdbcType=NUMERIC}
		   and utl.flg_activo =  #{flgActivo,jdbcType=NUMERIC}
		 </if> 
  	</select>
	<select id="selectMostrarVinculaciones" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
	    SELECT v.*,
		c.NOMBRE_DENOMINACION NOMBRE_CARGO,
		(SELECT e.NOMBRE_ENTIDAD FROM ENTIDAD e WHERE e.COD_ENTIDAD = epp.COD_ENTIDAD) NOMBRE_ENTIDAD,
		(SELECT e.CODIGO_SIGEP FROM ENTIDAD e WHERE e.COD_ENTIDAD = epp.COD_ENTIDAD) CODIGO_ENTIDAD,
		(SELECT d.NOMBRE_DEPENDENCIA FROM DEPENDENCIA_ENTIDAD d WHERE d.COD_DEPENDENCIA_ENTIDAD = v.COD_DEPENDENCIA_ENTIDAD) NOMBRE_DEPENDENCIA,
		(SELECT p.VALOR_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_TIPO_NOMBRAMIENTO) NOMBRE_TIPO_NOMBRAMIENTO,
		(SELECT p.VALOR_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = epp.COD_CLASIFICACION_PLANTA) NOMBRE_PLANTA,
		(SELECT p.VALOR_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_CAUSAL_DESVINCULACION) NOMBRE_CAUSAL_DESV
		FROM 
		    VINCULACION v
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
		WHERE 1=1
		<if test="codPersona != null">
		    AND v.COD_PERSONA= #{codPersona,jdbcType=NUMERIC}
		</if>
		<if test="parCausalDesv != null">
			AND COALESCE(v.COD_CAUSAL_DESVINCULACION,1) != #{parCausalDesv,jdbcType=NUMERIC}
		</if>
		<if test="codCausalDesvinculacion != null">
			AND COALESCE(v.COD_CAUSAL_DESVINCULACION,1) = #{codCausalDesvinculacion,jdbcType=NUMERIC}
		</if>	
		<if test="flgActivo != null">
			AND v.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
		</if>
		<if test="codEntidad != null">
			AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		</if>
		<if test="flgActivo == null">
			ORDER BY v.FECHA_POSESION DESC
		</if>
		
		<if test="flgActivo != null">
			<if test="flgActivo == 1">
				ORDER BY v.FECHA_POSESION DESC	
			</if>
			<if test="flgActivo == 0">
				ORDER BY v.FECHA_FINALIZACION DESC	
			</if>
		</if>
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>
	<select id="selectVinculacionSituacionAdmin" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
		
    SELECT v.*,
		    c.nombre_denominacion NOMBRE_CARGO,
		    (SELECT e.NOMBRE_ENTIDAD FROM ENTIDAD e WHERE e.COD_ENTIDAD= epp.COD_ENTIDAD) NOMBRE_ENTIDAD,
		    (SELECT d.NOMBRE_DEPENDENCIA FROM DEPENDENCIA_ENTIDAD d WHERE d.COD_DEPENDENCIA_ENTIDAD = sav.COD_DEPENDENCIA_ENTIDAD) NOMBRE_DEPENDENCIA,
		    (SELECT p.NOMBRE_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_TIPO_NOMBRAMIENTO) NOMBRE_TIPO_NOMBRAMIENTO,
		    (SELECT p.NOMBRE_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = epp.COD_CLASIFICACION_PLANTA) NOMBRE_PLANTA,
		    P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
        	P2.NOMBRE_PARAMETRO NOMBRE_CODIGO ,
        	ecp.COD_NATURALEZA_EMPLEO,
        	sav.fecha_inicio FECHA_INICIO_SA,
            sav.fecha_fin 	FECHA_FIN_SA
		FROM 
			VINCULACION v
        INNER JOIN SITUACION_ADMIN_VINCULACION sav ON sav.COD_VINCULACION = v.COD_VINCULACION
        INNER JOIN SITUACION_ADMINISTRATIVA sa ON sa.COD_SITUACION_ADMINISTRATIVA = sav.COD_SITUACION_ADMINISTRATIVA
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = sav.COD_ENTIDAD_PLANTA_DETALLE_ENCARGO
        INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
        INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
        INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
        LEFT JOIN PARAMETRICA P1 on ND.COD_GRADO = P1.COD_TABLA_PARAMETRICA
		LEFT JOIN PARAMETRICA P2 on ND.cod_codigo = P2.COD_TABLA_PARAMETRICA
		WHERE
		    v.COD_PERSONA= #{codPersona,jdbcType=NUMERIC}
		    AND sav.FLG_ACTIVO = 1
		    AND sav.FLG_ACTIVO = 1
            AND COALESCE(sav.FECHA_FIN,sysdate) &gt;= sysdate
		    <if test="flgActivo != null">
				AND v.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
			</if>
		    <if test="codEntidad != null">
				AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
			</if>
		ORDER BY v.FECHA_POSESION, sav.FECHA_INICIO DESC
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>
	
	<select id="selectVinculacionSituacionAdminPeriodoPrueba" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
		SELECT
     c.nombre_denominacion NOMBRE_CARGO,
    p1.nombre_parametro nombre_grado,
    (SELECT e.nombre_entidad FROM entidad e WHERE e.cod_entidad = sav.cod_entidad_comision) nombre_entidad,
    (SELECT d.nombre_dependencia FROM dependencia_entidad d WHERE d.cod_dependencia_entidad = sav.cod_dependencia_entidad) nombre_dependencia,
    (SELECT p.nombre_parametro FROM parametrica p WHERE p.cod_tabla_parametrica = v.cod_tipo_nombramiento) nombre_tipo_nombramiento,
    (SELECT p.nombre_parametro FROM parametrica p WHERE p.cod_tabla_parametrica = epp.cod_clasificacion_planta) nombre_planta,
    p2.nombre_parametro nombre_codigo,
    ecp.cod_naturaleza_empleo,
    sav.fecha_inicio    fecha_inicio_sa,
    sav.fecha_fin       fecha_fin_sa,
    v.fecha_posesion
FROM
         vinculacion v
    INNER JOIN situacion_admin_vinculacion sav ON sav.cod_vinculacion = v.cod_vinculacion
    INNER JOIN entidad_planta_detalle      ecp ON ecp.cod_entidad_planta_detalle = v.cod_entidad_planta_detalle
    INNER JOIN entidad_planta              epp ON epp.cod_entidad_planta = ecp.cod_entidad_planta
    INNER JOIN nomenclatura_denominacion   nd ON ecp.cod_nomenclatura_denominacion = nd.cod_nomenclatura_denominacion
    INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
    LEFT JOIN parametrica                 p1 ON nd.cod_grado = p1.cod_tabla_parametrica
    LEFT JOIN parametrica                 p2 ON nd.cod_codigo = p2.cod_tabla_parametrica
WHERE
        cod_persona = #{codPersona,jdbcType=NUMERIC}
    AND sav.flg_activo = 1
    AND v.flg_activo = 1
    and COALESCE(sav.fecha_fin, sysdate) &gt;= sysdate
    and sav.cod_situacion_administrativa = 16
    and epp.cod_entidad = #{codEntidad,jdbcType=NUMERIC}
    ORDER BY v.FECHA_POSESION, sav.FECHA_INICIO DESC
	</select>
	
<select id="selectMostrarVinculacionPeriodoDePrueba" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
	   	SELECT v.*, 
	   	c.nombre_denominacion NOMBRE_CARGO,
	   	ND.COD_GRADO, c.COD_DENOMINACION CODIGO_DAFP, ecp.COD_NATURALEZA_EMPLEO,
		E.NOMBRE_ENTIDAD,
		E.CODIGO_SIGEP  CODIGO_ENTIDAD,
		(SELECT d.NOMBRE_DEPENDENCIA FROM DEPENDENCIA_ENTIDAD d WHERE d.COD_DEPENDENCIA_ENTIDAD = v.COD_DEPENDENCIA_ENTIDAD) NOMBRE_DEPENDENCIA,
		(SELECT p.NOMBRE_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_TIPO_NOMBRAMIENTO) NOMBRE_TIPO_NOMBRAMIENTO,
		epp.nombre_planta NOMBRE_PLANTA,
		P.NOMBRE_PARAMETRO as NOMBRE_TIPO_ACTO_ADMINISTRATIVO,
		P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
        P2.NOMBRE_PARAMETRO NOMBRE_CODIGO
		FROM 
		VINCULACION v
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
        INNER JOIN ENTIDAD E ON E.COD_ENTIDAD = epp.COD_ENTIDAD
		LEFT JOIN PARAMETRICA P on v.COD_TIPO_ACTO_ADMIN_DESVINCULACION = P.COD_TABLA_PARAMETRICA
		LEFT JOIN PARAMETRICA P1 on ND.COD_GRADO = P1.COD_TABLA_PARAMETRICA
        LEFT JOIN PARAMETRICA P2 on ND.cod_codigo = P2.COD_TABLA_PARAMETRICA
		WHERE v.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
		    AND v.FECHA_FINALIZACION IS NULL
		<if test="flgActivo != null">
			AND v.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
		</if>
		<if test="codTipoNombramiento != null">
        	AND v.COD_TIPO_NOMBRAMIENTO = #{codTipoNombramiento,jdbcType=NUMERIC}
      	</if>
		ORDER BY v.AUD_FECHA_ACTUALIZACION DESC

	</select>
	
	<select id="selectMostrarVinculacionActual" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
	   	SELECT v.*, 
	   	c.nombre_denominacion NOMBRE_CARGO,
	   	ND.COD_GRADO, c.COD_DENOMINACION CODIGO_DAFP, ecp.COD_NATURALEZA_EMPLEO,
		E.NOMBRE_ENTIDAD,
		E.CODIGO_SIGEP  CODIGO_ENTIDAD,
		(SELECT d.NOMBRE_DEPENDENCIA FROM DEPENDENCIA_ENTIDAD d WHERE d.COD_DEPENDENCIA_ENTIDAD = v.COD_DEPENDENCIA_ENTIDAD) NOMBRE_DEPENDENCIA,
		(SELECT p.NOMBRE_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_TIPO_NOMBRAMIENTO) NOMBRE_TIPO_NOMBRAMIENTO,
		epp.nombre_planta NOMBRE_PLANTA,
		P.NOMBRE_PARAMETRO as NOMBRE_TIPO_ACTO_ADMINISTRATIVO,
		P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
        P2.NOMBRE_PARAMETRO NOMBRE_CODIGO
		FROM 
		VINCULACION v
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
        INNER JOIN ENTIDAD E ON E.COD_ENTIDAD = epp.COD_ENTIDAD
		LEFT JOIN PARAMETRICA P on v.COD_TIPO_ACTO_ADMIN_DESVINCULACION = P.COD_TABLA_PARAMETRICA
		LEFT JOIN PARAMETRICA P1 on ND.COD_GRADO = P1.COD_TABLA_PARAMETRICA
        LEFT JOIN PARAMETRICA P2 on ND.cod_codigo = cast(P2.COD_TABLA_PARAMETRICA as text)
		WHERE v.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
		    AND v.FECHA_FINALIZACION IS NULL
		<if test="flgActivo != null">
			AND v.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
		</if>
		<if test="codEntidad != null">
			AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		</if>
		<if test="codigoSigep != null">
			AND E.CODIGO_SIGEP = #{codigoSigep,jdbcType=NUMERIC}
		</if>
		ORDER BY v.AUD_FECHA_ACTUALIZACION DESC

	</select>
	
	<select id="selectUltimaVinDesv" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
	    SELECT v.*,
	    TRUNC((NVL(SYSDATE - v.AUD_FECHA_ACTUALIZACION, SYSDATE ) )) DIAS,
		 c.NOMBRE_DENOMINACION NOMBRE_CARGO,
		(SELECT e.NOMBRE_ENTIDAD FROM ENTIDAD e WHERE e.COD_ENTIDAD= epp.COD_ENTIDAD) NOMBRE_ENTIDAD,
		(SELECT e.CODIGO_SIGEP FROM ENTIDAD e WHERE e.COD_ENTIDAD= epp.COD_ENTIDAD) CODIGO_ENTIDAD,
		(SELECT d.NOMBRE_DEPENDENCIA FROM DEPENDENCIA_ENTIDAD d WHERE d.COD_DEPENDENCIA_ENTIDAD = v.COD_DEPENDENCIA_ENTIDAD) NOMBRE_DEPENDENCIA,
		(SELECT p.NOMBRE_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_TIPO_NOMBRAMIENTO) NOMBRE_TIPO_NOMBRAMIENTO,
		(SELECT p.NOMBRE_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = epp.COD_CLASIFICACION_PLANTA) NOMBRE_PLANTA,
		(SELECT p.VALOR_PARAMETRO FROM PARAMETRICA p WHERE p.COD_TABLA_PARAMETRICA = v.COD_CAUSAL_DESVINCULACION) NOMBRE_CAUSAL_DESV
		FROM 
		    VINCULACION v
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		 INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
		WHERE
		    v.COD_PERSONA= #{codPersona,jdbcType=NUMERIC}
		    AND NOT(v.COD_CAUSAL_DESVINCULACION is null and v.FECHA_FINALIZACION is not null)
		<if test="parCausalDesv != null">
			AND COALESCE(v.COD_CAUSAL_DESVINCULACION,1) != #{parCausalDesv,jdbcType=NUMERIC}
		</if>
		<if test="flgActivo != null">
			AND v.FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC}
		</if>
		<if test="codEntidad != null">
			AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		</if>
		ORDER BY v.AUD_FECHA_ACTUALIZACION DESC
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>
	<select id="selectVinculacionDes" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMap">
			SELECT v.*
				FROM 
				VINCULACION v
				INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
				INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
				INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
				INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
		        INNER JOIN ENTIDAD E ON E.COD_ENTIDAD = epp.COD_ENTIDAD
		        INNER JOIN PERSONA P ON V.COD_PERSONA = P.COD_PERSONA
			WHERE P.NUMERO_IDENTIFICACION =  #{numeroIdentificacion,jdbcType=NUMERIC}
				AND P.COD_TIPO_IDENTIFICACION = #{codTipoIentificacion,jdbcType=NUMERIC}
				AND v.FLG_ACTIVO = 1
				AND V.FECHA_FINALIZACION IS NULL
			    AND E.COD_ENTIDAD =  #{codEntidad,jdbcType=NUMERIC}
			   OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
    </select>   
    
    <select id="selectVinculacionesActivas" parameterType="java.math.BigDecimal" resultMap="BaseResultMap">
			SELECT * FROM VINCULACION 
				WHERE COD_PERSONA =  #{codPersona,jdbcType=NUMERIC}
				AND FLG_ACTIVO = 1
				AND FECHA_FINALIZACION IS NULL
    </select>   
    <select id="selectVacantes" parameterType="co.gov.dafp.sigep2.bean.ext.EntidadPlantaDetalleExt" resultMap="BaseResultMapExt">
		SELECT count(v.COD_ENTIDAD_PLANTA_DETALLE) CARGOS_VINCULACION, 
		tabla.COD_ENTIDAD_PLANTA_DETALLE,
		tabla.NOMBRE_CARGO, 
		tabla.COD_GRADO, 
		tabla.CODIGO_DAFP,
		tabla.PRIMER_NOMBRE,
		tabla.COD_NATURALEZA_EMPLEO,
		tabla.DEPENDENCIA_VINCULACION,
		tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		(tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL - count(v.COD_ENTIDAD_PLANTA_DETALLE)) VACANTES,
		tabla.nombre_grado,
        tabla.nombre_codigo,
		'PERMANENTE' TIPO_VACANCIA
		FROM
		(SELECT VINCULACION.COD_ENTIDAD_PLANTA_DETALLE FROM VINCULACION
		WHERE FECHA_FINALIZACION is null
		AND flg_Activo = 1
		) v,
		(SELECT  ecp.COD_ENTIDAD_PLANTA_DETALLE,
        c.nombre_denominacion NOMBRE_CARGO, nd.COD_GRADO, c.id_denominacion CODIGO_DAFP,
        persona.PRIMER_NOMBRE, ecp.COD_NATURALEZA_EMPLEO,
        persona.dependencia_vinculacion,
        ecp.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
        ecp.COD_TIPO_PLANTA,
        epp.COD_CLASIFICACION_PLANTA, epp.COD_CLASE_PLANTA, epp.COD_ENTIDAD,
        P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
        P2.NOMBRE_PARAMETRO NOMBRE_CODIGO
        FROM 
        ENTIDAD_PLANTA_DETALLE ecp
        INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA= ecp.COD_ENTIDAD_PLANTA
        INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
        INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
        LEFT JOIN PARAMETRICA P1 on ND.COD_GRADO = P1.COD_TABLA_PARAMETRICA
        LEFT JOIN PARAMETRICA P2 on ND.cod_codigo = P2.COD_TABLA_PARAMETRICA
		left join
		(
		select  ecp1.COD_ENTIDAD_PLANTA_DETALLE,p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO PRIMER_NOMBRE, 
                de.NOMBRE_DEPENDENCIA dependencia_vinculacion
                from   vinculacion v,
                ENTIDAD_PLANTA_DETALLE ecp1,
                NOMENCLATURA_DENOMINACION nd,
                denominacion cargo, persona p,
                DEPENDENCIA_ENTIDAD de,
		(select   max(v.FECHA_FINALIZACION) FECHA_FINALIZACION, max(v.COD_VINCULACION) COD_VINCULACION, ecp1.COD_ENTIDAD_PLANTA_DETALLE, de.COD_denominacion cod_cargo
                from   vinculacion v,
                ENTIDAD_PLANTA_DETALLE ecp1,
                NOMENCLATURA_DENOMINACION nd,
                denominacion de
                where  v.COD_ENTIDAD_PLANTA_DETALLE  = ecp1.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
                and    nd.COD_DENOMINACION = de.COD_denominacion
                and    v.FECHA_FINALIZACION is not null
                group by ecp1.COD_ENTIDAD_PLANTA_DETALLE, de.cod_denominacion) tabla
		where  v.COD_ENTIDAD_PLANTA_DETALLE = ecp1.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
                and    nd.COD_DENOMINACION = cargo.COD_denominacion
                and    v.COD_ENTIDAD_PLANTA_DETALLE  = tabla.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = tabla.cod_cargo
                and    v.FECHA_FINALIZACION = tabla.FECHA_FINALIZACION
                and    v.COD_VINCULACION = tabla.COD_VINCULACION
                and    v.cod_persona = p.cod_persona
                and    v.COD_DEPENDENCIA_ENTIDAD = de.COD_DEPENDENCIA_ENTIDAD
		)persona
		on ecp.COD_ENTIDAD_PLANTA_DETALLE = persona.COD_ENTIDAD_PLANTA_DETALLE
		WHERE epp.FLG_ACTIVO = 1
		AND epp.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		AND epp.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		ORDER BY NOMBRE_CARGO) tabla
		where tabla.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE (+)
		AND tabla.COD_NATURALEZA_EMPLEO =  #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		group by tabla.COD_ENTIDAD_PLANTA_DETALLE,
		tabla.NOMBRE_CARGO, tabla.COD_GRADO, tabla.CODIGO_DAFP,
		tabla.PRIMER_NOMBRE,tabla.COD_NATURALEZA_EMPLEO,
		tabla.dependencia_vinculacion,
		tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		tabla.COD_CLASIFICACION_PLANTA, tabla.COD_CLASE_PLANTA, tabla.COD_ENTIDAD,
		tabla.nombre_grado,
        tabla.nombre_codigo
		having (tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL - count(v.COD_ENTIDAD_PLANTA_DETALLE)) &gt; 0
    </select>  
    <select id="selectVacantesTempGlobal" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		SELECT p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO PRIMER_NOMBRE,
		     epd.COD_ENTIDAD_PLANTA_DETALLE,
		     d.NOMBRE_DENOMINACION NOMBRE_CARGO,
		     nd.COD_GRADO,
		     epd.COD_NATURALEZA_EMPLEO,
		     de.NOMBRE_DEPENDENCIA as DEPENDENCIA_VINCULACION,
		     epd.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		     'TEMPORAL' TIPO_VACANCIA,
		     P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
		     P2.NOMBRE_PARAMETRO NOMBRE_CODIGO,
		     0 PUESTOS_OCUPADOS_VINCULACION,
		     0 PUESTOS_OCUPADOS_SA,
		     sav.cod_situacion_admin_relacion_laboral,
		     sav.fecha_inicio FECHA_INICIO_SA,
     		 sav.fecha_fin FECHA_FIN_SA
		FROM SITUACION_ADMIN_VINCULACION sav
		INNER JOIN VINCULACION v ON v.COD_VINCULACION = sav.COD_VINCULACION
		INNER JOIN PERSONA p ON p.COD_PERSONA = v.COD_PERSONA
		INNER JOIN ENTIDAD_PLANTA_DETALLE epd ON epd.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN NOMENCLATURA_DENOMINACION nd ON nd.COD_NOMENCLATURA_DENOMINACION = epd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA ep ON ep.COD_ENTIDAD_PLANTA = epd.COD_ENTIDAD_PLANTA
		INNER JOIN SITUACION_ADMINISTRATIVA sa ON sa.COD_SITUACION_ADMINISTRATIVA= sav.COD_SITUACION_ADMINISTRATIVA
		INNER JOIN DENOMINACION d ON d.COD_DENOMINACION = nd.COD_DENOMINACION
		LEFT JOIN PARAMETRICA P1 on P1.COD_TABLA_PARAMETRICA = ND.COD_GRADO 
		LEFT JOIN PARAMETRICA P2 on P2.COD_TABLA_PARAMETRICA = ND.cod_codigo 
		left join DEPENDENCIA_ENTIDAD de on de.cod_dependencia_entidad = v.cod_dependencia_entidad
		WHERE 1=1
		AND (sav.COD_SITUACION_ADMINISTRATIVA in (13, 14, 15, 16, 18, 19, 36, 37, 38, 39, 45, 46, 47, 48, 49, 50)
		    or (sav.COD_SITUACION_ADMINISTRATIVA in (10, 22, 23, 29) and (trunc(sav.FECHA_INICIO) + 20) &lt;= trunc(sysdate))
		    or (SA.COD_SITUACIONADMIN_PADRE=9 AND (trunc(sav.FECHA_INICIO) + 20) &lt;= trunc(sysdate))
		    )
		AND ep.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		AND ep.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		AND ep.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		AND sav.fecha_inicio &lt;= sysdate
		AND NVL(sav.FECHA_FIN,SYSDATE) &gt;= SYSDATE
		AND EPD.COD_TIPO_PLANTA = 1957
		AND sav.flg_activo = 1
		AND epd.COD_NATURALEZA_EMPLEO = #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		AND COD_SA_OCUPA_TEMPORAL IS NULL
		
	</select>
	<select id="selectVacantesTemyPermGlobal" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		SELECT p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO PRIMER_NOMBRE,
		     epd.COD_ENTIDAD_PLANTA_DETALLE,
		     d.NOMBRE_DENOMINACION NOMBRE_CARGO,
		     nd.COD_GRADO,
		     epd.COD_NATURALEZA_EMPLEO,
		     de.NOMBRE_DEPENDENCIA as DEPENDENCIA_VINCULACION,
		     epd.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		     'TEMPORAL' TIPO_VACANCIA,
		     P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
		     P2.NOMBRE_PARAMETRO NOMBRE_CODIGO,
		     0 PUESTOS_OCUPADOS_VINCULACION,
		     0 PUESTOS_OCUPADOS_SA,
		     sav.cod_situacion_admin_relacion_laboral,
		     sav.fecha_inicio FECHA_INICIO_SA,
     		 sav.fecha_fin FECHA_FIN_SA
		FROM SITUACION_ADMIN_VINCULACION sav
		INNER JOIN VINCULACION v ON v.COD_VINCULACION = sav.COD_VINCULACION
		INNER JOIN PERSONA p ON p.COD_PERSONA = v.COD_PERSONA
		INNER JOIN ENTIDAD_PLANTA_DETALLE epd ON epd.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN NOMENCLATURA_DENOMINACION nd ON nd.COD_NOMENCLATURA_DENOMINACION = epd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA ep ON ep.COD_ENTIDAD_PLANTA = epd.COD_ENTIDAD_PLANTA
		INNER JOIN SITUACION_ADMINISTRATIVA sa ON sa.COD_SITUACION_ADMINISTRATIVA= sav.COD_SITUACION_ADMINISTRATIVA
		INNER JOIN DENOMINACION d ON d.COD_DENOMINACION = nd.COD_DENOMINACION
		LEFT JOIN PARAMETRICA P1 on P1.COD_TABLA_PARAMETRICA = ND.COD_GRADO 
		LEFT JOIN PARAMETRICA P2 on P2.COD_TABLA_PARAMETRICA = ND.cod_codigo 
		left join DEPENDENCIA_ENTIDAD de on de.cod_dependencia_entidad = v.cod_dependencia_entidad
		WHERE 1=1
		AND (sav.COD_SITUACION_ADMINISTRATIVA in (13, 14, 15, 16, 18, 19, 36, 37, 38, 39, 45, 46, 47, 48, 49, 50)
		    or (sav.COD_SITUACION_ADMINISTRATIVA in (10, 22, 23, 29) and (trunc(sav.FECHA_INICIO) + 20) &lt;= trunc(sysdate))
		    or (SA.COD_SITUACIONADMIN_PADRE=9 AND (trunc(sav.FECHA_INICIO) + 20) &lt;= trunc(sysdate))
		    )
		AND ep.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		AND ep.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		AND ep.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		AND sav.fecha_inicio &lt;= sysdate
		AND NVL(sav.FECHA_FIN,SYSDATE) &gt;= SYSDATE
		AND EPD.COD_TIPO_PLANTA = 1957
		AND sav.flg_activo = 1
		AND epd.COD_NATURALEZA_EMPLEO = #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		AND COD_SA_OCUPA_TEMPORAL IS NULL
		
		UNION
		
		select a.PRIMER_NOMBRE, a.COD_ENTIDAD_PLANTA_DETALLE,
		       a.NOMBRE_CARGO, a.COD_GRADO, a.COD_NATURALEZA_EMPLEO,
		       a.DEPENDENCIA_VINCULACION, a.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		       a.TIPO_VACANCIA, a.NOMBRE_GRADO, a.NOMBRE_CODIGO, 
		       a.PUESTOS_OCUPADOS_VINCULACION,
		       a.PUESTOS_OCUPADOS_SA,
		       a.cod_situacion_admin_relacion_laboral,
		        a.fecha_inicio_sa,
               a.fecha_fin_sa
		from (
		    select '' PRIMER_NOMBRE,
		     epd.COD_ENTIDAD_PLANTA_DETALLE,
		     d.NOMBRE_DENOMINACION NOMBRE_CARGO,
		     nd.COD_GRADO,
		     epd.COD_NATURALEZA_EMPLEO,
		     '' DEPENDENCIA_VINCULACION,
		     epd.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		     'PERMANENTE' TIPO_VACANCIA,
		     P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
		     P2.NOMBRE_PARAMETRO NOMBRE_CODIGO,
		    (SELECT COUNT(v.COD_VINCULACION) from VINCULACION v where v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
		        and v.FLG_ACTIVO = 1 and v.FECHA_FINALIZACION is null) PUESTOS_OCUPADOS_VINCULACION,
		    (SELECT count(sav.COD_ENTIDAD_PLANTA_DETALLE_ENCARGO) from SITUACION_ADMIN_VINCULACION sav 
		        where sav.COD_ENTIDAD_PLANTA_DETALLE_ENCARGO = epd.COD_ENTIDAD_PLANTA_DETALLE
		        and sav.FLG_ACTIVO = 1) PUESTOS_OCUPADOS_SA,
		    0 cod_situacion_admin_relacion_laboral,
		    null FECHA_INICIO_SA,
     		null FECHA_FIN_SA
		    from ENTIDAD_PLANTA_DETALLE epd
		    inner join ENTIDAD_PLANTA ep on ep.COD_ENTIDAD_PLANTA = epd.COD_ENTIDAD_PLANTA
		    inner join NOMENCLATURA_DENOMINACION nd on nd.COD_NOMENCLATURA_DENOMINACION = epd.COD_NOMENCLATURA_DENOMINACION
		    inner join DENOMINACION d on d.COD_DENOMINACION = nd.COD_DENOMINACION
		    LEFT JOIN PARAMETRICA P1 on P1.COD_TABLA_PARAMETRICA = ND.COD_GRADO 
		    LEFT JOIN PARAMETRICA P2 on P2.COD_TABLA_PARAMETRICA = ND.cod_codigo
		    where 1=1
		    AND ep.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		    AND ep.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		    AND ep.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		    AND epd.COD_TIPO_PLANTA = 1957
		    AND epd.COD_NATURALEZA_EMPLEO = #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		 )a
		 group by a.PRIMER_NOMBRE, a.COD_ENTIDAD_PLANTA_DETALLE, a.NOMBRE_CARGO,a.COD_GRADO,
		 a.COD_NATURALEZA_EMPLEO,a.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		 a.NOMBRE_GRADO ,
		 a.NOMBRE_CODIGO,
		 a.PUESTOS_OCUPADOS_SA, a.DEPENDENCIA_VINCULACION, a.TIPO_VACANCIA, a.PUESTOS_OCUPADOS_VINCULACION,
		 a.cod_situacion_admin_relacion_laboral,
		 a.fecha_inicio_sa,
         a.fecha_fin_sa
		having (a.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL - (a.PUESTOS_OCUPADOS_SA + a.PUESTOS_OCUPADOS_VINCULACION )) &gt; 0			
	</select>
	
	<select id="selectVacantesGlobal" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		SELECT count(v.COD_ENTIDAD_PLANTA_DETALLE) CARGOS_VINCULACION, 
		tabla.COD_ENTIDAD_PLANTA_DETALLE,
		tabla.NOMBRE_CARGO, 
		tabla.COD_GRADO, 
		tabla.CODIGO_DAFP,
		tabla.PRIMER_NOMBRE,
		tabla.COD_NATURALEZA_EMPLEO,
		tabla.DEPENDENCIA_VINCULACION,
		tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		(tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL - count(v.COD_ENTIDAD_PLANTA_DETALLE)) VACANTES,
		'PERMANENTE' TIPO_VACANCIA
		FROM
		(SELECT VINCULACION.COD_ENTIDAD_PLANTA_DETALLE FROM VINCULACION
		WHERE FECHA_FINALIZACION is null
		AND flg_Activo = 1
		) v,
		(SELECT  ecp.COD_ENTIDAD_PLANTA_DETALLE,
        c.nombre_denominacion NOMBRE_CARGO, nd.COD_GRADO, c.id_denominacion CODIGO_DAFP,
        persona.PRIMER_NOMBRE, ecp.COD_NATURALEZA_EMPLEO,
        persona.dependencia_vinculacion,
        ecp.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
        ecp.COD_TIPO_PLANTA,
        epp.COD_CLASIFICACION_PLANTA, epp.COD_CLASE_PLANTA, epp.COD_ENTIDAD
        FROM 
        ENTIDAD_PLANTA_DETALLE ecp
        INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA= ecp.COD_ENTIDAD_PLANTA
        INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
        INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
		left join
		(
		select  ecp1.COD_ENTIDAD_PLANTA_DETALLE,p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO PRIMER_NOMBRE, 
                de.NOMBRE_DEPENDENCIA dependencia_vinculacion
                from   vinculacion v,
                ENTIDAD_PLANTA_DETALLE ecp1,
                NOMENCLATURA_DENOMINACION nd,
                denominacion cargo, persona p,
                DEPENDENCIA_ENTIDAD de,
		(select   max(v.FECHA_FINALIZACION) FECHA_FINALIZACION, max(v.COD_VINCULACION) COD_VINCULACION, ecp1.COD_ENTIDAD_PLANTA_DETALLE, de.COD_denominacion cod_cargo
                from   vinculacion v,
                ENTIDAD_PLANTA_DETALLE ecp1,
                NOMENCLATURA_DENOMINACION nd,
                denominacion de
                where  v.COD_ENTIDAD_PLANTA_DETALLE  = ecp1.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
                and    nd.COD_DENOMINACION = de.COD_denominacion
                and    v.FECHA_FINALIZACION is not null
                group by ecp1.COD_ENTIDAD_PLANTA_DETALLE, de.cod_denominacion) tabla
		where  v.COD_ENTIDAD_PLANTA_DETALLE = ecp1.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
                and    nd.COD_DENOMINACION = cargo.COD_denominacion
                and    v.COD_ENTIDAD_PLANTA_DETALLE  = tabla.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = tabla.cod_cargo
                and    v.FECHA_FINALIZACION = tabla.FECHA_FINALIZACION
                and    v.COD_VINCULACION = tabla.COD_VINCULACION
                and    v.cod_persona = p.cod_persona
                and    v.COD_DEPENDENCIA_ENTIDAD = de.COD_DEPENDENCIA_ENTIDAD
		)persona
		on ecp.COD_ENTIDAD_PLANTA_DETALLE = persona.COD_ENTIDAD_PLANTA_DETALLE
		WHERE epp.FLG_ACTIVO = 1
		AND epp.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		AND epp.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		ORDER BY NOMBRE_CARGO) tabla
		where tabla.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE (+)
		AND tabla.COD_TIPO_PLANTA = 1957
		AND tabla.COD_NATURALEZA_EMPLEO =  #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		group by tabla.COD_ENTIDAD_PLANTA_DETALLE,
		tabla.NOMBRE_CARGO, tabla.COD_GRADO, tabla.CODIGO_DAFP,
		tabla.PRIMER_NOMBRE,tabla.COD_NATURALEZA_EMPLEO,
		tabla.dependencia_vinculacion,
		tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		tabla.COD_CLASIFICACION_PLANTA, tabla.COD_CLASE_PLANTA, tabla.COD_ENTIDAD
		having (tabla.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL - count(v.COD_ENTIDAD_PLANTA_DETALLE)) &gt; 0
	</select>

	<select id="selectCargosFuncionario" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		SELECT max(V.COD_VINCULACION) COD_VINCULACION,
		V.COD_PERSONA,
		P.NOMBRE_PARAMETRO NOMBRE_TIPO_NOMBRAMIENTO,
		tabla.COD_ENTIDAD_PLANTA_DETALLE,
		tabla.NOMBRE_CARGO, 
		tabla.COD_GRADO, 
		tabla.CODIGO_DAFP,
		tabla.PRIMER_NOMBRE,
		tabla.COD_NATURALEZA_EMPLEO,
		tabla.DEPENDENCIA_VINCULACION,
		tabla.NOMBRE_GRADO,
        tabla.NOMBRE_CODIGO,
		'PERMANENTE' TIPO_VACANCIA
		FROM 
		VINCULACION v,
		PARAMETRICA p,
		(SELECT  ecp.COD_ENTIDAD_PLANTA_DETALLE,
		CONCAT(c.nombre_denominacion, concat( concat(' - ',P2.NOMBRE_PARAMETRO), concat(' - ',P1.NOMBRE_PARAMETRO) )) NOMBRE_CARGO,
		nd.COD_GRADO, c.id_denominacion CODIGO_DAFP,
        persona.PRIMER_NOMBRE, ecp.COD_NATURALEZA_EMPLEO,
        persona.dependencia_vinculacion,
        ecp.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
        ecp.COD_TIPO_PLANTA,
        epp.COD_CLASIFICACION_PLANTA, epp.COD_CLASE_PLANTA, epp.COD_ENTIDAD,
        P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
        P2.NOMBRE_PARAMETRO NOMBRE_CODIGO
        FROM 
        ENTIDAD_PLANTA_DETALLE ecp
        INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA= ecp.COD_ENTIDAD_PLANTA
        INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
        INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
        LEFT JOIN PARAMETRICA P1 on ND.COD_GRADO = P1.COD_TABLA_PARAMETRICA
        LEFT JOIN PARAMETRICA P2 on ND.cod_codigo = P2.COD_TABLA_PARAMETRICA
        left join
                (
                select  ecp1.COD_ENTIDAD_PLANTA_DETALLE,p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO PRIMER_NOMBRE, 
                de.NOMBRE_DEPENDENCIA dependencia_vinculacion
                from   vinculacion v,
                ENTIDAD_PLANTA_DETALLE ecp1,
                NOMENCLATURA_DENOMINACION nd,
                denominacion cargo, persona p,
                DEPENDENCIA_ENTIDAD de,
                
                (select   max(v.FECHA_FINALIZACION) FECHA_FINALIZACION, max(v.COD_VINCULACION) COD_VINCULACION, ecp1.COD_ENTIDAD_PLANTA_DETALLE, de.COD_denominacion cod_cargo
                from   vinculacion v,
                ENTIDAD_PLANTA_DETALLE ecp1,
                NOMENCLATURA_DENOMINACION nd,
                denominacion de
                where  v.COD_ENTIDAD_PLANTA_DETALLE  = ecp1.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
                and    nd.COD_DENOMINACION = de.COD_denominacion
                and    v.FECHA_FINALIZACION is not null
                group by ecp1.COD_ENTIDAD_PLANTA_DETALLE, de.cod_denominacion) tabla
                
                where  v.COD_ENTIDAD_PLANTA_DETALLE = ecp1.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
                and    nd.COD_DENOMINACION = cargo.COD_denominacion
                and    v.COD_ENTIDAD_PLANTA_DETALLE  = tabla.COD_ENTIDAD_PLANTA_DETALLE
                and    ecp1.COD_NOMENCLATURA_DENOMINACION = tabla.cod_cargo
                and    v.FECHA_FINALIZACION = tabla.FECHA_FINALIZACION
                and    v.COD_VINCULACION = tabla.COD_VINCULACION
                and    v.cod_persona = p.cod_persona
                and    v.COD_DEPENDENCIA_ENTIDAD = de.COD_DEPENDENCIA_ENTIDAD
                )persona 
        on ecp.COD_ENTIDAD_PLANTA_DETALLE = persona.COD_ENTIDAD_PLANTA_DETALLE
        ) tabla
		WHERE tabla.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		AND v.COD_TIPO_NOMBRAMIENTO = P.COD_TABLA_PARAMETRICA
		and v.cod_persona = #{codPersona,jdbcType=NUMERIC}
 	      <if test="codVinculacion != 0">
	        and v.COD_VINCULACION = #{codVinculacion,jdbcType=NUMERIC}
	      </if>
		group by V.COD_PERSONA,
		P.NOMBRE_PARAMETRO,
		tabla.COD_ENTIDAD_PLANTA_DETALLE,
		tabla.NOMBRE_CARGO, 
		tabla.COD_GRADO, 
		tabla.CODIGO_DAFP,
		tabla.PRIMER_NOMBRE,
		tabla.COD_NATURALEZA_EMPLEO,
		tabla.DEPENDENCIA_VINCULACION,
		tabla.NOMBRE_GRADO,
        tabla.NOMBRE_CODIGO
        order by  max(V.COD_VINCULACION) desc
	</select>
	
	<select id="selectVinculacionPorPlantaPersonal" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		SELECT v.*,  c.nombre_denominacion NOMBRE_CARGO,
              c.cod_denominacion, pe.cod_persona,
			  pe.PRIMER_NOMBRE,
			  pe.SEGUNDO_NOMBRE,
			  pe.PRIMER_APELLIDO,
			  pe.SEGUNDO_APELLIDO,
			  pe.COD_TIPO_IDENTIFICACION,
			  pe.NUMERO_IDENTIFICACION
		FROM VINCULACION v
		inner join persona pe on v.cod_persona = pe.cod_persona
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE  = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
		INNER JOIN NOMENCLATURA_DENOMINACION nd on ecp.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
        INNER JOIN DENOMINACION c ON nd.COD_DENOMINACION = c.COD_DENOMINACION
		WHERE 1=1
			AND (v.FLG_ACTIVO = 1 AND v.FECHA_FINALIZACION IS NULL)
		 <if test="codPlantaPersonal != null">
			AND ecp.COD_ENTIDAD_PLANTA = #{codPlantaPersonal,jdbcType=NUMERIC}
		 </if>
		 <if test="codEntidad != null">
			AND epp.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		 </if>
		 <if test="codNomenclaturaDenominacion != null">
		 	AND nd.cod_nomenclatura_denominacion = #{codNomenclaturaDenominacion,jdbcType=NUMERIC}
		 </if>
			
    </select> 
    
	<update id="updateDesvinculacionAutomaticaPlanta" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt">
		UPDATE VINCULACION 
			SET COD_CAUSAL_DESVINCULACION = #{codCausalDesvinculacion,jdbcType=NUMERIC},
			 	FLG_ACTIVO = #{flgActivo,jdbcType=NUMERIC},
				FECHA_FINALIZACION = #{fechaFinalizacion,jdbcType=TIMESTAMP},
				AUD_ACCION = #{audAccion,jdbcType=NUMERIC},
				AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
				AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
				AUD_COD_ROL= #{audCodRol,jdbcType=NUMERIC}
		WHERE COD_VINCULACION IN (
			SELECT v.COD_VINCULACION
			FROM VINCULACION v
				INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
				INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
			WHERE 1=1
				AND ecp.COD_ENTIDAD_PLANTA = #{codPlantaPersonal,jdbcType=NUMERIC}
				AND v.FLG_ACTIVO = 1)
    </update>
    
    <select id="selectVinculacionMismaEntidad" parameterType="co.gov.dafp.sigep2.bean.Vinculacion" resultMap="BaseResultMapExt">
	    SELECT distinct v.*,
		    e.NOMBRE_ENTIDAD,
		    e.COD_ENTIDAD
		FROM 
		    VINCULACION v
		INNER JOIN ENTIDAD_PLANTA_DETALLE ecp ON ecp.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN ENTIDAD_PLANTA epp ON epp.COD_ENTIDAD_PLANTA = ecp.COD_ENTIDAD_PLANTA
		INNER JOIN ENTIDAD e ON e.COD_ENTIDAD = epp.COD_ENTIDAD
		WHERE v.COD_VINCULACION > 0
		AND ecp.FLG_ACTIVO = 1
		AND v.FLG_ACTIVO = 1
		AND v.COD_PERSONA = #{codPersona,jdbcType=NUMERIC}
		AND (e.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC})
		ORDER BY v.COD_VINCULACION DESC
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>
	<select id="selectVinculacionSenadoresCongresistas" parameterType="co.gov.dafp.sigep2.bean.ext.EntidadExt" resultMap="BaseResultMapExt">
		SELECT DISTINCT P.PRIMER_NOMBRE, P.SEGUNDO_NOMBRE, P.PRIMER_APELLIDO, P.SEGUNDO_APELLIDO, V.COD_PERSONA, E.COD_ENTIDAD FROM ENTIDAD_PLANTA_DETALLE EPD
		         INNER JOIN NOMENCLATURA_DENOMINACION ND ON EPD.COD_NOMENCLATURA_DENOMINACION = ND.COD_NOMENCLATURA_DENOMINACION
		         INNER JOIN DENOMINACION D ON ND.COD_DENOMINACION  = D.COD_DENOMINACION
		         INNER JOIN ENTIDAD_PLANTA EP ON EP.COD_ENTIDAD_PLANTA = EPD.COD_ENTIDAD_PLANTA
		         INNER JOIN ENTIDAD E ON EP.COD_ENTIDAD = E.COD_ENTIDAD
		         INNER JOIN VINCULACION V ON V.COD_ENTIDAD_PLANTA_DETALLE = EPD.COD_ENTIDAD_PLANTA_DETALLE
		         INNER JOIN PERSONA P ON P.COD_PERSONA = V.COD_PERSONA
        	 WHERE D.ID_DENOMINACION = #{idDenominacion,jdbcType=NUMERIC}
        	    <if test="codEntidad != null">
        		     AND E.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC} 
        		</if>
	</select>
	
	<select id="selectPersonaEntidad" parameterType="co.gov.dafp.sigep2.portal.BusquedaPortal" resultMap="BaseResultMapExt">
		select ep.cod_entidad from vinculacion v
                              inner join persona p on p.cod_persona = v.cod_Persona
                              inner join entidad_planta_detalle  epd on v.cod_entidad_planta_detalle = epd.cod_entidad_planta_detalle
                              inner join entidad_planta ep on ep.cod_entidad_planta = epd.cod_entidad_planta
                       where v.flg_activo = 1
                         and v.fecha_finalizacion is null
                       <if test="numeroIdentificacion != null">
                        and p.numero_identificacion = '#{numeroIdentificacion,jdbcType=VARCHAR}
                        </if>
                        <if test="codTipoIdentificacion != null">
                           and p.cod_tipo_identificacion = #{codTipoIdentificacion,jdbcType=NUMERIC}
                        </if>
                        <if test="codPersona != null">
                           and p.cod_persona = #{codPersona,jdbcType=NUMERIC}
                        </if>
	</select>
	<select id="selectVacantesTemyPermGlobalyEstructural" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		SELECT p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO PRIMER_NOMBRE,
		     epd.COD_ENTIDAD_PLANTA_DETALLE,
		     d.NOMBRE_DENOMINACION NOMBRE_CARGO,
		     nd.COD_GRADO,
		     epd.COD_NATURALEZA_EMPLEO,
		     de.NOMBRE_DEPENDENCIA as DEPENDENCIA_VINCULACION,
		     epd.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		     'TEMPORAL' TIPO_VACANCIA,
		     P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
		     P2.NOMBRE_PARAMETRO NOMBRE_CODIGO,
		     0 PUESTOS_OCUPADOS_VINCULACION,
		     0 PUESTOS_OCUPADOS_SA,
		     sav.cod_situacion_admin_relacion_laboral,
		     sav.fecha_inicio FECHA_INICIO_SA,
     		 sav.fecha_fin FECHA_FIN_SA
		FROM SITUACION_ADMIN_VINCULACION sav
		INNER JOIN VINCULACION v ON v.COD_VINCULACION = sav.COD_VINCULACION
		INNER JOIN PERSONA p ON p.COD_PERSONA = v.COD_PERSONA
		INNER JOIN ENTIDAD_PLANTA_DETALLE epd ON epd.COD_ENTIDAD_PLANTA_DETALLE = v.COD_ENTIDAD_PLANTA_DETALLE
		INNER JOIN NOMENCLATURA_DENOMINACION nd ON nd.COD_NOMENCLATURA_DENOMINACION = epd.COD_NOMENCLATURA_DENOMINACION
		INNER JOIN ENTIDAD_PLANTA ep ON ep.COD_ENTIDAD_PLANTA = epd.COD_ENTIDAD_PLANTA
		INNER JOIN SITUACION_ADMINISTRATIVA sa ON sa.COD_SITUACION_ADMINISTRATIVA= sav.COD_SITUACION_ADMINISTRATIVA
		INNER JOIN DENOMINACION d ON d.COD_DENOMINACION = nd.COD_DENOMINACION
		LEFT JOIN PARAMETRICA P1 on P1.COD_TABLA_PARAMETRICA = ND.COD_GRADO 
		LEFT JOIN PARAMETRICA P2 on P2.COD_TABLA_PARAMETRICA = ND.cod_codigo 
		left join DEPENDENCIA_ENTIDAD de on de.cod_dependencia_entidad = v.cod_dependencia_entidad
		WHERE 1=1
		AND (sav.COD_SITUACION_ADMINISTRATIVA in (13, 14, 15, 16, 18, 19, 36, 37, 38, 39, 45, 46, 47, 48, 49, 50, 21)
		    or (sav.COD_SITUACION_ADMINISTRATIVA in (10, 22, 23, 29) and (trunc(sav.FECHA_INICIO) + 20) &lt;= trunc(sysdate))
		    or (SA.COD_SITUACIONADMIN_PADRE=9 AND (trunc(sav.FECHA_INICIO) + 20) &lt;= trunc(sysdate))
		    )
		AND ep.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		AND ep.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		AND ep.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		AND sav.fecha_inicio &lt;= sysdate
		AND NVL(sav.FECHA_FIN,SYSDATE) &gt;= SYSDATE
		AND sav.flg_activo = 1
		and v.flg_activo = 1
		AND epd.COD_NATURALEZA_EMPLEO = #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		AND COD_SA_OCUPA_TEMPORAL IS NULL
		
		UNION
		
		select a.PRIMER_NOMBRE, a.COD_ENTIDAD_PLANTA_DETALLE,
		       a.NOMBRE_CARGO, a.COD_GRADO, a.COD_NATURALEZA_EMPLEO,
		       a.DEPENDENCIA_VINCULACION, a.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		       a.TIPO_VACANCIA, a.NOMBRE_GRADO, a.NOMBRE_CODIGO, 
		       a.PUESTOS_OCUPADOS_VINCULACION,
		       a.PUESTOS_OCUPADOS_SA,
		       a.cod_situacion_admin_relacion_laboral,
		       null FECHA_INICIO_SA,
     		   null FECHA_FIN_SA
		from (
		    select '' PRIMER_NOMBRE,
		     epd.COD_ENTIDAD_PLANTA_DETALLE,
		     d.NOMBRE_DENOMINACION NOMBRE_CARGO,
		     nd.COD_GRADO,
		     epd.COD_NATURALEZA_EMPLEO,
		     '' DEPENDENCIA_VINCULACION,
		     epd.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		     'PERMANENTE' TIPO_VACANCIA,
		     P1.NOMBRE_PARAMETRO NOMBRE_GRADO,
		     P2.NOMBRE_PARAMETRO NOMBRE_CODIGO,
		    (SELECT COUNT(v.COD_VINCULACION) from VINCULACION v where v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
		        and v.FLG_ACTIVO = 1 and v.FECHA_FINALIZACION is null
		         and (v.cod_vinculacion not in (select sa.COD_VINCULACION from situacion_admin_vinculacion sa 
			                            	where sa.COD_VINCULACION = v.cod_vinculacion and sa.flg_activo = 1 
			                            	and (sa.cod_entidad_planta_detalle_encargo is not null
			                            	or sa.cod_situacion_administrativa = 16)
			                            	))
		        
		        ) PUESTOS_OCUPADOS_VINCULACION,
		    (SELECT count(sav.COD_ENTIDAD_PLANTA_DETALLE_ENCARGO) from SITUACION_ADMIN_VINCULACION sav
		    	inner join vinculacion  v on v.cod_vinculacion = sav.cod_vinculacion 
		        where sav.COD_ENTIDAD_PLANTA_DETALLE_ENCARGO = epd.COD_ENTIDAD_PLANTA_DETALLE
		        and sav.FLG_ACTIVO = 1
		        and v.flg_activo = 1) PUESTOS_OCUPADOS_SA,
		    0 cod_situacion_admin_relacion_laboral,
		    null FECHA_INICIO_SA,
     		null FECHA_FIN_SA
		    from ENTIDAD_PLANTA_DETALLE epd
		    inner join ENTIDAD_PLANTA ep on ep.COD_ENTIDAD_PLANTA = epd.COD_ENTIDAD_PLANTA
		    inner join NOMENCLATURA_DENOMINACION nd on nd.COD_NOMENCLATURA_DENOMINACION = epd.COD_NOMENCLATURA_DENOMINACION
		    inner join DENOMINACION d on d.COD_DENOMINACION = nd.COD_DENOMINACION
		    LEFT JOIN PARAMETRICA P1 on P1.COD_TABLA_PARAMETRICA = ND.COD_GRADO 
		    LEFT JOIN PARAMETRICA P2 on P2.COD_TABLA_PARAMETRICA = ND.cod_codigo
		    where 1=1
		    AND ep.COD_CLASIFICACION_PLANTA = #{codClasificacionPlanta,jdbcType=NUMERIC}
		    AND ep.COD_CLASE_PLANTA = #{codClasePlanta,jdbcType=NUMERIC}
		    AND ep.COD_ENTIDAD = #{codEntidad,jdbcType=NUMERIC}
		    AND epd.COD_NATURALEZA_EMPLEO = #{codNaturalezaEmpleo,jdbcType=NUMERIC}
		 )a
		 group by a.PRIMER_NOMBRE, a.COD_ENTIDAD_PLANTA_DETALLE, a.NOMBRE_CARGO,a.COD_GRADO,
		 a.COD_NATURALEZA_EMPLEO,a.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL,
		 a.NOMBRE_GRADO ,
		 a.NOMBRE_CODIGO,
		 a.PUESTOS_OCUPADOS_SA, a.DEPENDENCIA_VINCULACION, a.TIPO_VACANCIA, a.PUESTOS_OCUPADOS_VINCULACION,
		 a.cod_situacion_admin_relacion_laboral
		having (a.CANTIDAD_CARGO_APROPIACION_PRESUPUESTAL - (a.PUESTOS_OCUPADOS_SA + a.PUESTOS_OCUPADOS_VINCULACION )) &gt; 0
	</select>
	<select id="selectVinDesvAlerta" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		
		select 
			cod_entidad codigo_entidad, codigo_sigep, nombre_entidad,aud_fecha_actualizacion aud_fecha_actualizacion,nombre_usuario, nombre_rol,cod_vinculacion,
			(CASE WHEN flg_activo = 1 THEN 'Vinculación de ' ELSE 'Desvinculación de ' END) || persona || ' con ' || tipo_documento || ' ' || NUMERO_IDENTIFICACION || ' presenta cambios en los siguientes campos: ' || (select substr(rtrim (xmlagg (xmlelement (e,nombre_campo ||' del valor '|| VALOR_ANTERIOR ||' al valor '|| valor_nuevo|| '; ')).extract ('//text()').getClobVal(), ','),1,3999)
			                from auditoria where cod_referencia = cod_vinculacion and nombre_tabla ='VINCULACION') detalle
			from(
				select v.aud_fecha_actualizacion aud_fecha_actualizacion,v.cod_vinculacion cod_vinculacion,
				       e.cod_entidad cod_entidad, e.codigo_sigep codigo_sigep,e.nombre_entidad nombre_entidad,
				       MAX(v.aud_fecha_actualizacion) OVER (PARTITION BY e.cod_entidad) AS last_enrolment_date,
				       p.primer_nombre ||' ' ||p.primer_apellido nombre_usuario, r.nombre nombre_rol,
				       p.NUMERO_IDENTIFICACION,
				       (SELECT nombre_parametro FROM PARAMETRICA p2 WHERE COD_TABLA_PARAMETRICA = p.COD_TIPO_IDENTIFICACION) tipo_documento,
				        v.flg_activo,
				        (SELECT (PRIMER_NOMBRE || ' ' || PRIMER_APELLIDO || ' ' || SEGUNDO_APELLIDO) FROM PERSONA p WHERE P.COD_PERSONA =v.cod_persona) persona
				from   vinculacion v, ENTIDAD_PLANTA_DETALLE epd, entidad_planta ep, entidad e, usuario u, rol r, persona p
				where  round(sysdate - v.AUD_FECHA_ACTUALIZACION) &gt; #{diasNotificacion,jdbcType=NUMERIC}
				and    v.flg_activo = #{flgVinculacion,jdbcType=NUMERIC}
				and    v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
				and    epd.COD_ENTIDAD_PLANTA = ep.COD_ENTIDAD_PLANTA
				and    ep.cod_entidad = e.cod_entidad
				and    u.cod_usuario = v.aud_cod_usuario
				and    r.cod_rol = v.aud_cod_rol
				and    u.cod_persona = p.cod_persona
			)
		where aud_fecha_actualizacion = last_enrolment_date
	</select>
	<select id="selectSituacionesAdmAlerta" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">		
				
		select 
			cod_entidad codigo_entidad, codigo_sigep,nombre_entidad,aud_fecha_actualizacion aud_fecha_actualizacion,nombre_usuario, nombre_rol,cod_vinculacion,
			'La situación administrativa de '|| persona || ' con ' || tipo_documento || ' ' || NUMERO_IDENTIFICACION || ' presenta cambios en los siguientes campos: ' ||
			(select substr(rtrim (xmlagg (xmlelement (e,nombre_campo ||'-'||valor_nuevo|| ';')).extract ('//text()').getClobVal(), ','),1,3999)  
			                from auditoria where cod_referencia = cod_situacion_admin_relacion_laboral and nombre_tabla ='SITUACION_ADMIN_VINCULACION') detalle
			from(
			select sa.aud_fecha_actualizacion aud_fecha_actualizacion,v.cod_vinculacion cod_vinculacion,
			       e.cod_entidad cod_entidad, e.codigo_sigep codigo_sigep,e.nombre_entidad nombre_entidad,
			       MAX(sa.aud_fecha_actualizacion) OVER (PARTITION BY e.cod_entidad) AS last_enrolment_date,
			       p.primer_nombre ||' ' ||p.primer_apellido nombre_usuario, r.nombre nombre_rol, sa.cod_situacion_admin_relacion_laboral cod_situacion_admin_relacion_laboral,
			       p.NUMERO_IDENTIFICACION,
			       (SELECT nombre_parametro FROM PARAMETRICA p2 WHERE COD_TABLA_PARAMETRICA = p.COD_TIPO_IDENTIFICACION) tipo_documento,
			       (SELECT (PRIMER_NOMBRE || ' ' || PRIMER_APELLIDO || ' ' || SEGUNDO_APELLIDO) FROM PERSONA p WHERE P.COD_PERSONA =v.cod_persona) persona
			from   vinculacion v, ENTIDAD_PLANTA_DETALLE epd, entidad_planta ep, entidad e, usuario u, rol r, SITUACION_ADMIN_VINCULACION sa, persona p
			where  round(sysdate - sa.AUD_FECHA_ACTUALIZACION)  &gt; #{diasNotificacion,jdbcType=NUMERIC}
			and    v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
			and    epd.COD_ENTIDAD_PLANTA = ep.COD_ENTIDAD_PLANTA
			and    ep.cod_entidad = e.cod_entidad
			and    u.cod_usuario = v.aud_cod_usuario
			and    r.cod_rol = v.aud_cod_rol
			and    v.cod_vinculacion = sa.COD_VINCULACION
			and    u.cod_persona = p.cod_persona
			)
		where aud_fecha_actualizacion = last_enrolment_date
		
	</select>
	
	  <select id="selectVinculacionSinSAXProcesar" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
	    select v.* from vinculacion v
			where v.cod_entidad_planta_detalle = #{codEntidadPlantaDetalle,jdbcType=NUMERIC}
			and v.flg_activo = 1
			and v.fecha_finalizacion is null
			and (v.cod_vinculacion not in (select sa.COD_VINCULACION from situacion_admin_vinculacion sa 
			                            	where sa.COD_VINCULACION = v.cod_vinculacion and sa.flg_activo = 1 
			                            	and (sa.cod_entidad_planta_detalle_encargo is not null
			                            	or sa.cod_situacion_administrativa in (16, 47))
			                            	))
	    OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
	</select>	
	
	<select id="selectUltimaVinculacionByCargo" parameterType="co.gov.dafp.sigep2.bean.ext.VinculacionExt" resultMap="BaseResultMapExt">
		select v.*, p.PRIMER_NOMBRE ||' '|| p.SEGUNDO_NOMBRE ||' '|| p.PRIMER_APELLIDO ||' '|| p.SEGUNDO_APELLIDO NOMBRE_USUARIO, ep.cod_entidad COD_ENTIDAD
		from vinculacion v
		inner join persona p on p.cod_persona = v.cod_persona
		inner join entidad_planta_detalle epd on epd.cod_entidad_planta_detalle = v.cod_entidad_planta_detalle
		inner join entidad_planta ep on ep.cod_entidad_planta = epd.cod_entidad_planta
		where v.cod_entidad_planta_detalle = #{codEntidadPlantaDetalle,jdbcType=NUMERIC}
		and v.flg_activo = #{flgActivo,jdbcType=NUMERIC}
		order by v.fecha_posesion desc
		OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
	</select>	
</mapper>