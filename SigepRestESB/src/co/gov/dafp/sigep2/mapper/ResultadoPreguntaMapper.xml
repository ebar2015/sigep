<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.gov.dafp.sigep2.interfaces.ResultadoPreguntaMapper">
  <resultMap id="BaseResultMap" type="co.gov.dafp.sigep2.bean.ResultadoPregunta">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    <id column="COD_RESULTADO_PREGUNTA" jdbcType="NUMERIC" property="codResultadoPregunta" />
    <result column="COD_PREGUNTA_OPINION" jdbcType="NUMERIC" property="codPreguntaOpinion" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="PUNTAJE" jdbcType="NUMERIC" property="puntaje" />
    <result column="COMENTARIO" jdbcType="VARCHAR" property="comentario" />
    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
    <result column="AUD_COD_USUARIO" jdbcType="NUMERIC" property="audCodUsuario" />
    <result column="AUD_COD_ROL" jdbcType="NUMERIC" property="audCodRol" />
    <result column="AUD_ACCION" jdbcType="NUMERIC" property="audAccion" />
    <result column="COD_ENTIDAD_SESION" jdbcType="NUMERIC" property="codEntidadSesion" />
    
    <result column="TOTAL_RESPUESTA" jdbcType="NUMERIC" property="totalRespuesta" />
    <result column="TOTAL" jdbcType="NUMERIC" property="total" />
    <result column="PORCENTAJE" jdbcType="NUMERIC" property="porcentaje" />
    <result column="CANTIDAD_RESPUESTA" jdbcType="NUMERIC" property="cantidadRespuesta" />
    
  </resultMap>
  
  <resultMap id="BaseResultMapExt" type="co.gov.dafp.sigep2.bean.ext.ResultadoPreguntaExt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    <id column="COD_RESULTADO_PREGUNTA" jdbcType="NUMERIC" property="codResultadoPregunta" />
    <result column="COD_PREGUNTA_OPINION" jdbcType="NUMERIC" property="codPreguntaOpinion" />
    <result column="COD_PERSONA" jdbcType="NUMERIC" property="codPersona" />
    <result column="PUNTAJE" jdbcType="NUMERIC" property="puntaje" />
    <result column="COMENTARIO" jdbcType="VARCHAR" property="comentario" />
    <result column="AUD_FECHA_ACTUALIZACION" jdbcType="TIMESTAMP" property="audFechaActualizacion" />
    <result column="AUD_COD_USUARIO" jdbcType="NUMERIC" property="audCodUsuario" />
    <result column="AUD_COD_ROL" jdbcType="NUMERIC" property="audCodRol" />
    <result column="AUD_ACCION" jdbcType="NUMERIC" property="audAccion" />
    
    <result column="TOTAL_RESPUESTA" jdbcType="NUMERIC" property="totalRespuesta" />
    <result column="TOTAL" jdbcType="NUMERIC" property="total" />
    <result column="PORCENTAJE" jdbcType="NUMERIC" property="porcentaje" />
    <result column="CANTIDAD_RESPUESTA" jdbcType="NUMERIC" property="cantidadRespuesta" />
    <result column="NOMBRE_PREGUNTA" jdbcType="VARCHAR" property="nombrePregunta" />
    <result column="FECHA_INICIO_PREGUNTA" jdbcType="TIMESTAMP" property="fechaInicioPregunta" />
    <result column="FECHA_FIN_PREGUNTA" jdbcType="TIMESTAMP" property="fechaFinPregunta" />
    <result column="TIPO_IDENTIFICACION" jdbcType="VARCHAR" property="tipoIdentificacion" />
    <result column="NUMERO_IDENTIFICACION" jdbcType="VARCHAR" property="numeroIdentificacion" />
    <result column="COD_ROL" jdbcType="NUMERIC" property="codRol" />
    <result column="RESPUESTAS_ROL" jdbcType="NUMERIC" property="respuestasRol" />
    <result column="TOTAL_ROLES" jdbcType="NUMERIC" property="totalRoles" />
    <result column="NOMBRE_ROL" jdbcType="VARCHAR" property="nombreRol" />
    <result column="COD_RANGO_EDAD" jdbcType="NUMERIC" property="codRangoEdad" />
    <result column="CANTIDAD_RANGO" jdbcType="NUMERIC" property="cantidadRango" />
    <result column="RANGO_TOTAL" jdbcType="NUMERIC" property="rangoTotal" />
    <result column="NOMBRE_RANGO" jdbcType="VARCHAR" property="nombreRango" />
    <result column="COD_NIVEL_JERARQUICO" jdbcType="NUMERIC" property="codNivelJerarquico"/>
    <result column="NOMBRE_NIVEL" jdbcType="VARCHAR" property="nombreNivel" />
    <result column="RESPUESTA_NIVEL" jdbcType="NUMERIC" property="respuestaNivel"/>
    <result column="CODIGO_SIGEP" jdbcType="NUMERIC" property="codSigep"/>
    <result column="NOMBRE_ENTIDAD" jdbcType="VARCHAR" property="nombreEntidad" />
    <result column="PRIMER_NOMBRE" jdbcType="VARCHAR" property="primerNombre"/>
    <result column="SEGUNDO_NOMBRE" jdbcType="VARCHAR" property="segundoNombre"/>
    <result column="PRIMER_APELLIDO" jdbcType="VARCHAR" property="primerApellido"/>
    <result column="SEGUNDO_APELLIDO" jdbcType="VARCHAR" property="segundoApellido"/>
    <result column="CABEZA_FAMILIA" jdbcType="VARCHAR" property="cabezaFamilia" />
    <result column="DISCAPACIDAD" jdbcType="VARCHAR" property="discapacidad"/>
    
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    COD_RESULTADO_PREGUNTA, COD_PREGUNTA_OPINION, COD_PERSONA, PUNTAJE, COMENTARIO, AUD_FECHA_ACTUALIZACION, 
    AUD_COD_USUARIO, AUD_COD_ROL, AUD_ACCION
  </sql>
  <select id="selectByExample" parameterType="co.gov.dafp.sigep2.bean.ResultadoPreguntaExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from RESULTADO_PREGUNTA
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
    <if test="limitInit!= null and limitEnd > 1">
     		OFFSET #{limitInit} ROWS FETCH NEXT #{limitEnd} ROWS ONLY
    </if>
  </select>
  <select id="selectRespuestasPregunta" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta" resultMap="BaseResultMap">
   SELECT  
    count(*) over() TOTAL,  rs.* 
    FROM RESULTADO_PREGUNTA rs 
    WHERE rs.COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC}
    	OFFSET #{limitInit,jdbcType=NUMERIC} ROWS FETCH NEXT #{limitEnd,jdbcType=NUMERIC} ROWS ONLY
  </select>
  
  <select id="selectRespuestasPuntagePregunta" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta" resultMap="BaseResultMap">
  SELECT COUNT(*) TOTAL_RESPUESTA 
   FROM RESULTADO_PREGUNTA rs 
   WHERE rs.PUNTAJE = #{puntaje,jdbcType=NUMERIC} 
   AND rs.COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC}		
  </select>
  
  <select id="selectRespuestasEstadistica" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta" resultMap="BaseResultMapExt">
	select A.*,round(A.RESPUESTAS_ROL/TOTAL_RESPUESTA*100) porcentaje from (
		select r.cod_rol, r.nombre as nombre_rol
			,count(*) RESPUESTAS_ROL
			, sum(count(*)) over() TOTAL_RESPUESTA
		from resultado_pregunta rp
			INNER JOIN ROL r ON rp.aud_cod_rol = r.COD_ROL
		where rp.COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC}
			and rp.PUNTAJE = #{puntaje,jdbcType=NUMERIC}
		GROUP BY r.COD_ROL,r.NOMBRE
		ORDER BY r.COD_ROL) A	
  </select>
  
  <select id="selectGraficoNivelJerarquico" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta" resultMap="BaseResultMapExt">
	select A.*,round(A.RESPUESTA_NIVEL/TOTAL_RESPUESTA*100) porcentaje from (
    Select nd.cod_nivel_jerarquico, COALESCE(parametrica.NOMBRE_PARAMETRO,'No Vinculado') as NOMBRE_NIVEL
        , count(*) RESPUESTA_NIVEL
        , sum(count(*)) over() TOTAL_RESPUESTA
    from   resultado_pregunta rp
        inner join persona p on rp.cod_persona = p.cod_persona
        left join vinculacion v on v.cod_persona = p.cod_persona
        left join ENTIDAD_PLANTA_DETALLE epd on v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
        left join NOMENCLATURA_DENOMINACION nd on epd.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
        left join parametrica parametrica on nd.COD_NIVEL_JERARQUICO = parametrica.cod_tabla_parametrica
    where rp.COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC} 
    and rp.puntaje = #{puntaje,jdbcType=NUMERIC}
    group by nd.cod_nivel_jerarquico, COALESCE(parametrica.NOMBRE_PARAMETRO,'No Vinculado'))A   
  </select>
   <select id="selectGraficoRetenSocial" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta" resultMap="BaseResultMapExt">
   	select A.*,round(A.RESPUESTA_RAZON/TOTAL_RESPUESTA*100) porcentaje from (  
  		select da.cod_cabeza_hogar, COALESCE(parametrica.NOMBRE_PARAMETRO,'SIN RESPUESTA')  as cabeza_familia,
    		(CASE WHEN COALESCE(da.flg_discapacidad,'0') = 0 THEN 'NO' ELSE 'SI' END)  as DISCAPACIDAD 
    		, count(*) RESPUESTA_RAZON
    		, sum(count(*)) over() TOTAL_RESPUESTA
    	from resultado_pregunta rp
    		inner join persona p on rp.cod_persona = p.cod_persona
    		left join dato_adicional da on da.cod_persona = p.cod_persona
    		left join parametrica parametrica on da.cod_cabeza_hogar = parametrica.cod_tabla_parametrica
    		left join parametrica parametrica1 on da.flg_discapacidad = parametrica1.cod_tabla_parametrica
    	where rp.COD_PREGUNTA_OPINION =  #{codPreguntaOpinion,jdbcType=NUMERIC} 
    	and rp.puntaje = #{puntaje,jdbcType=NUMERIC}
    	group by da.cod_cabeza_hogar, COALESCE(parametrica.NOMBRE_PARAMETRO,'SIN RESPUESTA'),  (CASE WHEN COALESCE(da.flg_discapacidad,'0') = 0 THEN 'NO' ELSE 'SI' END)
    	)A
   </select>
   <select id="selectTotalRespuestas" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    SELECT COUNT(*) TOTAL_RESPUESTA 
     FROM RESULTADO_PREGUNTA rs 
     WHERE rs.COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC}
  </select>
  
   <select id="selectGrafico" parameterType="java.lang.Integer" resultMap="BaseResultMap">
	select round((CANTIDAD_RESPUESTA/TOTAL_RESPUESTA)*100) PORCENTAJE, a.* from (
		select
		  PUNTAJE,
		  count(*) CANTIDAD_RESPUESTA,
		  sum(count(*)) over() TOTAL_RESPUESTA
		    from RESULTADO_PREGUNTA rp
		INNER JOIN PREGUNTA_OPINION p
		  on rp.COD_PREGUNTA_OPINION = p.COD_PREGUNTA_OPINION
		where 1=1
		and p.COD_PREGUNTA_OPINION= #{codPreguntaOpinion,jdbcType=NUMERIC}
		GROUP BY PUNTAJE) A
  </select>
  
   <select id="selectGraficoEdades" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta" resultMap="BaseResultMapExt">
	select
		 COD_RANGO_EDAD,NOMBRE_RANGO,
		 count(*) CANTIDAD_RANGO,
		 count(*) over() RANGO_TOTAL,
		  round((count(*) / count(*) over() )) *100 PORCENTAJE
		from (
		  SELECT
		    A.*,
		    re.COD_RANGO_EDAD,
		    re.NOMBRE_RANGO
		  FROM (
		         SELECT
		           p.COD_PERSONA,
		           trunc(months_between(sysdate, FECHA_NACIMIENTO) / 12) edad
         	FROM PERSONA p
           	INNER JOIN RESULTADO_PREGUNTA rp ON rp.COD_PERSONA = p.COD_PERSONA
           	INNER JOIN PREGUNTA_OPINION po ON rp.COD_PREGUNTA_OPINION = po.COD_PREGUNTA_OPINION
         WHERE po.COD_PREGUNTA_OPINION =#{codPreguntaOpinion,jdbcType=NUMERIC}
              AND rp.PUNTAJE = #{puntaje,jdbcType=NUMERIC}
       ) A
   INNER JOIN RANGO_EDAD re
    on A.edad BETWEEN re.LIMITE_INFERIOR AND re.LIMITE_SUPERIOR and re.FLG_ACTIVO=1
) B
GROUP BY COD_RANGO_EDAD,NOMBRE_RANGO
  </select>
  
  <select id="selectRespuestaPreguntaPersona" parameterType="java.lang.Integer" resultMap="BaseResultMapExt">
  	SELECT re.NOMBRE_RANGO, A.* FROM (
		SELECT  rs.*,r.nombre as nombre_rol, COALESCE(parametrica.NOMBRE_PARAMETRO,'No Vinculado') as NOMBRE_NIVEL,
			trunc(months_between(sysdate, p.FECHA_NACIMIENTO) / 12) edad,
			(COALESCE(parametrica2.NOMBRE_PARAMETRO,'SIN RESPUESTA'))as cabeza_familia,
    		(CASE WHEN COALESCE(da.flg_discapacidad,'0') = 0 THEN 'NO' ELSE 'SI' END)  as DISCAPACIDAD, 
			(SELECT po.PREGUNTA FROM PREGUNTA_OPINION po where rs.COD_PREGUNTA_OPINION = po.COD_PREGUNTA_OPINION) NOMBRE_PREGUNTA,
			(SELECT po.FECHA_INICIO FROM PREGUNTA_OPINION po where rs.COD_PREGUNTA_OPINION = po.COD_PREGUNTA_OPINION) FECHA_INICIO_PREGUNTA,
			(SELECT po.FECHA_FIN FROM PREGUNTA_OPINION po where rs.COD_PREGUNTA_OPINION = po.COD_PREGUNTA_OPINION) FECHA_FIN_PREGUNTA,
			(SELECT NOMBRE_PARAMETRO FROM PARAMETRICA where PARAMETRICA.COD_TABLA_PARAMETRICA = p.COD_TIPO_IDENTIFICACION ) TIPO_IDENTIFICACION,
			(SELECT p.NUMERO_IDENTIFICACION  FROM PERSONA p WHERE p.COD_PERSONA = rs.COD_PERSONA) NUMERO_IDENTIFICACION
			FROM RESULTADO_PREGUNTA rs 
			INNER JOIN PERSONA p on p.COD_PERSONA = rs.COD_PERSONA
			INNER JOIN ROL r ON rs.aud_cod_rol = r.COD_ROL
            left join vinculacion v on v.cod_persona = p.cod_persona
            left join ENTIDAD_PLANTA_DETALLE epd on v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
            left join NOMENCLATURA_DENOMINACION nd on epd.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
            left join dato_adicional da on da.cod_persona = p.cod_persona
    		left join parametrica parametrica2 on da.cod_cabeza_hogar = parametrica2.cod_tabla_parametrica
    		left join parametrica parametrica1 on da.flg_discapacidad = parametrica1.cod_tabla_parametrica
            left join parametrica parametrica on nd.COD_NIVEL_JERARQUICO = parametrica.cod_tabla_parametrica
		WHERE rs.COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC})A
		INNER JOIN RANGO_EDAD re on A.edad BETWEEN re.LIMITE_INFERIOR AND re.LIMITE_SUPERIOR and re.FLG_ACTIVO=1
  </select>
  
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from RESULTADO_PREGUNTA
    where COD_RESULTADO_PREGUNTA = #{codResultadoPregunta,jdbcType=NUMERIC}
  </select>
  
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    delete from RESULTADO_PREGUNTA
    where COD_RESULTADO_PREGUNTA = #{codResultadoPregunta,jdbcType=NUMERIC}
  </delete>
  <delete id="deleteByExample" parameterType="co.gov.dafp.sigep2.bean.ResultadoPreguntaExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    delete from RESULTADO_PREGUNTA
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    insert into RESULTADO_PREGUNTA (COD_PREGUNTA_OPINION, 
      COD_PERSONA, PUNTAJE, COMENTARIO, 
      AUD_FECHA_ACTUALIZACION, AUD_COD_USUARIO, 
      AUD_COD_ROL, AUD_ACCION, COD_ENTIDAD_SESION)
    values (#{codPreguntaOpinion,jdbcType=NUMERIC}, 
      #{codPersona,jdbcType=NUMERIC}, #{puntaje,jdbcType=NUMERIC}, #{comentario,jdbcType=VARCHAR}, 
      #{audFechaActualizacion,jdbcType=TIMESTAMP}, #{audCodUsuario,jdbcType=NUMERIC}, 
      #{audCodRol,jdbcType=NUMERIC}, #{audAccion,jdbcType=NUMERIC},#{codEntidadSesion,jdbcType=NUMERIC})
  </insert>
  <insert id="insertSelective" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    insert into RESULTADO_PREGUNTA
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="codResultadoPregunta != null">
        COD_RESULTADO_PREGUNTA,
      </if>
      <if test="codPreguntaOpinion != null">
        COD_PREGUNTA_OPINION,
      </if>
      <if test="codPersona != null">
        COD_PERSONA,
      </if>
      <if test="puntaje != null">
        PUNTAJE,
      </if>
      <if test="comentario != null">
        COMENTARIO,
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION,
      </if>
      <if test="audCodUsuario != null">
        AUD_COD_USUARIO,
      </if>
      <if test="audCodRol != null">
        AUD_COD_ROL,
      </if>
      <if test="audAccion != null">
        AUD_ACCION,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="codResultadoPregunta != null">
        #{codResultadoPregunta,jdbcType=NUMERIC},
      </if>
      <if test="codPreguntaOpinion != null">
        #{codPreguntaOpinion,jdbcType=NUMERIC},
      </if>
      <if test="codPersona != null">
        #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="puntaje != null">
        #{puntaje,jdbcType=NUMERIC},
      </if>
      <if test="comentario != null">
        #{comentario,jdbcType=VARCHAR},
      </if>
      <if test="audFechaActualizacion != null">
        #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="audCodUsuario != null">
        #{audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="audCodRol != null">
        #{audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="audAccion != null">
        #{audAccion,jdbcType=NUMERIC},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="co.gov.dafp.sigep2.bean.ResultadoPreguntaExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    select count(*) from RESULTADO_PREGUNTA
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    update RESULTADO_PREGUNTA
    <set>
      <if test="record.codResultadoPregunta != null">
        COD_RESULTADO_PREGUNTA = #{record.codResultadoPregunta,jdbcType=NUMERIC},
      </if>
      <if test="record.codPreguntaOpinion != null">
        COD_PREGUNTA_OPINION = #{record.codPreguntaOpinion,jdbcType=NUMERIC},
      </if>
      <if test="record.codPersona != null">
        COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      </if>
      <if test="record.puntaje != null">
        PUNTAJE = #{record.puntaje,jdbcType=NUMERIC},
      </if>
      <if test="record.comentario != null">
        COMENTARIO = #{record.comentario,jdbcType=VARCHAR},
      </if>
      <if test="record.audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="record.audCodUsuario != null">
        AUD_COD_USUARIO = #{record.audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="record.audCodRol != null">
        AUD_COD_ROL = #{record.audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="record.audAccion != null">
        AUD_ACCION = #{record.audAccion,jdbcType=NUMERIC},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    update RESULTADO_PREGUNTA
    set COD_RESULTADO_PREGUNTA = #{record.codResultadoPregunta,jdbcType=NUMERIC},
      COD_PREGUNTA_OPINION = #{record.codPreguntaOpinion,jdbcType=NUMERIC},
      COD_PERSONA = #{record.codPersona,jdbcType=NUMERIC},
      PUNTAJE = #{record.puntaje,jdbcType=NUMERIC},
      COMENTARIO = #{record.comentario,jdbcType=VARCHAR},
      AUD_FECHA_ACTUALIZACION = #{record.audFechaActualizacion,jdbcType=TIMESTAMP},
      AUD_COD_USUARIO = #{record.audCodUsuario,jdbcType=NUMERIC},
      AUD_COD_ROL = #{record.audCodRol,jdbcType=NUMERIC},
      AUD_ACCION = #{record.audAccion,jdbcType=NUMERIC}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    update RESULTADO_PREGUNTA
    <set>
      <if test="codPreguntaOpinion != null">
        COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC},
      </if>
      <if test="codPersona != null">
        COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      </if>
      <if test="puntaje != null">
        PUNTAJE = #{puntaje,jdbcType=NUMERIC},
      </if>
      <if test="comentario != null">
        COMENTARIO = #{comentario,jdbcType=VARCHAR},
      </if>
      <if test="audFechaActualizacion != null">
        AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      </if>
      <if test="audCodUsuario != null">
        AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
      </if>
      <if test="audCodRol != null">
        AUD_COD_ROL = #{audCodRol,jdbcType=NUMERIC},
      </if>
      <if test="audAccion != null">
        AUD_ACCION = #{audAccion,jdbcType=NUMERIC},
      </if>
      <if test="codEntidadSesion != null">
        COD_ENTIDAD_SESION = #{codEntidadSesion,jdbcType=NUMERIC},
      </if>
    </set>
    where COD_RESULTADO_PREGUNTA = #{codResultadoPregunta,jdbcType=NUMERIC}
  </update>
  <update id="updateByPrimaryKey" parameterType="co.gov.dafp.sigep2.bean.ResultadoPregunta">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 29 14:57:36 COT 2018.
    -->
    update RESULTADO_PREGUNTA
    set COD_PREGUNTA_OPINION = #{codPreguntaOpinion,jdbcType=NUMERIC},
      COD_PERSONA = #{codPersona,jdbcType=NUMERIC},
      PUNTAJE = #{puntaje,jdbcType=NUMERIC},
      COMENTARIO = #{comentario,jdbcType=VARCHAR},
      AUD_FECHA_ACTUALIZACION = #{audFechaActualizacion,jdbcType=TIMESTAMP},
      AUD_COD_USUARIO = #{audCodUsuario,jdbcType=NUMERIC},
      AUD_COD_ROL = #{audCodRol,jdbcType=NUMERIC},
      AUD_ACCION = #{audAccion,jdbcType=NUMERIC}
    where COD_RESULTADO_PREGUNTA = #{codResultadoPregunta,jdbcType=NUMERIC}
  </update>
  <select id="selectInformacionExportar" parameterType="java.lang.Integer" resultMap="BaseResultMapExt">

	SELECT re.NOMBRE_RANGO, A.* FROM (
		select e.codigo_sigep, e.nombre_entidad, p.NUMERO_IDENTIFICACION,r.nombre as
			nombre_rol, COALESCE(parametrica.NOMBRE_PARAMETRO,'No Vinculado') as NOMBRE_NIVEL,
			(COALESCE(parametrica2.NOMBRE_PARAMETRO,'SIN RESPUESTA'))as cabeza_familia,
    		(CASE WHEN COALESCE(da.flg_discapacidad,'0') = 0 THEN 'NO' ELSE 'SI' END)  as DISCAPACIDAD, 
			(SELECT NOMBRE_PARAMETRO FROM PARAMETRICA where PARAMETRICA.COD_TABLA_PARAMETRICA = p.COD_TIPO_IDENTIFICACION ) TIPO_IDENTIFICACION,
			p.PRIMER_NOMBRE, p.SEGUNDO_NOMBRE, p.PRIMER_APELLIDO, p.SEGUNDO_APELLIDO, rp.*,
			trunc(months_between(sysdate, p.FECHA_NACIMIENTO) / 12) edad
		from resultado_pregunta rp
			left join entidad e on e.cod_entidad = rp.cod_entidad_sesion
			inner join persona p on p.cod_persona = rp.cod_persona
			inner join pregunta_opinion po on po.cod_pregunta_opinion = rp.cod_pregunta_opinion
			left join vinculacion v on v.cod_persona = p.cod_persona
			left join ENTIDAD_PLANTA_DETALLE epd on v.COD_ENTIDAD_PLANTA_DETALLE = epd.COD_ENTIDAD_PLANTA_DETALLE
			left join NOMENCLATURA_DENOMINACION nd on epd.COD_NOMENCLATURA_DENOMINACION = nd.COD_NOMENCLATURA_DENOMINACION
			left join dato_adicional da on da.cod_persona = p.cod_persona
    		left join parametrica parametrica2 on da.cod_cabeza_hogar = parametrica2.cod_tabla_parametrica
    		left join parametrica parametrica1 on da.flg_discapacidad = parametrica1.cod_tabla_parametrica
			left join parametrica parametrica on nd.COD_NIVEL_JERARQUICO =	parametrica.cod_tabla_parametrica
			INNER JOIN ROL r ON rp.aud_cod_rol = r.COD_ROL
		where 1=1
			and rp.cod_pregunta_opinion =  #{codPreguntaOpinion,jdbcType=NUMERIC})A
			LEFT JOIN RANGO_EDAD re on A.edad BETWEEN re.LIMITE_INFERIOR AND
			re.LIMITE_SUPERIOR and re.FLG_ACTIVO=1
		order by a.primer_nombre
  </select>
</mapper>