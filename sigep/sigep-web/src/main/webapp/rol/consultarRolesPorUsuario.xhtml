<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	template="/resources/template/pageTemplate.xhtml">

	<ui:param name="pageTitle" value="${titles['TTL_ADMIN_SISTEMA_BREADCRUMB']}" />
	<ui:param name="pageSubtitle" value="${titles['TTL_ROLES_TITLE']}" />

	<ui:define name="main">
		<h:outputStylesheet>
			.ui-paginator.ui-paginator-bottom{
				font-size:12px!important
			}
			.ui-datatable-resizable table{
				table-layout:inherit;
			}
		</h:outputStylesheet>
		<div class="row">
			<div class="col-md-12" align="center">
				<h:panelGroup>
					<h2>
						<p:outputLabel
							value="• ${titles['TTL_ROLES_CONSULTAR_X_USUARIO']} •"
							styleClass="page-subtitle" style="color: #263948!important;" />
					</h2>
				</h:panelGroup>
			</div>
		</div>
		<div class="row row-background-white">
			<br /> <br />
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-4">
						<p:outputLabel value="${titles['TTL_TIPO_DOCUMENTO']}:"
							for="tipoDocumento" styleClass="log-label form-label-formularios" />
						<h:panelGroup>
							<h:selectOneMenu id="tipoDocumento"
								converter="tipoDocumentoConverter"
								value="#{consultarRolesPorUsuarioBean.persona.tipoIdentificacionId}"
								var="t" filter="true" filterMatchMode="contains"
								title="${titles['TTL_SELECT']} ${titles['TTL_TIPO_DOCUMENTO']}"
								styleClass="form-control-form-act-usua">
								<f:selectItem itemLabel="${titles['TTL_SELECT']}" itemValue="#{null}" />
								<f:selectItems value="#{tiposDocumentoEntidad}" var="tipoDoc"
									itemLabel="#{tipoDoc.descripcion}" itemValue="#{tipoDoc}" />
								<p:ajax process="@this" update="@form"
									listener="#{consultarRolesPorUsuarioBean.limpiarDoc()}" />
							</h:selectOneMenu>
							<p:message for="tipoDocumento" display="text" />
						</h:panelGroup>
					</div>
					<div class="col-md-4">
						<p:outputLabel value="${titles['TTL_NICK_NAME']}:"
							for="numeroDocumento"
							styleClass="log-label form-label-formularios" />
						<h:panelGroup>
							<p:remoteCommand name="validarCedula"
								action="#{consultarRolesPorUsuarioBean.listener}"
								process="contains" update="contains" />
							<p:inputText id="numeroDocumento" maxlength="15"
								styleClass="form-control-acti-usua" autocomplete="off"
								title="${titles['TTL_INGRESE']} ${titles['TTL_NICK_NAME']} ${titles['TTL_TIPO_ALFANUMERICO']}"
								disabled="#{!consultarRolesPorUsuarioBean.entidadSeleccionada}"
								value="#{consultarRolesPorUsuarioBean.persona.numeroIdentificacion}"
								onkeydown="if (event.keyCode === 13) { validarCedula(); return false; }">
								<c:choose>
									<c:when
										test="${consultarRolesPorUsuarioBean.persona.tipoIdentificacionId.descripcion == consultarRolesPorUsuarioBean.TIPO_DOC_PASAPORTE}">
										<f:validator validatorId="nickNameValidatorPassport" />
									</c:when>
									<c:otherwise>
										<f:validator validatorId="nickNameValidator" />
									</c:otherwise>
								</c:choose>
								<p:keyFilter regEx="/[A-Z0-9_]/i" />
							</p:inputText>
							<p:message for="numeroDocumento" display="text" />
						</h:panelGroup>
					</div>
					<div class="col-md-4">
						<p:outputLabel
							value="${titles['LBL_TRANSVERSAL_PERSONAS_PRIMER_NOMBRE']}:"
							for="txtPrimerNombre"
							styleClass="log-label form-label-formularios" />
						<p:inputText id="txtPrimerNombre" maxlength="50"
							title="${titles['TTL_INGRESE']} ${titles['LBL_TRANSVERSAL_PERSONAS_PRIMER_NOMBRE']} ${titles['TTL_TIPO_ALFANUMERICO']}"
							onkeypress="return anular(event)"
							styleClass="form-control-acti-usua" autocomplete="off"
							value="#{consultarRolesPorUsuarioBean.persona.primerNombre}" />
						<p:message for="txtPrimerNombre" display="text" />
					</div>
				</div>
			</div>
			<br />
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-4">
						<p:outputLabel
							value="${titles['LBL_TRANSVERSAL_PERSONAS_SEGUNDO_NOMBRE']}:"
							styleClass="form-label-formularios" />
						<p:inputText id="txtSegundoNombre" maxlength="50"
							title="${titles['TTL_INGRESE']} ${titles['LBL_TRANSVERSAL_PERSONAS_SEGUNDO_NOMBRE']} ${titles['TTL_TIPO_ALFANUMERICO']}"
							onkeypress="return anular(event)"
							styleClass="form-control-acti-usua" autocomplete="off"
							value="#{consultarRolesPorUsuarioBean.persona.segundoNombre}" />
					</div>
					<div class="col-md-4">
						<p:outputLabel
							value="${titles['LBL_TRANSVERSAL_PERSONAS_PRIMER_APELLIDO']}:"
							for="txtPrimerApellido"
							styleClass="log-label form-label-formularios" />
						<p:inputText id="txtPrimerApellido" maxlength="50"
							onkeypress="return anular(event)"
							title="${titles['TTL_INGRESE']} ${titles['LBL_TRANSVERSAL_PERSONAS_PRIMER_APELLIDO']} ${titles['TTL_TIPO_ALFANUMERICO']}"
							styleClass="form-control-acti-usua" autocomplete="off"
							value="#{consultarRolesPorUsuarioBean.persona.primerApellido}" />
						<p:message for="txtPrimerApellido" display="text" />
					</div>
					<div class="col-md-4">
						<p:outputLabel
							value="${titles['LBL_TRANSVERSAL_PERSONAS_SEGUNDO_APELLIDO']}:"
							styleClass="form-label-formularios" />
						<p:inputText id="txtSegundoApellido" maxlength="50"
							title="${titles['LBL_TRANSVERSAL_PERSONAS_SEGUNDO_APELLIDO']} ${titles['TTL_TIPO_ALFANUMERICO']}"
							onkeypress="return anular(event)"
							styleClass="form-control-acti-usua" autocomplete="off"
							value="#{consultarRolesPorUsuarioBean.persona.segundoApellido}" />
					</div>
				</div>
			</div>
			<br />
			<h:panelGroup rendered="#{consultarRolesPorUsuarioBean.tieneRolAdmin}"
				layout="block" styleClass="row">
				<div class="col-md-12">
					<div class="col-md-4">
						<p:outputLabel value="${titles['LBL_CT_NOMBRE_ENTIDAD']}:"
							for="acEntidades" styleClass="log-label form-label-formularios" />

						<p:selectOneMenu id="acEntidades" converter="entidadConverter"
							panelStyle="width:100%;"
							value="#{consultarRolesPorUsuarioBean.entidad}" var="t"
							filter="true" filterMatchMode="contains"
							styleClass="form-control-form-act-usua"
							title="${titles['TTL_SELECT']} ${titles['LBL_CT_NOMBRE_ENTIDAD']}"
							style="color: #999999!important;width:100%;padding:0">
							<f:selectItem itemValue="#{null}" itemLabel="${titles['TTL_SELECT']}" />
							<f:selectItems value="#{entidadesUsuario}" var="ent"
								itemLabel="#{gestionarRolBean.longToString(ent.id).concat('-').concat(ent.nombreEntidad)}"
								itemValue="#{ent}" />
							<p:column>
								<h:outputText value="#{t.id}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.nombreEntidad}" />
							</p:column>
						</p:selectOneMenu>
						<p:message for="acEntidades" display="text" />

					</div>
				</div>
			</h:panelGroup>
			<br />
			<h:panelGroup>
				<div class="row" align="center">
					<div class="col-md-4"></div>
					<div class="col-md-2" style="margin-bottom: 4%;">
						<p:commandButton value="${titles['TTL_SEARCH']}"
							update="@form, messages"
							process="@this,tipoDocumento,numeroDocumento,txtPrimerNombre,txtSegundoNombre,txtPrimerApellido,txtSegundoApellido,acEntidades"
							styleClass="btn btn-primary"
							actionListener="#{consultarRolesPorUsuarioBean.buscarPersonas()}"
							style="font-size: 1.5em!important; padding-left:16%!important; padding-right:16%!important;" />
					</div>

					<div class="col-md-2" style="margin-bottom: 4%;">
						<p:commandButton value="${titles['TTL_CANCEL']}"
							resetValues="true" process="@this" update="contains"
							actionListener="#{gestionarRolBean.cancelar()}"
							styleClass="btn btn-default"
							style="padding-left:15%!important;padding-right:15%!important;font-size:1.5em!important;" />
					</div>
					<div class="col-md-4"></div>
				</div>
			</h:panelGroup>
		</div>
		<br /><br />
		<!-- DataTable  -->
		<div class="row row-background-white" id="divScrollTableRoles">
			<h:panelGroup>
				<br />
				<p:spacer height="2" />
				<hr class="hr-style hr-style-two" />
				<span
					style="font-size: 2em; font-weight: 500; color: #245379; background-color: white; margin-left: 1em;">
					${titles['TTL_RESULTADO_BUSQUEDA']} </span>
				<br /><br />
				<div class="row">
					<div class="col-md-12"
						style="padding-left: 2% !important; padding-right: 2% !important;">
						<p:panel id="panelTableRol" widgetVar="panelTableRol"
							style="background: transparent;">
							<p:dataTable id="dataTableRol" lazy="true" var="dataUser"
								paginator="true" rows="#{paginatorSize}"
								emptyMessage="${messages['MSG_TABLAS_SIN_REGISTROS']}"
								currentPageReportTemplate="{currentPage} ${titles['LBL_DE']} {totalPages}"
								paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
								rowsPerPageTemplate="#{paginatorsSize}"
								value="#{consultarRolesPorUsuarioBean.listaPersonas}"
								resizableColumns="true" resizeMode="expand"
								style="width:100%!important"
								rowExpandMode="single">
								<p:column headerText="${titles['TTL_ROLES_BREADCRUMBS']}" style="width:5em; word-wrap: break-word!important;">
									<p:rowToggler />
								</p:column>
								<p:column headerText="${titles['TTL_TIPO_DOCUMENTO']}" style="word-wrap: break-word!important;"
									sortBy="#{dataHV.tipoIdentificacionId.descripcion}">
									<h:outputText value="#{dataUser.tipoIdentificacionId.descripcion}" />
								</p:column>
								<p:column headerText="${titles['TTL_NICK_NAME']}" style="word-wrap: break-word!important;"
									sortBy="#{dataUser.numeroIdentificacion}">
									<h:outputText value="#{dataUser.numeroIdentificacion}" />
								</p:column>
								<p:column headerText="${titles['LBL_CT_NOMBRE_ENTIDAD']}" style="word-wrap: break-word!important;"
									sortBy="#{dataUser.nombreEntidad}">
									<h:outputText value="#{dataUser.nombreEntidad}" />
								</p:column>
								<p:column headerText="${titles['LBL_ACCIONES']}"
									style="opacity: 1!important; text-align: center!important;word-wrap: break-word!important;">
									<p:commandButton title="${titles['TTL_ASSOCIATE']}" icon="icon-asign-role"
										process="@this" styleClass="icon-btn"
										action="#{gestionarRolBean.redireccionarAsignarRol(dataUser.tipoIdentificacionId.id, dataUser.numeroIdentificacion)}">
									</p:commandButton>
								</p:column>

								<p:rowExpansion style="background-color: black!important;">
									<br />
									<p:outputLabel
										value="#{titles['TTL_ROLES_ASIGNADOS_A']} #{dataUser.primerNombre} #{dataUser.segundoNombre} #{dataUser.primerApellido} #{dataUser.segundoApellido}"
										styleClass="form-label-formularios" />
									<br />
									<p:dataTable id="dataTableRolByUser"
										value="#{consultarRolesPorUsuarioBean.listaRolesByUser}"
										var="dataRol" emptyMessage="#{messages['DLG_SIN_REGISTROS']}"
										resizableColumns="true" resizeMode="expand" paginator="true"
										rows="#{paginatorSize}"
										currentPageReportTemplate="{currentPage} ${titles['LBL_DE']} {totalPages}"
										paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
										rowsPerPageTemplate="#{paginatorsSize}" reflow="true"
										style="width:100%!important;">
										<f:facet name="header">
										</f:facet>
										<p:columnGroup type="header">
											<p:row>
												<p:column headerText="${titles['TTL_ROLES_COL1']}"
													style="word-wrap: break-word!important;font-size: 1em !important;"
													sortBy="#{dataRol.nombre}">
												</p:column>
												<p:column headerText="${titles['TTL_ROLES_COL2']}"
													style="word-wrap: break-word!important;font-size: 1em !important;"
													sortBy="#{dataRol.descripcionRol}">
												</p:column>
												<p:column
													headerText="${titles['TTL_ROLES_COL_DEPENDENCIA']}"
													style="word-wrap: break-word!important;font-size: 1em !important;"
													sortBy="#{dataRol.nombreDependencia}">
												</p:column>
												<p:column headerText="${titles['TTL_ROLES_COL_FECHA_INI']}"
													style="word-wrap: break-word!important;font-size: 1em !important;"
													sortBy="#{dataRol.fechaInicio}">
												</p:column>
												<p:column headerText="${titles['TTL_ROLES_COL_FECHA_FIN']}"
													style="word-wrap: break-word!important;font-size: 1em !important;"
													sortBy="#{dataRol.fechaFin}">
												</p:column>
												<p:column headerText="${titles['LBL_ACCIONES']}"
													style="opacity: 1!important; text-align: center!important;font-size: 1em !important;">
												</p:column>
											</p:row>
										</p:columnGroup>
										<p:column>
											<h:outputText value="#{dataRol.nombre}" />
										</p:column>
										<p:column>
											<h:outputText value="#{dataRol.descripcionRol}" />
										</p:column>
										<p:column>
											<h:outputText
												value="#{dataRol.nombreDependencia eq 'TTL_YES' ? titles.TTL_YES : titles.TTL_NO}" />
										</p:column>
										<p:column>
											<h:outputText value="#{dataRol.fechaInicio}">
												<f:convertDateTime pattern="#{fechaFormato}" />
											</h:outputText>
										</p:column>
										<p:column>
											<h:outputText value="#{dataRol.fechaFin}">
												<f:convertDateTime pattern="#{fechaFormato}" />
											</h:outputText>
										</p:column>
										<p:column>
											<p:commandButton
												title="${titles['LBL_ROLES_MODIFICAR_FECHA']}"
												icon="icon-edit" styleClass="icon-btn"
												onclick="PF('editarFecha').show();" process="@this">
												<f:setPropertyActionListener value="#{dataRol}"
													target="#{consultarRolesPorUsuarioBean.rolAsignado}" />
											</p:commandButton>
											
											<p:commandButton title="${titles['LBL_ELIMINAR']}"
												icon="icon-delete" process="@this" styleClass="icon-btn"
												onclick="PF('eliminarRol').show();">
												
												<f:setPropertyActionListener value="#{dataRol}"
													target="#{consultarRolesPorUsuarioBean.rolAsignado}" />
												<f:setPropertyActionListener value="#{dataUser}"
													target="#{consultarRolesPorUsuarioBean.usuarioSeleccionado}" />
											</p:commandButton>
										</p:column>
									</p:dataTable>
								</p:rowExpansion>
								<p:ajax event="rowToggle"
									listener="#{consultarRolesPorUsuarioBean.onRowToggle}"
									update="dataTableRolByUser" />
							</p:dataTable>
						</p:panel>
					</div>
				</div>
			</h:panelGroup>
		</div>

		<!-- ### INICIO ### MODAL PARA EDITAR EL ROL ROL AL USUARIO  -->


		<!-- ### INICIO ### MODAL PARA CONFIRMAR LA ELIMINACION DE LA ASIGNACION DEL ROL AL USUARIO  -->
		<p:dialog header="• ${titles['TTL_DELETE']} •" widgetVar="eliminarRol"
			id="eliminarRol" minHeight="200" modal="true" resizable="false"
			closeOnEscape="false" responsive="true" draggable="false"
			closable="false" appendTo="@(body)" width="550">
			<p:panel id="panelConfirmacionEliminarRol"
				style="background: transparent!important;">
				<div class="col-md-12" align="center"
					style="margin-top: 3%; margin-bottom: 3%;">
					<p:outputLabel
						value="${messages['BR_INTERROGA_ELIMINACION_ASOCIACION_ROL']}"
						style="font-size:1.5em!important; color:#245379; font-weight: normal;"
						escape="false" />
				</div>
				<hr
					style="border-top: 1.5px solid rgb(196, 196, 196); width: 95%; margin-top: 15px; margin-bottom: 15px;" />
				<div class="row" align="center">
					<div class="col-md-2"></div>
					<div class="col-md-4">
						<p:commandButton id="btnEliminarRolAsignado"
							value="${titles['TTL_OK']}" styleClass="btn btn-primary"
							style="padding-left:15%!important;padding-right:15%!important; font-size:1.4em!important; padding-top:0!important; margin-bottom:1.5%;"
							process="@this" update="contains"
							actionListener="#{consultarRolesPorUsuarioBean.eliminarRolAsignadoUsuario(consultarRolesPorUsuarioBean.rolAsignado, consultarRolesPorUsuarioBean.usuarioSeleccionado)}"
							onclick="PF('eliminarRol').show();" />
						<p:message for="btnEliminarRolAsignado" display="text" />
					</div>
					<div class="col-md-4">
						<p:commandButton value="${titles['TTL_CANCEL']}" process="@this"
							update="@this" styleClass="btn btn-default"
							style="padding-left:15%!important;padding-right:15%!important; font-size:1.4em!important; padding-top:0!important; margin-bottom:1.5%;"
							onclick="PF('eliminarRol').hide();" />
					</div>
					<div class="col-md-2"></div>
				</div>
				<br />
			</p:panel>
		</p:dialog>
		<!-- ### FIN ### MODAL PARA CONFIRMAR LA ELIMINACION DE LA ASIGNACIÓN DEL ROL AL USUARIO  -->

		<p:dialog header="${titles['LBL_ROLES_MODIFICAR_FECHA']}"
			widgetVar="editarFecha" id="editarFecha" minHeight="200" modal="true"
			resizable="false" closeOnEscape="false" responsive="true"
			draggable="false" closable="false" width="550">
			<p:panel id="panelConfirmacionEditarFecha"
				style="background: transparent!important;">
				<div class="row" align="center">
					<div class="row">
						<div class="col-sm-12">
							<h:panelGroup id="panelFechaInicio">
								<div class="col-md-6">
									<p:outputLabel value="${titles['LBL_FECHA_INICIAL']}:"
										for="fechaInicio"
										styleClass="log-label form-label-formularios" />
									<p:calendar id="fechaInicio" navigator="true"
										readonlyInput="false" required="true"
										onkeypress="return false;" pattern="#{fechaFormato}"
										yearRange="#{rangoAnios}"
										title="${titles['TTL_SELECT']} ${titles['LBL_FECHA_INICIAL']}"
										value="#{consultarRolesPorUsuarioBean.rolAsignado.fechaInicio}"
										placeholder="${titles['LBL_FORMATO_FECHA']}" disabled="false"
										mindate="#{fechaSistema}" locale="#{lenguajeBean.localeCode}"
										autocomplete="off">
										<p:ajax event="dateSelect" process="@this"
											update="@this,panelConfirmacionEditarFecha"
											listener="#{consultarRolesPorUsuarioBean.onDateSelect}" />
									</p:calendar>
									<p:message for="fechaInicio" display="text" />
								</div>
							</h:panelGroup>
							<h:panelGroup id="panelFechaFin">
								<div class="col-md-6">
									<p:outputLabel value="${titles['LBL_FECHA_FIN_2']}:"
										for="fechaFin" styleClass="log-label form-label-formularios" />
									<p:calendar id="fechaFin" navigator="true"
										readonlyInput="false" onkeypress="return false;" mask="true"
										pattern="#{fechaFormato}" yearRange="#{rangoAnios}"
										mode="popup" placeholder="${titles['LBL_FORMATO_FECHA']}"
										converterMessage="#{messages.DLG_FORMATO_INVALIDO}"
										effect="slideDown"
										value="#{consultarRolesPorUsuarioBean.rolAsignado.fechaFin}"
										title="${titles['TTL_SELECT']} ${titles['LBL_FECHA_FIN_2']}"
										mindate="#{consultarRolesPorUsuarioBean.rolAsignado.fechaInicio}"
										locale="#{lenguajeBean.localeCode}" autocomplete="off">
										<p:ajax event="dateSelect" process="@this"
											update="@this,panelConfirmacionEditarFecha"
											listener="#{consultarRolesPorUsuarioBean.onDateSelect}" />
									</p:calendar>
									<p:message for="fechaFin" display="text" />
								</div>
							</h:panelGroup>
						</div>
					</div>
					<br /> <br />
					<div class="col-md-2"></div>
					<div class="col-md-4">
						<p:commandButton id="btnModificarRolAsignado"
							disabled="#{consultarRolesPorUsuarioBean.disableButton}"
							value="${titles['TTL_OK']}" styleClass="btn btn-primary"
							style="padding-left:15%!important;padding-right:15%!important; font-size:1.4em!important; padding-top:0!important; margin-bottom:1.5%;"
							process="@this fechaFin" update="contains"
							actionListener="#{consultarRolesPorUsuarioBean.modificarRolAsignadoUsuario(consultarRolesPorUsuarioBean.rolAsignado)}"
							onclick="PF('editarFecha').hide();" />
						<p:message for="btnModificarRolAsignado" display="text" />
					</div>
					<div class="col-md-4">
						<p:commandButton value="${titles['TTL_CANCEL']}" process="@this"
							update="@this" styleClass="btn btn-default"
							style="padding-left:15%!important;padding-right:15%!important; font-size:1.4em!important; padding-top:0!important; margin-bottom:1.5%;"
							onclick="PF('editarFecha').hide();" />
					</div>


				</div>
				<br />
			</p:panel>
		</p:dialog>

	</ui:define>
</ui:composition>