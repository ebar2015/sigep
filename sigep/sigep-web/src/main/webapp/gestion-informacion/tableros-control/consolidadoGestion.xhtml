<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	template="/resources/template/pageTemplate.xhtml">

	<f:metadata>
		<f:viewParam name="id" value="#{consolidadoGestionBean.id}" />
		<f:viewParam name="recursoId"
			value="#{consolidadoGestionBean.recursoId}" />
		<f:viewParam name="dialog" value="#{consolidadoGestionBean.dialog}" />
		<f:event listener="#{consolidadoGestionBean.retrieve}"
			type="preRenderView" />
		<f:event listener="#{consolidadoGestionBean.showDialog}"
			type="preRenderView" />
	</f:metadata>

	<ui:param name="pageTitle" value="${titles['TTL_GI_BREADCRUMBS']}" />
	<ui:param name="pageSubtitle"
		value="${titles['TTL_CONSOLIDADO_GESTION']}" />


	<ui:define name="main">
		<p:importConstants
			type="co.gov.dafp.sigep2.constante.TitlesBundleConstants"
			var="tipoConsolidado" />

		<h:outputStylesheet>
			tr:nth-child(even) {
				background: #ffffff !important;
			}
			
			tr:nth-child(odd) {
				background: #f2f2f2 !important;
			}
		</h:outputStylesheet>
		<h:messages globalOnly="true" styleClass="error" />
		<f:event listener="#{consolidadoGestionBean.validateForm}"
			type="postValidate" />

		<div class="row">
			<div class="col-md-12" align="center">
				<h:panelGroup>
					<h2>
						<p:outputLabel value="• ${titles['TTL_CONSOLIDADO_GESTION']} •"
							styleClass="page-subtitle" style="color: #263948!important;" />
					</h2>
				</h:panelGroup>
			</div>
		</div>

		<!-- Formulario -->
		<h:panelGroup id="parametros"
			rendered="#{consolidadoGestionBean.habilitarConsulta}">
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-5">
						<p:outputLabel
							value="${titles['TTL_CONSOLIDADO_GESTION_CONSOLIDADO_GESTION']}"
							styleClass="log-label form-label-formularios" for="consolidado" />
						<h:selectOneMenu id="consolidado"
							styleClass="form-control-form-act-usua"
							title="${titles['TTL_SELECT']} ${titles['TTL_CONSOLIDADO_GESTION_CONSOLIDADO_GESTION']}"
							value="#{consolidadoGestionBean.filtro.consolidado}"
							required="true"
							requiredMessage="${messages['DLG_VALOR_REQUERIDO']}">
							<f:selectItem itemLabel="${titles['TTL_SELECT']}"
								itemValue="#{null}" />
							<f:selectItem
								itemLabel="${titles['TTL_CONSOLIDADO_GESTION_ENT_I_100']}"
								itemValue="TTL_CONSOLIDADO_GESTION_ENT_I_100" />
							<f:selectItem
								itemLabel="${titles['TTL_CONSOLIDADO_GESTION_ENT_MAI_90']}"
								itemValue="TTL_CONSOLIDADO_GESTION_ENT_MAI_90" />
							<f:selectItem
								itemLabel="${titles['TTL_CONSOLIDADO_GESTION_ENT_MAI_80']}"
								itemValue="TTL_CONSOLIDADO_GESTION_ENT_MAI_80" />
							<f:selectItem
								itemLabel="${titles['TTL_CONSOLIDADO_GESTION_ENT_MAI_70']}"
								itemValue="TTL_CONSOLIDADO_GESTION_ENT_MAI_70" />
							<f:selectItem
								itemLabel="${titles['TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR']}"
								itemValue="TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR" />
						</h:selectOneMenu>
						<p:message for="consolidado" display="text" />
					</div>
					<div class="col-md-7" />
				</div>
			</div>
		</h:panelGroup>

		<!-- DataTable  -->
		<br />
		<h:panelGroup>
			<div class="row row-background-white">
				<br />
				<div class="col-md-12" align="right">
					<p:commandButton id="cancelBtn" value="${titles['TTL_FINALIZE']}"
						title="${titles['TTL_FINALIZE']}" process="@this" update="@form"
						styleClass="btn btn-transparent" style="padding: 0% !important;"
						action="#{consolidadoGestionBean.cancelar()}"
						icon="fa fa-fw fa-backward">
					</p:commandButton>
					<p:spacer width="2" />
					<p:commandButton id="searchBtn" value="${titles['TTL_CONSULT']}"
						title="${titles['TTL_CONSULT']}" process="@form" update="@form"
						styleClass="btn btn-transparent" style="padding: 0% !important;"
						action="#{consolidadoGestionBean.montarDatos()}"
						icon="fa fa-fw fa-search">
					</p:commandButton>
					<h:panelGroup id="exportarBtn">
						<p:spacer width="2" />
						<p:commandButton id="exportXLSXBtn"
							value="${titles['TTL_DOWNLOAD']} Excel"
							title="${titles['TTL_DOWNLOAD']} Excel"
							styleClass="btn btn-transparent" style="padding: 0% !important;"
							icon="fa fa-fw fa-download" ajax="false"
							rendered="#{not empty consolidadoGestionBean.filtro.consolidado}">
							<pe:exporter type="xlsx" target="dataConsolidado"
								fileName="#{titles[consolidadoGestionBean.filtro.consolidado]} #{fechaSistemaString}"
								orientation="Landscape" facetFontSize="12" facetFontStyle="BOLD"
								cellFontSize="12" cellFontStyle="NORMAL" encoding="ISO-8859-1" />
						</p:commandButton>
						<p:spacer width="2" />
						<p:commandButton id="exportPDFBtn"
							value="${titles['TTL_DOWNLOAD']} PDF"
							title="${titles['TTL_DOWNLOAD']} PDF"
							styleClass="btn btn-transparent" style="padding: 0% !important;"
							icon="fa fa-fw fa-download" ajax="false"
							rendered="#{not empty consolidadoGestionBean.filtro.consolidado}">
							<pe:exporter type="pdf" target="dataConsolidado"
								fileName="#{titles[consolidadoGestionBean.filtro.consolidado]} #{fechaSistemaString}"
								tableTitle="#{titles[consolidadoGestionBean.filtro.consolidado]}"
								orientation="Landscape" facetFontSize="12" facetFontStyle="BOLD"
								cellFontSize="12" cellFontStyle="NORMAL" encoding="ISO-8859-1" />
						</p:commandButton>
						<p:spacer width="2" />
						<p:commandButton id="exportCSVBtn"
							value="${titles['TTL_DOWNLOAD']} CSV"
							title="${titles['TTL_DOWNLOAD']} CSV"
							styleClass="btn btn-transparent" style="padding: 0% !important;"
							icon="fa fa-fw fa-download" ajax="false"
							rendered="#{not empty consolidadoGestionBean.filtro.consolidado}">
							<p:dataExporter type="csv" target="dataConsolidado"
								fileName="#{titles[consolidadoGestionBean.filtro.consolidado]} #{fechaSistemaString}"
								tableTitle="#{titles[consolidadoGestionBean.filtro.consolidado]}" />
						</p:commandButton>
					</h:panelGroup>
				</div>
				<br />
				<div class="row">
					<div class="col-md-3" />
					<div class="col-md-8">
						<h:panelGroup styleClass="row" layout="block"
							rendered="#{not empty consolidadoGestionBean.filtro.consolidado}">
							<div class="col-md-12">
								<p:panel id="panelConsolidado" widgetVar="panelConsolidado"
									style="background: transparent; padding: 0px!important;">
									<p:dataTable id="dataConsolidado" lazy="true" var="dataCifra"
										tableStyle="width:auto" styleClass="zebra"
										paginator="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR eq consolidadoGestionBean.filtro.consolidado}"
										emptyMessage="${messages['MSG_TABLAS_SIN_REGISTROS']}"
										paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
										value="#{consolidadoGestionBean.listaCifras}"
										rowKey="#{item.id}" rows="#{paginatorSize}"
										rowsPerPageTemplate="#{paginatorsSize}">
										<!-- Inicio Cabeceras -->
										<p:columnGroup type="header">
											<p:row>
												<p:column exportable="false"
													headerText="#{titles[tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR eq consolidadoGestionBean.filtro.consolidado ? 'TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR' : consolidadoGestionBean.filtro.consolidado]}"
													colspan="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR eq consolidadoGestionBean.filtro.consolidado ? 2 : 4}" />
											</p:row>
											<p:row>
												<p:column
													headerText="${titles['TTL_CONSOLIDADO_GESTION_META_ANUAL']}"
													rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}" />
												<p:column
													headerText="${titles['TTL_CONSOLIDADO_GESTION_META_TRIMESTRE']}"
													rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}" />
												<p:column
													headerText="${titles['TTL_CONSOLIDADO_GESTION_META_AVANCE']}"
													rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}" />
												<p:column
													headerText="${titles['TTL_CONSOLIDADO_GESTION_META_NUM_ENTIDADES']}"
													rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}" />
												<p:column
													headerText="${titles['TTL_CONSOLIDADO_GESTION_ASESOR']}"
													rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR eq consolidadoGestionBean.filtro.consolidado}" />
												<p:column
													headerText="${titles['TTL_CONSOLIDADO_GESTION_ASESOR_AVANCE']}"
													rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR eq consolidadoGestionBean.filtro.consolidado}" />
											</p:row>
										</p:columnGroup>
										<!-- Fin Cabeceras -->

										<!-- Inicio Detalle -->
										<p:column styleClass="tematica numero"
											headerText="${titles['TTL_CONSOLIDADO_GESTION_META_ANUAL']}"
											rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}">
											<h:outputText value="#{dataCifra.metaTerritorialAnual}">
												<f:convertNumber pattern="#{enteroFormato}" />
											</h:outputText>
										</p:column>
										<p:column styleClass="tematica numero"
											headerText="${titles['TTL_CONSOLIDADO_GESTION_META_TRIMESTRE']}"
											rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}">
											<h:outputText value="#{dataCifra.metaPrimerTrimestre}">
												<f:convertNumber pattern="#{enteroFormato}" />
											</h:outputText>
										</p:column>
										<p:column styleClass="tematica numero"
											headerText="${titles['TTL_CONSOLIDADO_GESTION_META_AVANCE']}"
											rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR ne consolidadoGestionBean.filtro.consolidado}">
											<h:outputText value="#{dataCifra.avance}">
												<f:convertNumber pattern="#{porcentajeFormato}" />
											</h:outputText>
										</p:column>
										<p:column styleClass="tematica texto"
											headerText="${titles['TTL_CONSOLIDADO_GESTION_ASESOR']}"
											rendered="#{tipoConsolidado.TTL_CONSOLIDADO_GESTION_ENT_REP_ASESOR eq consolidadoGestionBean.filtro.consolidado}">
											<h:outputText value="#{dataCifra.nombreAsesor}" />
										</p:column>
										<p:column styleClass="tematica numero"
											headerText="${titles['TTL_CONSOLIDADO_GESTION_META_NUM_ENTIDADES']}">
											<h:outputText value="#{dataCifra.cantidadEntidades}" />
										</p:column>
									</p:dataTable>
								</p:panel>
							</div>
						</h:panelGroup>
					</div>
					<div class="col-md-1" />
				</div>
			</div>
			<br />
			<br />
			<p:defaultCommand target="frmPrincipal:searchBtn" />
		</h:panelGroup>
	</ui:define>
</ui:composition>