<ui:composition
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/resources/template/basicTemplate.xhtml">
	<f:metadata>
	</f:metadata>
		<ui:param name="pageTitle" value="${titles['TTL_INFORMACION_PERSONAL']}" />
		<ui:param name="pageSubtitle" value="${titles['TTL_MIHISTORICOBIENESYRENTAS']}" />
	<ui:define name="content">
		<script type="text/javascript">
		 $(window).on('load', function() {
		    var declar =  #{consultaBienesRentasBean.totalDeclaraciones};
			    if(declar == 0){
			    	    $('#declaracionNO').modal({backdrop: 'static', keyboard: false});
			      	$('#declaracionNO').modal('show');
			     }
			});
	</script>
	
	<ui:include src="../persona/tarjetaPersonaView.xhtml" /> 
		<h:form>

			<br />
			<p:spacer height="2" />
			<hr
				class="hr-style hr-style-two"
				style="margin-left: 22%; width: 77.5%; margin-top: 1em;" />
			<span style="font-size: 2em; font-weight: 500; color: #245379;">${titles['TTL_BR_HISTORICO']}</span>
			<br />
			<br />
			<div class="col-md-12">
				<p:dataTable
					id="declaraciones"
					var="dec"
					lazy="true"
					paginator="true"
					currentPageReportTemplate="{currentPage} ${titles['LBL_DE']} {totalPages}"
					reflow="true"
					value="#{consultaBienesRentasBean.listDecP}"
					rows="#{paginatorSize}" rowsPerPageTemplate="#{paginatorsSize}"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					emptyMessage="${titles['TTL_BIENES_RENTAS_TABLA_SIN_REGISTROS']}">
					<p:column
						headerText="#{titles.TTL_BR_TIPO_DECLARACION}"
						style="word-wrap: break-word !important;"
						sortBy="#{dec.nombreTipoDeclaracion}" sortable="true">
						<h:outputText value="#{dec.nombreTipoDeclaracion}" />
					</p:column>
					<p:column
						headerText="#{titles.TTL_BR_PERIODO_DECLARADO}"
						style="word-wrap: break-word !important; text-align: center !important;"
						sortBy="#{dec.fechaInicio}" sortable="true">
						<h:outputText value="#{dec.fechaInicio}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText> - 
			       		<h:outputText value="#{dec.fechaFin}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column
						headerText="#{titles.TTL_BR_FECHA_REALIZACION_DECLARACION}"
						style="word-wrap: break-word !important; text-align: center !important;"
						sortBy="#{dec.fechaPresentacion}" sortable="true">
						<h:outputText value="#{dec.fechaPresentacion}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column
						headerText="#{titles.TTL_BR_EXTEMPORANEAS_TITULO_TABLA}"
						style="word-wrap: break-word !important; text-align: center !important;"
						sortBy="#{dec.extmp}" sortable="true">
						<h:outputText value="#{dec.extmp}" />
					</p:column>
					<p:column
							headerText="#{titles.TTL_BR_MODIFICADA}"
							style="word-wrap: break-word!important; text-align: center !important;"
							sortBy="#{dec.modifi}" sortable="true">
							<h:outputText value="#{dec.modifi}" />
						</p:column>
					<p:column
						headerText="${titles['TTL_BIENES_RENTAS_RECEIVER_ENTITY_NAME']}"
						style="word-wrap: break-word !important;"
						sortBy="#{dec.entidadReceptora}" sortable="true">
						<h:outputText value="#{dec.entidadReceptora}" />
					</p:column>
					<p:column
						headerText="${titles['LBL_ACCIONES']}"
						style="opacity: 1 !important; word-wrap: break-word !important; text-align: center !important;">
						<p:commandButton
							title="#{titles.TTL_TABLA_VER}"
							ajax="true"
							action="#{consultaBienesRentasBean.prepararPDF(dec, 1)}"
							onclick="$('#dlgConfirmExtCon').modal('show');"
							update="panelDiaVisualizarExt lblTituloVentana"
							icon="icon-view"
							styleClass="icon-btn">
							<f:setPropertyActionListener
								value="#{dec}"
								target="#{consultaBienesRentasBean.declaracionSeleccionada}" />
						</p:commandButton>
						<p:commandButton
							title="#{titles.TTL_BR_EXPORTAR}"
							ajax="false"
							action ="#{consultaBienesRentasBean.exportarDeclaracion(dec, 1)}"
							process="@this"
							icon="icon-export-pdf"
							styleClass="icon-btn">
							<f:setPropertyActionListener
								value="#{dec}"
								target="#{consultaBienesRentasBean.declaracionSeleccionada}" />
						</p:commandButton>
						<p:commandButton
							title="#{titles.TTL_PRINT}"
							ajax="false"
							onclick="this.form.target='_blank'"
							action="#{consultaBienesRentasBean.validarEntidadesVisualizarEImprimir(dec, 1)}"
							process="@this"
							icon="icon-print"
							styleClass="icon-btn"
							rendered="#{dec.tipoDecImpVariasEntidades == false or !consultaBienesRentasBean.variasEntidades}">
							<f:setPropertyActionListener
								value="#{dec}"
								target="#{consultaBienesRentasBean.declaracionSeleccionada}" />
						</p:commandButton>
						<p:commandButton id="printvariasentidades"

							onclick="this.form.target=''"
								title="#{titles.TTL_PRINT} Varias"
									ajax="false"
									actionListener="#{consultaBienesRentasBean.validarEntidadesVisualizarEImprimir(dec, 1)}"
									process="@this"
							icon="icon-print"
							styleClass="icon-btn"						
							rendered="#{dec.tipoDecImpVariasEntidades == true and consultaBienesRentasBean.variasEntidades }">
							</p:commandButton>						
							
					</p:column>
				</p:dataTable>
				<br /> <br />
			</div>
			<div
				class="row"
				align="center">
				<div class="col-md-3"></div>
				<div
					class="col-md-6"
					id="cancel">
					<p:commandButton
						value="#{titles.TTL_BR_EXPORTAR_TODAS}"
						ajax="false"
						actionListener="#{consultaBienesRentasBean.exportarDeclaracionesTodas()}"
						process="@this"
						styleClass="btn btn-primary"
						style="padding-left:5%!important;padding-right:5%!important;font-size:1.5em!important;padding-top:0!important;">
					</p:commandButton>
					<p:commandButton
						value="${titles['BTN_CT_VOLVER']}"
						action="#{consultaBienesRentasBean.cancelar()}"
						styleClass="btn btn-default"
						style="padding-left:5%!important;padding-right:5%!important;font-size:1.5em!important;padding-top:0!important;">
					</p:commandButton>
				</div>
				<div class="col-md-3"></div>
			</div>
			<!-- Modal sin declraciones -->
			<div
				class="modal fade"
				id="declaracionNO"
				role="dialog"
				style="background: rgba(255, 255, 255, 0.45);">
				<div
					class="modal-dialog modal-dialog-2"
					style="top: 18%; width: 55%;">
					<div class="modal-content">
						<!-- Modal body -->
						<div class="modal-body">
							<div class="row">
								<div
									class="col-md-12"
									align="center">
									<br /> <br />
									<h4>
										<p:outputLabel
											id="txtCapital"
											value="${titles['TTL_NO_TIENE_DECLARACION']}"
											style="color: #265379!important; font-weight: normal!important;" />
									</h4>
									<br /> <br />
								</div>
							</div>
							<hr class="hr-style-modales" />
							<div class="row">
								<div class="col-md-12">
									<div class="col-md-4"></div>
									<div
										class="col-md-4"
										align="center"
										id="cancel">
										<p:commandButton
											value="${titles['BTN_CT_VOLVER']}"
											action="#{consultaBienesRentasBean.cancelar()}"
											styleClass="btn btn-default"
											style="padding-left:15%!important;padding-right:15%!important;font-size:1.5em!important; padding-top:0!important;">
										</p:commandButton>
									</div>
									<div class="col-md-4"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			
			<div class="modal fade" id="pdEntidadesUsuario" widgetVar="pdEntidadesUsuario" 
				role="dialog" style="background: rgba(255, 255, 255, 0.45);">
				<div class="modal-dialog modal-dialog-2" style="top: 25%; width: 42%;">
					<div class="modal-content">
						<div class="modal-body">
							<div id="msg-enti-block">
								<div class="row">
									<div class="col-md-12" align="center">
										<br />
										<h4>
											<p:outputLabel value="${titles['TTL_BIENES_RENTAS_MENSAJE_VARIAS_ENTIDADES']}" 
											style="color: #265379!important; font-weight: normal!important; font-size: 1.1em;" />
										</h4>
										<p:selectOneMenu id="seleccioneEntidad" value="#{consultaBienesRentasBean.entidadSelect}" 
											panelStyle="width: 25%!important;"
											filter="true" filterMatchMode="contains">
											<f:selectItem itemLabel="${titles['TTL_SELECT']}" itemValue="0" itemDisabled="true" />
											<f:selectItems value="#{consultaBienesRentasBean.lisEntidadesHistorico}" />
											<p:ajax process="@this" event="change" 
												listener = "#{consultaBienesRentasBean.seleccionarEntidadImpresion(this.value)}" />
										</p:selectOneMenu>
										<br />
										<br />
									</div>
								</div>
								<hr class="hr-style-modales" />
								<div class="row">
									<div class="col-md-12">
										<div class="col-md-3" align="left" style="margin-bottom: 3%;">
											<div id="boton1entidad">
												<h:commandLink id="btnVinExportarEstructuraPdf"  
													onclick="$('#pdEntidadesUsuario').modal('hide');" 
													action="#{consultaBienesRentasBean.visualizarEImprimirxEntidad()}" 
													target="_blank">
													<p:graphicImage name="images/printer.png" width="25"/>
												</h:commandLink>
											</div>
										</div>
										<div class="col-md-3"></div>
										<div class="col-md-3"></div>
										<div class="col-md-3" align="rigth" style="margin-bottom: 3%;">
											<div id="boton1entidad">
												<p:commandButton value="${titles['TTL_CANCEL']}" styleClass="btn btn-primary" 
												onclick="$('#pdEntidadesUsuario').modal('hide');" 
													style="padding-left:15%!important;padding-right:15%!important;font-size:1.5em!important; 
													padding-top:0!important;">
												</p:commandButton>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>			
			
			
		</h:form>
		<div
		class="modal fade"
		id="dlgConfirmExtCon"
		role="dialog">
		<div class="modal-dialog modal-dialog-2"
			style="top: 10%; width: 80%;">
			<div class="modal-content">
				<!-- Modal body -->
				
									
									<div class="modal-body">
									<h2>
						<p:outputLabel
							value="• #{consultaBienesRentasBean.tituloVentana} •"
							styleClass="page-subtitle" id="lblTituloVentana" />
					</h2>
										<p:panel id="panelDiaVisualizarExt" style="background: transparent!important;">
											<c:if test="#{consultaBienesRentasBean.obtenerRutaPdf()==null}">
								                <h:outputLabel value="Sin soporte" class="form-label-formularios" />
								            </c:if>
								            <c:if test="#{consultaBienesRentasBean.obtenerRutaPdf()!=null}">
								                <pe:documentViewer height="400" id="pdfVisualizerExt"  value="#{consultaBienesRentasBean.obtenerRutaPdf()}" />
								            </c:if>
								         </p:panel>
								         <div class="text-center">
								         <p:commandButton
										value="${titles['TTL_CLOSE']}"
										type="button"
										styleClass="btn btn-azul"
										style="border-right: 1px groove #245379 !important"
										onclick="$('#dlgConfirmExtCon').modal('hide');" 
									/>
									</div>
									</div>
									
			</div>
		</div>
	</div>
	</ui:define>
</ui:composition>