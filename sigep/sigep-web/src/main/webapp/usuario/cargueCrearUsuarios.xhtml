<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/resources/template/pageTemplate.xhtml">

	<script type="text/javascript">
		function start() {
			PF('statusDialog').show();
		}

		function stop() {
			PF('statusDialog').hide();
		}
	</script>

	<f:metadata>
		<f:viewParam name="id" value='#{cargueArchivoBean.id}' />
		<f:viewParam name="dialog" value='#{cargueArchivoBean.dialog}' />
		<f:event type="preRenderView" listener='#{cargueArchivoBean.retrieve}' />
		<f:event type="preRenderView"
			listener='#{cargueArchivoBean.showDialog}' />
	</f:metadata>

	<ui:param name="pageTitle" value="${titles['LBL_MENU_ADMN']}"
		style="color: #253846!important;" />
	<ui:param name="pageSubtitle"
		value="${titles['TTL_SUB_USUARIOS_CARGAR_ARCHIVO_CREAR']}"
		style="color: #2988B4!important; font-weight: 600;" />

	<ui:define name="main">
		<style>
.ui-state-default .ui-icon {
	display: none !important;
}

.ui-icon-calendar {
	font-size: 3em !important;
}
</style>

		<div class="row">
			<div class="col-md-12" align="center">
				<h:panelGroup>
					<h2>
						<p:outputLabel
							value="• ${titles['TTL_SUB_USUARIOS_CARGAR_ARCHIVO_CREAR']} •"
							styleClass="page-subtitle" style="color: #263948!important;" />
					</h2>
				</h:panelGroup>
			</div>
		</div>
		<div class="col-md-3"></div>
		<div class="panel-body form-horizontal col-md-6 cuadrito">
			<div class="row" align="center"
				style="margin-left: 3% !important; margin-rigth: 3% !important;">
				<h:commandButton value="${titles['TTL_DOWNLOAD_FORMAT']}"
					actionListener="#{cargueArchivoBean.downloadFormato()}"
					rendered="#{cargueArchivoBean.formato ne null}" ajax="false"
					onclick="PrimeFaces.monitorDownload(start, stop);"
					styleClass="btn btn-primary"
					style="font-size: font-size: 1.6em!important; padding-left: 9%!important; padding-right: 9%!important; padding-bottom: 1%!important; padding-top: 1%!important; border-radius: 4px!important;">
					<p:fileDownload value="#{cargueArchivoBean.formato}" />
				</h:commandButton>
				<h:commandButton value="${titles['TTL_DOWNLOAD_RESULT']}"
					rendered="#{cargueArchivoBean.salida ne null}" ajax="false"
					onclick="PrimeFaces.monitorDownload(start, stop);"
					icon="ui-icon-arrowthick-1-s" styleClass="btn btn-primary"
					style="font-size: font-size: 1.6em!important; padding-left: 9%!important; padding-right: 9%!important; padding-bottom: 1%!important; padding-top: 1%!important; border-radius: 4px!important;">
					<p:fileDownload value="#{cargueArchivoBean.salida}" />
				</h:commandButton>
			</div>
			<p:spacer height="3" />
			<hr
				style="display: block; margin-top: 0.5em; margin-bottom: 0.5em; margin-left: 4%; margin-right: 4%; border: 0.5px solid #CCCCCC; width: 93%;" />
			<div class="row"
				style="margin-left: 4% !important; margin-rigth: 4% !important;">
				<h:outputLabel
					value="Nombre del Usuario: #{sesionBean.usuarioSesion.nombrePersona}"
					styleClass="log-label form-label" style="color: #235379!important;" />
			</div>
			<div class="row" align="left"
				style="margin-top: 0.5em !important; margin-left: 4% !important; margin-rigth: 4% !important;">
				<h:panelGroup>
					<p:fileUpload id="cargadorArchivos" multiple="true" auto="true"
						fileUploadListener="#{cargueArchivoBean.handleFileUpload}"
						uploadLabel="${titles['TTL_UPLOAD']}"
						cancelLabel="${titles['TTL_CANCEL']}" process="@this"
						update="@this contains" dragDropSupport="true" required="true"
						requiredMessage="${messages['DLG_VALOR_REQUERIDO']}"
						converterMessage="${messages['MSG_ARCHIVO_CONVERTIDOR_INVALIDO']}"
						allowTypes="#{cargueArchivoBean.extensiones}"
						invalidFileMessage="${messages['MSG_ARCHIVO_EXTENSION_INVALIDA']}"
						invalidSizeMessage="${messages['MSG_ARCHIVO_TAMANIO_SUPERADO']}"
						mode="advanced" label="${titles['LBL_EXAMINAR']}"
						disabled="#{fn:length(cargueArchivoBean.xml.archivo) lt 1}" />
				</h:panelGroup>
				<p:message for="cargadorArchivos" display="icon" />
				<h:outputText />
			</div>
			<div class="row"
				style="margin-left: 4% !important; margin-right: 2.7% !important;">
				<p:dataTable id="archivosCargados"
					value="#{cargueArchivoBean.files}" var="file"
					emptyMessage="${messages['DLG_SIN_REGISTROS']}"
					selectionMode="single" selection="#{cargueArchivoBean.file}"
					rowKey="#{file.fileName}">
					<p:ajax event="rowSelect"
						listener="#{cargueArchivoBean.onFileSelect}" update="@this" />
					<p:ajax event="rowUnselect"
						listener="#{cargueArchivoBean.onFileUnselect}" update="@this" />
					<p:column
						headerText="${titles['LBL_USUARIOS_CARGAR_ARCHIVO_SELECCIONAR']}">
						<h:outputText value="#{file.fileName}" />
					</p:column>
				</p:dataTable>
				<p:contextMenu for="archivosCargados">
					<p:menuitem value="${titles['TTL_DELETE']}"
						update="archivosCargados" icon="ui-icon-trash"
						actionListener="#{cargueArchivoBean.quitarArchivo}" />
				</p:contextMenu>
			</div>
			<p:spacer height="3" />
			<div class="row" align="center"
				style="margin-left: 4% !important; margin-rigth: 4% !important;">
				<p:commandButton
					value="${titles['TTL_SUB_USUARIOS_CARGAR_ARCHIVO_CREAR']}"
					actionListener="#{cargueArchivoBean.persist()}"
					process="@this contains" update="contains"
					styleClass="btn btn-primary"
					style="font-size: 1.5em!important; padding-left:1%!important; padding-right:1%!important; border-radius: 4px!important;"
					rendered="#{cargueArchivoBean.entidadUsuario ne null and not empty cargueArchivoBean.files}" />
			</div>
			<p:spacer height="3" />
			<hr
				style="display: block; margin-top: 0.5em; margin-bottom: 0.5em; margin-left: 4%; margin-right: 4%; border: 0.5px solid #CCCCCC; width: 93%;" />
		</div>
	</ui:define>
</ui:composition>
