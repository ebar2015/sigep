<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/resources/template/pageTemplate.xhtml">

	<f:metadata>
		<f:viewParam name="id" value='#{logBean.id}' />
		<f:event type="preRenderView" listener='#{logBean.retrieve}' />
	</f:metadata>

	<ui:param name="pageTitle"
		value="${titles['TTL_TRANSVERSAL_ADMINISTRAR_LOG']}" />
	<ui:param name="pageSubtitle"
		value="${titles['TTL_SUB_TRANSVERSAL_ADMINISTRAR_LOG_CONSULTAR']}" />

	<f:event listener="#{logBean.validateForm}" type="postValidate" />
	<ui:define name="main">
		<p:panelGrid columns="3"
			columnClasses="ui-grid-col-3,ui-grid-col-6,ui-grid-col-3"
			layout="grid" styleClass="ui-panelgrid-blank">
			<p:outputLabel for="fechaFinal"
				value="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_FECHA']}" />
			<h:panelGroup>
				<p:calendar mask="true" yearRange="#{rangoAnios}" navigator="true"
					id="fechaInicial" value="#{logBean.fechaInicial}"
					maxdate="#{fechaSistema}" locale="#{lenguajeBean.localeCode}"
					pattern="#{fechaFormato}" required="true"
					requiredMessage="${messages['DLG_VALOR_REQUERIDO']}">
					<f:attribute name="maxDate" value="#{fechaSistema}" />
					<f:validator validatorId="maxDateValidator" />
				</p:calendar>
				<p:calendar mask="true" yearRange="#{rangoAnios}" navigator="true"
					id="fechaFinal" value="#{logBean.fechaFinal}"
					maxdate="#{fechaSistema}" locale="#{lenguajeBean.localeCode}"
					pattern="#{fechaFormato}" required="true"
					requiredMessage="${messages['DLG_VALOR_REQUERIDO']}">
					<f:attribute name="maxDate" value="#{fechaSistema}" />
					<f:validator validatorId="maxDateValidator" />
				</p:calendar>
			</h:panelGroup>
			<p:message for="fechaFinal" display="icon" />
			<p:outputLabel for="usuarioId"
				value="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_USUARIO']}" />
			<p:selectOneMenu id="usuarioId" filter="true"
				filterMatchMode="contains" value="#{logBean.usuarioId}"
				converter="usuarioConverter" var="t">
				<f:selectItem itemLabel="${titles['TTL_SELECT']}"
					itemValue="#{null}" />
				<f:selectItems value="#{usuarios}" var="usuario"
					itemLabel="#{usuario.login}" itemValue="#{usuario}" />
				<p:column>
					<h:outputText value="#{t.login}" />
				</p:column>
			</p:selectOneMenu>
			<p:message for="usuarioId" display="icon" />
			<p:outputLabel for="entidad"
				value="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_ENTIDAD']}" />
			<p:selectOneMenu id="entidad" filter="true"
				filterMatchMode="contains" value="#{logBean.entidad}" var="t">
				<f:selectItem itemLabel="${titles['TTL_SELECT']}"
					itemValue="#{null}" />
				<f:selectItems value="#{entidadesLog}" var="entidad"
					itemLabel="#{entidad}" itemValue="#{entidad}" />
				<p:column>
					<h:outputText value="#{t}" />
				</p:column>
			</p:selectOneMenu>
			<p:message for="entidad" display="icon" />
		</p:panelGrid>
		<p:separator />
		<p:panelGrid columns="1" columnClasses="ui-grid-col-12" layout="grid"
			styleClass="ui-panelgrid-blank">
			<p:dataTable id="logAuditoria" editable="true" reflow="true"
				resizableColumns="true" paginator="true"
				currentPageReportTemplate="{currentPage} #{'/'} {totalPages}"
				rowKey="#{item.id}" value="#{logBean.logAuditoria}"
				rows="#{paginatorSize}"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="#{paginatorsSize}" var="item"
				emptyMessage="${messages['DLG_SIN_REGISTROS']}" scrollable="true"
				scrollWidth="95%" scrollHeight="1000">
				<p:ajax event="rowSelect" listener="#{logBean.onRowSelect}"
					update="logAuditoria" />
				<p:ajax event="rowUnselect" listener="#{logBean.onRowUnselect}"
					update="logAuditoria" />
				<p:column sortBy="#{item.usuarioId.login}" sortable="true"
					style="width:10%"
					headerText="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_USUARIO']}">
					<h:outputText value="#{item.usuarioId.login}" />
				</p:column>
				<p:column sortBy="#{item.entidad}" sortable="true" style="width:15%"
					headerText="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_ENTIDAD']}">
					<h:outputText value="#{item.entidad}" />
				</p:column>
				<p:column sortBy="#{item.fechaRegistro}" sortable="true"
					style="width:15%"
					headerText="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_FECHA']}">
					<h:outputText value="#{item.fechaRegistro}">
						<f:convertDateTime pattern="#{fechaHoraFormato}" />
					</h:outputText>
				</p:column>
				<p:column
					headerText="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_VALOR_ACTUAL']}">
					<h:outputText value="#{item.valorActual}" style="white-space:pre;"
						escape="false" />
				</p:column>
				<p:column style="padding-top:0em"
					headerText="${titles['LBL_TRANSVERSAL_ADMINISTRAR_LOG_VALOR_ANTERIOR']}">
					<h:outputText value="#{item.valorAnterior}"
						style="white-space:pre;" escape="false" />
				</p:column>
			</p:dataTable>
		</p:panelGrid>
	</ui:define>
	<ui:define name="botones">
		<p:commandButton value="${titles['TTL_CONSULT']}"
			icon="ui-icon-search" process="@this contains"
			update="@this contains" actionListener="#{logBean.consultarLog}" />
	</ui:define>
</ui:composition>
